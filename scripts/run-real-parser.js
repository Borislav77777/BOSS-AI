const { chromium } = require('playwright');
const { main } = require('./scrape-openrouter-final.js');

/**
 * –ó–∞–ø—É—Å–∫ –ù–ê–°–¢–û–Ø–©–ï–ì–û –ø–∞—Ä—Å–µ—Ä–∞ OpenRouter —Å Playwright
 */

async function runRealParser() {
  console.log('üöÄ –ó–∞–ø—É—Å–∫ –ù–ê–°–¢–û–Ø–©–ï–ì–û –ø–∞—Ä—Å–µ—Ä–∞ OpenRouter...');
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –±—Ä–∞—É–∑–µ—Ä
  const browser = await chromium.launch({ 
    headless: true, // Headless —Ä–µ–∂–∏–º –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
    slowMo: 500 // –ó–∞–º–µ–¥–ª—è–µ–º –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
  });
  
  const context = await browser.newContext({
    viewport: { width: 1280, height: 720 },
    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    ignoreHTTPSErrors: true,
    extraHTTPHeaders: {
      'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
      'Accept-Language': 'en-US,en;q=0.5',
      'Accept-Encoding': 'gzip, deflate',
      'Connection': 'keep-alive',
      'Upgrade-Insecure-Requests': '1',
    }
  });
  
  const page = await context.newPage();
  
  // –î–µ–ª–∞–µ–º page –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π –ø–∞—Ä—Å–µ—Ä–∞
  global.page = page;
  
  try {
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥
    await main();
    
    console.log('‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ:', error);
  } finally {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä
    await browser.close();
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —Ñ–∞–π–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
if (require.main === module) {
  runRealParser().catch(console.error);
}

module.exports = { runRealParser };
