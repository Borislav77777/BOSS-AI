var He=Object.defineProperty,Be=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var Ae=(a,e,t)=>e in a?He(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,l=(a,e)=>{for(var t in e||(e={}))Ie.call(e,t)&&Ae(a,t,e[t]);if(re)for(var t of re(e))Ce.call(e,t)&&Ae(a,t,e[t]);return a},b=(a,e)=>Be(a,Ve(e));var _e=(a,e)=>{var t={};for(var s in a)Ie.call(a,s)&&e.indexOf(s)<0&&(t[s]=a[s]);if(a!=null&&re)for(var s of re(a))e.indexOf(s)<0&&Ce.call(a,s)&&(t[s]=a[s]);return t};var v=(a,e,t)=>new Promise((s,r)=>{var i=h=>{try{c(t.next(h))}catch(d){r(d)}},o=h=>{try{c(t.throw(h))}catch(d){r(d)}},c=h=>h.done?s(h.value):Promise.resolve(h.value).then(i,o);c((t=t.apply(a,e)).next())});import{j as n,m as C,A as V}from"./ui-0f47df3d.js";import{a as Ue,r as u,i as ce}from"./vendor-d3a444f7.js";import{t as We,c as ze}from"./utils-2cc12d2a.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var ye={},Ge,ke=Ue;Ge=ye.createRoot=ke.createRoot,ye.hydrateRoot=ke.hydrateRoot;class Fe{constructor(){const e=typeof import.meta!="undefined"?"https://boss-ai.online/api":"http://localhost:4200/api";this.config={baseUrl:e,tokenKey:"barsukov-token",userKey:"barsukov-user"}}loginWithTelegram(e){return v(this,null,function*(){try{const t=yield fetch(`${this.config.baseUrl}/auth/telegram/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const r=yield t.json();throw new Error(r.error||"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏")}const s=yield t.json();if(!s.success)throw new Error("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");return this.setStoredToken(s.data.token),this.setStoredUser(s.data.user),s.data}catch(t){throw console.error("[AuthService] –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",t),t}})}getCurrentUser(e){return v(this,null,function*(){const t=e||this.getStoredToken();if(!t)throw new Error("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");try{const s=yield fetch(`${this.config.baseUrl}/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!s.ok){s.status===401&&this.clearStorage();const o=yield s.json();throw new Error(o.error||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")}const r=yield s.json();if(!r.success)throw new Error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");const i=r.data.user||r.data;return this.setStoredUser(i),i}catch(s){throw console.error("[AuthService] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",s),s}})}logout(){return v(this,null,function*(){const e=this.getStoredToken();if(e)try{yield fetch(`${this.config.baseUrl}/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${e}`}})}catch(t){console.error("[AuthService] –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:",t)}this.clearStorage()})}confirmAgreement(e,t){return v(this,null,function*(){try{const s=yield fetch(`${this.config.baseUrl}/auth/telegram/agree`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegram_id:e,agreed:t})});if(!s.ok){const i=yield s.json();throw new Error(i.error||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–≥–ª–∞—à–µ–Ω–∏—è")}if(!(yield s.json()).success)throw new Error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–≥–ª–∞—à–µ–Ω–∏—è")}catch(s){throw console.error("[AuthService] –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–≥–ª–∞—à–µ–Ω–∏—è:",s),s}})}getStoredToken(){try{return localStorage.getItem(this.config.tokenKey)}catch(e){return console.error("[AuthService] –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:",e),null}}setStoredToken(e){try{localStorage.setItem(this.config.tokenKey,e)}catch(t){console.error("[AuthService] –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:",t)}}getStoredUser(){try{const e=localStorage.getItem(this.config.userKey);return e?JSON.parse(e):null}catch(e){return console.error("[AuthService] –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",e),null}}setStoredUser(e){try{localStorage.setItem(this.config.userKey,JSON.stringify(e))}catch(t){console.error("[AuthService] –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",t)}}isAuthenticated(){return!!this.getStoredToken()}clearStorage(){try{localStorage.removeItem(this.config.tokenKey),localStorage.removeItem(this.config.userKey)}catch(e){console.error("[AuthService] –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:",e)}}getConfig(){return l({},this.config)}updateConfig(e){this.config=l(l({},this.config),e)}}const j=new Fe;function Ke({user:a,onAccept:e,onDecline:t,isLoading:s=!1}){const i=`https://t.me/OzonBossAi_bot?start=auth_${a.id}`;return n.jsx(C.div,{className:"agreement-dialog-backdrop",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:n.jsxs(C.div,{className:"agreement-dialog-card",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},children:[n.jsx("div",{className:"flex items-center mb-4",children:n.jsx("h2",{className:"text-2xl font-semibold text-text",children:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ"})}),n.jsxs("p",{className:"text-text-secondary mb-4",children:["–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ",n.jsx("span",{className:"text-text font-medium",children:a.first_name}),"!"]}),n.jsxs("div",{className:"mb-6 p-4 bg-surface rounded-lg border border-border max-h-64 overflow-y-auto",children:[n.jsx("h3",{className:"text-lg font-medium text-text mb-3",children:"üìã –£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Boss AI"}),n.jsxs("div",{className:"space-y-3 text-sm text-text-secondary",children:[n.jsx("p",{children:'–ù–∞–∂–∏–º–∞—è "–ü—Ä–∏–Ω—è—Ç—å", –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Boss AI:'}),n.jsxs("ol",{className:"list-decimal list-inside space-y-2 pl-2",children:[n.jsxs("li",{children:[n.jsx("strong",{className:"text-text",children:"–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:"})," –ú—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ Telegram (ID, –∏–º—è, username, —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è) –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ."]}),n.jsxs("li",{children:[n.jsx("strong",{className:"text-text",children:"–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:"})," –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã."]}),n.jsxs("li",{children:[n.jsx("strong",{className:"text-text",children:"–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞:"})," –í—ã –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è."]}),n.jsxs("li",{children:[n.jsx("strong",{className:"text-text",children:"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤:"})," –í—ã –æ–±—è–∑—É–µ—Ç–µ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –∏ –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å –ø—Ä–∞–≤–∞ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π."]})]}),n.jsxs("p",{className:"mt-4",children:["üìÑ –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å —É—Å–ª–æ–≤–∏—è–º–∏ –º–æ–∂–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ"," ",n.jsx("a",{href:"https://boss-ai.com/terms",target:"_blank",rel:"noopener noreferrer",className:"text-button-primary hover:underline",children:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ"})]})]})]}),n.jsxs("div",{className:"mb-6 p-3 bg-telegram-blue/10 border border-telegram-blue/30 rounded-lg",children:[n.jsxs("p",{className:"text-sm text-text-secondary mb-2",children:["üí° ",n.jsx("strong",{className:"text-text",children:"–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±:"})]}),n.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram:"}),n.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"agreement-button-telegram inline-block w-full text-center",children:"üì± –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –≤ Telegram"})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:t,disabled:s,className:"flex-1 px-6 py-3 border border-border rounded-lg text-text-secondary hover:bg-surface-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"–û—Ç–∫–ª–æ–Ω–∏—Ç—å"}),n.jsx("button",{onClick:e,disabled:s,className:"flex-1 px-6 py-3 bg-button-primary text-button-primary-text rounded-lg font-semibold hover:bg-button-primary-hover transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:s?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ..."]}):"‚úÖ –ü—Ä–∏–Ω—è—Ç—å"})]}),n.jsx("p",{className:"text-xs text-text-muted text-center mt-4",children:"–ü—Ä–∏–Ω–∏–º–∞—è —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ —á—Ç–æ –æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"})]})})}function Ye({botUsername:a,size:e="large",radius:t,requestAccess:s=!0,onAuth:r,onError:i}){const o=u.useRef(null),c=u.useRef(!1);u.useEffect(()=>{if(window.onTelegramAuth=d=>{console.log("[TelegramAuthButton] –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram:",d),r(d)},!c.current&&o.current){if(document.getElementById("telegram-widget-script")){console.log("[TelegramAuthButton] –°–∫—Ä–∏–ø—Ç Telegram —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω"),c.current=!0,h();return}console.log("[TelegramAuthButton] –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ Telegram Widget...");const m=document.createElement("script");m.id="telegram-widget-script",m.src="https://telegram.org/js/telegram-widget.js?22",m.async=!0,m.setAttribute("data-telegram-login",a),m.setAttribute("data-size",e),m.setAttribute("data-onauth","onTelegramAuth(user)"),m.setAttribute("data-request-access",s?"write":""),t!==void 0&&m.setAttribute("data-radius",t.toString()),m.onload=()=>{console.log("[TelegramAuthButton] –°–∫—Ä–∏–ø—Ç Telegram Widget –∑–∞–≥—Ä—É–∂–µ–Ω"),c.current=!0},m.onerror=()=>{console.error("[TelegramAuthButton] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ Telegram Widget"),i&&i("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Telegram Widget")},o.current.appendChild(m)}return()=>{}},[a,e,t,s,r,i]);const h=()=>{};return n.jsx("div",{ref:o,className:"flex justify-center items-center min-h-[50px]","data-testid":"telegram-auth-button"})}function Je({onAuthSuccess:a,onAuthError:e}){const[t,s]=u.useState(!1),[r,i]=u.useState(null),[o,c]=u.useState(!1),[h,d]=u.useState(null),[m,f]=u.useState(null),y=E=>v(this,null,function*(){s(!0),i(null);try{console.log("[AuthWidget] –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram:",E);const g=yield j.loginWithTelegram(E);console.log("[AuthWidget] –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",{userId:g.user.id,needsAgreement:g.needsAgreement}),g.needsAgreement?(d(g.user),f(g.token),c(!0)):a(g.user,g.token)}catch(g){const x=g instanceof Error?g.message:"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏";console.error("[AuthWidget] –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",g),i(x),e&&e(x)}finally{s(!1)}}),w=()=>v(this,null,function*(){s(!0),i(null);try{console.log("[AuthWidget] –í—Ö–æ–¥ –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º");const E={id:0,telegram_id:0,username:"demo_user",first_name:"Demo",last_name:"User",photo_url:void 0,agreed_to_terms:!0},g="demo-token";j.setStoredToken(g),j.setStoredUser(E),console.log("[AuthWidget] –î–µ–º–æ-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞"),a(E,g)}catch(E){const g=E instanceof Error?E.message:"–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º";console.error("[AuthWidget] –û—à–∏–±–∫–∞ –¥–µ–º–æ-–≤—Ö–æ–¥–∞:",E),i(g),e&&e(g)}finally{s(!1)}}),A=()=>v(this,null,function*(){if(!(!h||!m)){s(!0);try{yield j.confirmAgreement(h.telegram_id,!0),console.log("[AuthWidget] –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ"),a(h,m)}catch(E){const g=E instanceof Error?E.message:"–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–æ–≥–ª–∞—à–µ–Ω–∏—è";console.error("[AuthWidget] –û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:",E),i(g)}finally{s(!1)}}}),k=()=>{console.log("[AuthWidget] –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ"),d(null),f(null),c(!1),j.clearStorage()};return n.jsxs(n.Fragment,{children:[n.jsx(C.div,{className:"auth-widget-backdrop",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:n.jsxs(C.div,{className:"auth-widget-card",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},children:[n.jsxs("div",{className:"auth-logo",children:[n.jsx("span",{children:"B"}),n.jsx("span",{children:"o"}),n.jsx("span",{children:"s"}),n.jsx("span",{children:"s"}),n.jsx("span",{children:" "}),n.jsx("span",{children:"A"}),n.jsx("span",{children:"I"})]}),n.jsx("h1",{className:"auth-title",children:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Boss AI"}),n.jsxs("p",{className:"auth-description",children:[n.jsx("span",{children:"–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å"})," ",n.jsx("span",{children:"—á–µ—Ä–µ–∑"})," ",n.jsx("span",{children:"Telegram"})," ",n.jsx("span",{children:"–¥–ª—è"})," ",n.jsx("span",{children:"–¥–æ—Å—Ç—É–ø–∞"})," ",n.jsx("span",{children:"–∫"})," ",n.jsx("span",{children:"–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ"})]}),!t&&n.jsx("div",{className:"auth-telegram-wrapper",children:n.jsx(Ye,{botUsername:"OzonBossAi_bot",onAuth:y,onError:E=>i(E)})}),t&&n.jsxs(C.div,{className:"flex items-center justify-center py-4",initial:{opacity:0},animate:{opacity:1},children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-telegram-blue"}),n.jsx("span",{className:"ml-3 text-text-secondary",children:"–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è..."})]}),r&&n.jsx(C.div,{className:"mt-4 p-3 bg-error/10 border border-error/30 rounded-lg text-error text-sm",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:r}),n.jsxs("div",{className:"demo-section",children:[n.jsx("p",{className:"text-text-muted text-xs text-center",children:"–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ demo-—Ä–µ–∂–∏–º –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è"}),n.jsx("button",{onClick:w,className:"demo-button",disabled:t,children:"–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–º–æ"})]})]})}),n.jsx(V,{children:o&&h&&n.jsx(Ke,{user:h,onAccept:A,onDecline:k,isLoading:t})})]})}var Ze={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Qe=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Xe=(a,e)=>{const t=u.forwardRef((m,d)=>{var f=m,{color:s="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:c}=f,h=_e(f,["color","size","strokeWidth","absoluteStrokeWidth","children"]);return u.createElement("svg",l(b(l({ref:d},Ze),{width:r,height:r,stroke:s,strokeWidth:o?Number(i)*24/Number(r):i,className:`lucide lucide-${Qe(a)}`}),h),[...e.map(([y,w])=>u.createElement(y,w)),...(Array.isArray(c)?c:[c])||[]])});return t.displayName=`${a}`,t};var M=Xe;const qe=M("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),et=M("Box",[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),tt=M("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),Ne=M("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),ue=M("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),st=M("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),je=M("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),rt=M("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),it=M("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),be=M("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);class nt{constructor(e){this.errorHandlers=[],this.errorCount=0,this.errors=[],this.config=e,this.sessionId=this.generateSessionId(),this.setupGlobalErrorHandlers()}registerErrorHandler(e){this.errorHandlers.push(e)}unregisterErrorHandler(e){const t=this.errorHandlers.indexOf(e);t>-1&&this.errorHandlers.splice(t,1)}handleError(e,t){if(this.errorCount>=this.config.maxErrorsPerSession)return;this.errorCount++;const s={id:this.generateErrorId(),message:e.message,stack:e.stack,component:t==null?void 0:t.component,service:t==null?void 0:t.service,timestamp:new Date,severity:this.determineSeverity(e,t),userAgent:navigator.userAgent,url:window.location.href,userId:t==null?void 0:t.userId,sessionId:this.sessionId};this.errors.push(s),this.config.enableConsoleLogging&&this.logToConsole(s,t),this.config.enableUserNotifications&&this.notifyUser(s),this.config.enableRemoteLogging&&this.reportToRemote(s),this.errorHandlers.forEach(r=>{try{r(e,t)}catch(i){console.error("Error in error handler:",i)}})}handlePromiseRejection(e){const t=e.reason instanceof Error?e.reason:new Error(String(e.reason));this.handleError(t,{component:"Promise",action:"rejection"})}handleResourceError(e){const t=e.target,s=new Error(`Failed to load resource: ${t.tagName}`);this.handleError(s,{component:"Resource",action:"load",metadata:{tagName:t.tagName,src:t.src||t.href}})}getErrors(){return[...this.errors]}getErrorsByService(e){return this.errors.filter(t=>t.service===e)}getErrorsByComponent(e){return this.errors.filter(t=>t.component===e)}getErrorsBySeverity(e){return this.errors.filter(t=>t.severity===e)}clearErrors(){this.errors=[],this.errorCount=0}getErrorStats(){const e={total:this.errors.length,bySeverity:{},byService:{},byComponent:{}};return this.errors.forEach(t=>{e.bySeverity[t.severity]=(e.bySeverity[t.severity]||0)+1,t.service&&(e.byService[t.service]=(e.byService[t.service]||0)+1),t.component&&(e.byComponent[t.component]=(e.byComponent[t.component]||0)+1)}),e}setupGlobalErrorHandlers(){this.config.enableErrorBoundary&&(window.addEventListener("error",e=>{this.handleError(e.error,{component:"Global",action:"unhandled"})}),window.addEventListener("unhandledrejection",e=>{this.handlePromiseRejection(e)}),window.addEventListener("error",e=>{e.target!==window&&this.handleResourceError(e)},!0))}determineSeverity(e,t){return e.name==="TypeError"||e.name==="ReferenceError"?"critical":t!=null&&t.service?"high":t!=null&&t.component?"medium":"low"}logToConsole(e,t){const s=`[ErrorHandlingService] ${e.severity.toUpperCase()}: ${e.message}`;switch(e.severity){case"critical":console.error(s,e,t);break;case"high":console.error(s,e,t);break;case"medium":console.warn(s,e,t);break;case"low":console.info(s,e,t);break}}notifyUser(e){e.severity==="critical"&&console.warn("Critical error occurred:",e.message)}reportToRemote(e){return v(this,null,function*(){if(!(!this.config.remoteEndpoint||!this.config.apiKey))try{yield fetch(this.config.remoteEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify(e)})}catch(t){console.error("Failed to report error to remote server:",t)}})}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateErrorId(){return`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const Me=new nt({enableConsoleLogging:!0,enableRemoteLogging:!1,enableUserNotifications:!0,enableErrorBoundary:!0,maxErrorsPerSession:100});class ot extends u.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){const s={component:"ErrorBoundary",action:"componentDidCatch",metadata:{componentStack:t.componentStack,errorBoundary:!0}};Me.handleError(e,s),this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError(e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:n.jsx("div",{className:"error-boundary",children:n.jsxs("div",{className:"error-boundary__container",children:[n.jsx("div",{className:"error-boundary__icon",children:"‚ö†Ô∏è"}),n.jsx("h2",{className:"error-boundary__title",children:"–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫"}),n.jsx("p",{className:"error-boundary__message",children:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ú—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –µ—ë –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º."}),n.jsxs("div",{className:"error-boundary__actions",children:[n.jsx("button",{className:"error-boundary__button error-boundary__button--primary",onClick:()=>window.location.reload(),children:"–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É"}),n.jsx("button",{className:"error-boundary__button error-boundary__button--secondary",onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),children:"–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"})]}),!1]})}):this.props.children}}const ie={TYPES:{NETWORK:"NETWORK_ERROR",VALIDATION:"VALIDATION_ERROR",AUTHENTICATION:"AUTHENTICATION_ERROR",AUTHORIZATION:"AUTHORIZATION_ERROR",NOT_FOUND:"NOT_FOUND_ERROR",SERVER:"SERVER_ERROR",CLIENT:"CLIENT_ERROR",UNKNOWN:"UNKNOWN_ERROR"},CODES:{NETWORK_TIMEOUT:"NETWORK_TIMEOUT",NETWORK_OFFLINE:"NETWORK_OFFLINE",NETWORK_CONNECTION_FAILED:"NETWORK_CONNECTION_FAILED",INVALID_INPUT:"INVALID_INPUT",MISSING_REQUIRED_FIELD:"MISSING_REQUIRED_FIELD",INVALID_FORMAT:"INVALID_FORMAT",INVALID_CREDENTIALS:"INVALID_CREDENTIALS",TOKEN_EXPIRED:"TOKEN_EXPIRED",TOKEN_INVALID:"TOKEN_INVALID",FILE_TOO_LARGE:"FILE_TOO_LARGE",FILE_TYPE_NOT_SUPPORTED:"FILE_TYPE_NOT_SUPPORTED",FILE_UPLOAD_FAILED:"FILE_UPLOAD_FAILED",MESSAGE_SEND_FAILED:"MESSAGE_SEND_FAILED",MESSAGE_TOO_LONG:"MESSAGE_TOO_LONG",CHAT_NOT_FOUND:"CHAT_NOT_FOUND"},MESSAGES:{GENERIC:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞",NETWORK:"–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É",VALIDATION:"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö",AUTHENTICATION:"–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏",AUTHORIZATION:"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏",NOT_FOUND:"–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π —Ä–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω",SERVER:"–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ",FILE_UPLOAD:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞",MESSAGE_SEND:"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è"},LOGGING:{MAX_ERRORS_IN_STORAGE:50,ERROR_RETENTION_DAYS:7,LOG_LEVELS:{ERROR:"error",WARNING:"warning",INFO:"info",DEBUG:"debug"}},RECOVERY:{AUTO_RETRY_ATTEMPTS:3,RETRY_DELAY:1e3,FALLBACK_TIMEOUT:5e3}};class at{constructor(){this.notifications=[],this.listeners=[],this.nextId=1}show(e,t,s,r){var o;const i={id:`notification_${this.nextId++}`,type:e,title:t,message:s,duration:(o=r==null?void 0:r.duration)!=null?o:this.getDefaultDuration(e),actions:r==null?void 0:r.actions,metadata:r==null?void 0:r.metadata};return this.notifications.unshift(i),this.notifyListeners(),i.duration&&i.duration>0&&setTimeout(()=>{this.hide(i.id)},i.duration),i.id}success(e,t,s){return this.show("success",e,t,s)}error(e,t,s){return this.show("error",e,t,s)}warning(e,t,s){return this.show("warning",e,t,s)}info(e,t,s){return this.show("info",e,t,s)}hide(e){this.notifications=this.notifications.filter(t=>t.id!==e),this.notifyListeners()}hideAll(){this.notifications=[],this.notifyListeners()}getNotifications(){return[...this.notifications]}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}showErrorBoundaryNotification(e,t){const s=this.determineErrorType(e),r=this.getErrorTitle(s),i=this.getErrorMessage(e,s);return this.error(r,i,{duration:0,actions:[{label:"–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏",action:()=>this.showErrorDetails(e,t),variant:"secondary"},{label:"–ó–∞–∫—Ä—ã—Ç—å",action:()=>this.hideAll(),variant:"primary"}],metadata:{errorType:s,componentStack:t==null?void 0:t.componentStack,errorBoundary:t==null?void 0:t.errorBoundary}})}getDefaultDuration(e){switch(e){case"success":return 3e3;case"error":return 0;case"warning":return 5e3;case"info":return 4e3;default:return 3e3}}determineErrorType(e){return e.name==="TypeError"?"–û—à–∏–±–∫–∞ —Ç–∏–ø–∞":e.name==="ReferenceError"?"–û—à–∏–±–∫–∞ —Å—Å—ã–ª–∫–∏":e.name==="NetworkError"?"–û—à–∏–±–∫–∞ —Å–µ—Ç–∏":e.message.includes("fetch")?"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏":e.message.includes("auth")?"–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏":e.message.includes("permission")?"–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞":"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}getErrorTitle(e){return e}getErrorMessage(e,t){if(e.message)return e.message;switch(t){case"–û—à–∏–±–∫–∞ —Å–µ—Ç–∏":return ie.MESSAGES.NETWORK;case"–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏":return ie.MESSAGES.AUTHENTICATION;case"–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞":return ie.MESSAGES.AUTHORIZATION;default:return ie.MESSAGES.GENERIC}}showErrorDetails(e,t){this.info("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏","–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ –≤—ã–≤–µ–¥–µ–Ω–∞ –≤ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞")}notifyListeners(){this.listeners.forEach(e=>e(this.notifications))}}const ve=new at;function B(...a){return We(ze(a))}const ct=({notification:a,onClose:e})=>{const t=i=>{switch(i){case"success":return n.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})});case"error":return n.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})});case"warning":return n.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"info":return n.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},r=(i=>{switch(i){case"success":return{container:"bg-green-50 border-green-200 text-green-800",icon:"text-green-400",button:"bg-green-100 hover:bg-green-200 text-green-800"};case"error":return{container:"bg-red-50 border-red-200 text-red-800",icon:"text-red-400",button:"bg-red-100 hover:bg-red-200 text-red-800"};case"warning":return{container:"bg-yellow-50 border-yellow-200 text-yellow-800",icon:"text-yellow-400",button:"bg-yellow-100 hover:bg-yellow-200 text-yellow-800"};case"info":return{container:"bg-primary border-primary text-background",icon:"text-background",button:"bg-primary hover:bg-primary/80 text-background"}}})(a.type);return n.jsx(C.div,{initial:{opacity:0,y:-50,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-50,scale:.95},transition:{duration:.3,ease:[.25,.46,.45,.94]},className:B("max-w-sm w-full p-4 rounded-lg border shadow-lg",r.container),children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:B("flex-shrink-0",r.icon),children:t(a.type)}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"text-sm font-medium mb-1",children:a.title}),n.jsx("p",{className:"text-sm opacity-90",children:a.message}),a.actions&&a.actions.length>0&&n.jsx("div",{className:"mt-3 flex space-x-2",children:a.actions.map((i,o)=>n.jsx("button",{type:"button",onClick:i.action,className:B("px-3 py-1 text-xs font-medium rounded transition-colors duration-200",r.button),children:i.label},o))})]}),n.jsx("button",{type:"button",onClick:()=>e(a.id),className:B("flex-shrink-0 p-1 rounded transition-colors duration-200",r.button),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},lt=()=>{const[a,e]=u.useState([]);return u.useEffect(()=>ve.subscribe(e),[]),n.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:n.jsx(V,{children:a.map(t=>n.jsx(ct,{notification:t,onClose:s=>ve.hide(s)},t.id))})})},dt="modulepreload",ht=function(a){return"/"+a},Le={},Ee=function(e,t,s){if(!t||t.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=ht(i),i in Le)return;Le[i]=!0;const o=i.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(!!s)for(let m=r.length-1;m>=0;m--){const f=r[m];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${c}`))return;const d=document.createElement("link");if(d.rel=o?"stylesheet":dt,o||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),o)return new Promise((m,f)=>{d.addEventListener("load",m),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};class ut extends u.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Three.js Error:",e,t)}render(){return this.state.hasError?this.props.fallback:this.props.children}}const gt=({actions:a,onActionClick:e})=>a.length===0?null:n.jsx(C.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},className:"absolute right-6 top-1/2 -translate-y-1/2 z-10",children:n.jsx("div",{className:"bg-black/20 backdrop-blur-md border border-cyan-500/30 rounded-2xl p-3 shadow-[0_0_30px_rgba(0,255,255,0.1)] w-[220px]",children:n.jsx("div",{className:"space-y-2",children:n.jsx(V,{children:a.map((t,s)=>n.jsx(C.button,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:s*.1},whileHover:{scale:1.02,x:-2},whileTap:{scale:.98},onClick:()=>e(t.action),className:"w-full py-2.5 px-3 bg-cyan-500/20 border border-cyan-500/50 rounded-lg text-cyan-300 font-mono text-xs hover:bg-cyan-500/30 hover:shadow-[0_0_15px_rgba(0,255,255,0.3)] transition-all text-left",children:t.text},t.id))})})})}),mt=({view3D:a,onToggleView:e})=>n.jsx("div",{className:"absolute left-1/2 top-1/3 -translate-x-1/2 z-10",children:n.jsxs(C.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"bg-black/20 backdrop-blur-md border border-cyan-500/30 rounded-2xl p-6 shadow-[0_0_40px_rgba(0,255,255,0.15)]",children:[n.jsxs("div",{className:"relative mb-4",children:[n.jsx("div",{className:"w-28 h-28 rounded-full border-2 border-cyan-500/50 overflow-hidden shadow-[0_0_30px_rgba(0,255,255,0.4)] bg-black/30 backdrop-blur-sm mx-auto",children:n.jsx("img",{src:"/images/agents/BOSS_AI_AVA.jpg",alt:"BOSS AI",className:"w-full h-full object-cover",onError:t=>{t.currentTarget.style.display="none";const s=document.createElement("div");s.className="w-full h-full flex items-center justify-center text-5xl",s.textContent="ü§ñ",t.currentTarget.parentElement.appendChild(s)}})}),n.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-cyan-400/30 animate-ping"})]}),n.jsxs("div",{className:"flex justify-center space-x-2",children:[n.jsx(C.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:e,className:`px-4 py-1.5 rounded-lg font-mono text-xs transition-all border ${a?"bg-black/30 border-cyan-500/30 text-cyan-400/60 hover:border-cyan-500/40":"bg-cyan-500/30 border-cyan-500/50 text-cyan-300 shadow-[0_0_10px_rgba(0,255,255,0.3)]"}`,children:"2D"}),n.jsx(C.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:e,className:`px-4 py-1.5 rounded-lg font-mono text-xs transition-all border ${a?"bg-cyan-500/30 border-cyan-500/50 text-cyan-300 shadow-[0_0_10px_rgba(0,255,255,0.3)]":"bg-black/30 border-cyan-500/30 text-cyan-400/60 hover:border-cyan-500/40"}`,children:"3D"})]})]})}),pt=({agentName:a,lastMessage:e,onSendMessage:t})=>{const[s,r]=u.useState(""),i=o=>{o.preventDefault(),s.trim()&&(t(s),r(""))};return n.jsx(C.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{duration:.3},className:"absolute bottom-6 left-1/2 -translate-x-1/2 w-[700px] max-w-[90vw] z-10",children:n.jsxs("div",{className:"bg-black/20 backdrop-blur-md border border-cyan-500/30 rounded-xl p-4 shadow-[0_0_30px_rgba(0,255,255,0.1)]",children:[e&&n.jsxs("div",{className:"mb-3 text-cyan-300/80 font-mono text-sm",children:[n.jsx("span",{className:"text-cyan-400",children:">"})," ",e]}),n.jsxs("form",{onSubmit:i,className:"flex items-center space-x-2",children:[n.jsx("input",{type:"text",value:s,onChange:o=>r(o.target.value),placeholder:"–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...",className:"flex-1 bg-black/30 border border-cyan-500/30 rounded-lg px-4 py-2 text-cyan-300 placeholder-cyan-500/50 font-mono text-sm focus:outline-none focus:border-cyan-500/50 focus:ring-1 focus:ring-cyan-500/30"}),n.jsx(C.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",className:"p-2 bg-cyan-500/20 border border-cyan-500/50 rounded-lg hover:bg-cyan-500/30 transition-all",children:n.jsx(je,{className:"w-5 h-5 text-cyan-400"})})]})]})})},ft=({agents:a,selectedAgentId:e,onAgentSelect:t,onNavigate:s})=>{const[r,i]=u.useState(null);return n.jsx("div",{className:"absolute left-6 top-1/2 -translate-y-1/2 z-10",children:n.jsxs("div",{className:"bg-black/20 backdrop-blur-md border border-cyan-500/30 rounded-2xl p-3 shadow-[0_0_30px_rgba(0,255,255,0.1)]",children:[n.jsx("div",{className:"space-y-3 mb-4",children:a.map(o=>n.jsxs("div",{className:"relative",children:[n.jsx(C.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>t(o.id),onMouseEnter:()=>i(o.id),onMouseLeave:()=>i(null),className:`w-14 h-14 rounded-full flex items-center justify-center text-2xl transition-all border-2 ${e===o.id?"bg-cyan-500/30 border-cyan-400 shadow-[0_0_20px_rgba(0,255,255,0.5)]":"bg-black/30 border-cyan-500/30 hover:border-cyan-400/50 hover:shadow-[0_0_15px_rgba(0,255,255,0.3)]"}`,children:o.icon}),r===o.id&&n.jsx(C.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 bg-black/80 backdrop-blur-md border border-cyan-500/50 rounded-lg px-3 py-1 whitespace-nowrap",children:n.jsx("span",{className:"text-cyan-300 font-mono text-sm",children:o.name})})]},o.id))}),n.jsx("div",{className:"h-px bg-cyan-500/30 mb-4"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"relative",children:[n.jsx(C.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>s("analytics"),onMouseEnter:()=>i("analytics"),onMouseLeave:()=>i(null),className:"w-14 h-14 rounded-full flex items-center justify-center transition-all border-2 bg-black/30 border-cyan-500/30 hover:border-cyan-400/50 hover:shadow-[0_0_15px_rgba(0,255,255,0.3)]",children:n.jsx(qe,{className:"w-6 h-6 text-cyan-400"})}),r==="analytics"&&n.jsx(C.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 bg-black/80 backdrop-blur-md border border-cyan-500/50 rounded-lg px-3 py-1 whitespace-nowrap",children:n.jsx("span",{className:"text-cyan-300 font-mono text-sm",children:"Analytics"})})]}),n.jsxs("div",{className:"relative",children:[n.jsx(C.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>s("settings"),onMouseEnter:()=>i("settings"),onMouseLeave:()=>i(null),className:"w-14 h-14 rounded-full flex items-center justify-center transition-all border-2 bg-black/30 border-cyan-500/30 hover:border-cyan-400/50 hover:shadow-[0_0_15px_rgba(0,255,255,0.3)]",children:n.jsx(rt,{className:"w-6 h-6 text-cyan-400"})}),r==="settings"&&n.jsx(C.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 bg-black/80 backdrop-blur-md border border-cyan-500/50 rounded-lg px-3 py-1 whitespace-nowrap",children:n.jsx("span",{className:"text-cyan-300 font-mono text-sm",children:"Settings"})})]})]})]})})},yt=u.lazy(()=>Ee(()=>import("./Model3DPlayground-a082ab45.js"),["assets/Model3DPlayground-a082ab45.js","assets/ui-0f47df3d.js","assets/vendor-d3a444f7.js","assets/index-5cc3606d.js","assets/utils-2cc12d2a.js"]).then(a=>({default:a.Model3DPlayground}))),vt=u.lazy(()=>Ee(()=>import("./Background3D-f9fe7c5c.js").then(a=>a.B),["assets/Background3D-f9fe7c5c.js","assets/ui-0f47df3d.js","assets/vendor-d3a444f7.js","assets/index-5cc3606d.js"]).then(a=>({default:a.Background3D}))),St=({agents:a})=>{const[e,t]=u.useState(null),[s,r]=u.useState(!1),[i,o]=u.useState(!1),[c,h]=u.useState([]),[d,m]=u.useState(""),f=a.find(E=>E.id===e),y=E=>{t(E);const g=a.find(x=>x.id===E);g&&(h(g.initialButtons),m(g.welcomeMessage))},w=E=>{console.log("Action clicked:",E),m(`–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –¥–µ–π—Å—Ç–≤–∏–µ: ${E}...`)},A=E=>{console.log("Navigate to:",E)},k=E=>{console.log("Message sent:",E),m(`–í—ã: ${E}`)};return n.jsxs("div",{className:"relative w-screen h-screen overflow-hidden",children:[n.jsx(u.Suspense,{fallback:n.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-black via-blue-950 to-black z-0",children:n.jsx("div",{className:"absolute inset-0 opacity-30",children:[...Array(100)].map((E,g)=>n.jsx("div",{className:"absolute w-1 h-1 bg-cyan-400 rounded-full animate-pulse",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDelay:`${Math.random()*3}s`}},g))})}),children:n.jsx(ut,{fallback:n.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-black via-blue-950 to-black z-0",children:n.jsx("div",{className:"absolute inset-0 opacity-30",children:[...Array(100)].map((E,g)=>n.jsx("div",{className:"absolute w-1 h-1 bg-cyan-400 rounded-full animate-pulse",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDelay:`${Math.random()*3}s`}},g))})}),children:n.jsx(vt,{})})}),n.jsx("button",{onClick:()=>o(!i),className:"fixed top-6 right-6 z-40 p-3 bg-black/20 backdrop-blur-md border-2 border-cyan-500/30 text-cyan-400 rounded-full shadow-[0_0_20px_rgba(0,255,255,0.2)] hover:shadow-[0_0_30px_rgba(0,255,255,0.4)] transition-all hover:scale-110 hover:bg-cyan-500/10",title:"–û—Ç–∫—Ä—ã—Ç—å 3D Orbital Space",children:n.jsx(et,{className:"w-5 h-5"})}),n.jsx(V,{children:i&&n.jsx(u.Suspense,{fallback:n.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-black/80 backdrop-blur-lg border-2 border-cyan-500 rounded-lg p-8",children:n.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"}),n.jsx("p",{className:"text-cyan-400 font-mono",children:"Loading 3D Space..."})]})}),children:n.jsx(yt,{modelUrl:"/models/test-model.glb",onClose:()=>o(!1)})})}),n.jsx(ft,{agents:a,selectedAgentId:e,onAgentSelect:y,onNavigate:A}),n.jsx(mt,{view3D:s,onToggleView:()=>r(!s)}),n.jsx(V,{children:f&&n.jsx(gt,{actions:c,onActionClick:w})}),n.jsx(V,{children:f&&n.jsx(pt,{agentName:f.name,lastMessage:d,onSendMessage:k})}),n.jsx("div",{className:"fixed top-6 right-24 z-10 bg-black/20 backdrop-blur-md border border-cyan-500/30 rounded-full px-4 py-2 shadow-[0_0_20px_rgba(0,255,255,0.1)]",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("span",{className:"text-xs text-cyan-400/70 font-mono",children:"BT"}),n.jsx("span",{className:"text-sm font-bold text-cyan-400 font-mono",children:"1,000"})]})})]})},ge={SIDEBAR:{DEFAULT_WIDTH:280,MIN_WIDTH:200,MAX_WIDTH:500,COLLAPSED_WIDTH:60},CHAT:{DEFAULT_WIDTH:525,MIN_WIDTH:250,MAX_WIDTH:2e3,INPUT_DEFAULT_HEIGHT:300,INPUT_MIN_HEIGHT:200,INPUT_MAX_HEIGHT:800},HEADER_HEIGHT:60,FOOTER_HEIGHT:40,SPACING:{SMALL:8,MEDIUM:16,LARGE:24,XLARGE:32},BREAKPOINTS:{MOBILE:768,TABLET:1024,DESKTOP:1280,LARGE_DESKTOP:1920}},Re={AVAILABLE:{DARK:"dark",LIGHT:"light",CUSTOM:"custom"},FONT_SIZES:{SMALL:"small",MEDIUM:"medium",LARGE:"large"},COLORS:{MOCHA_MOUSE:"#8B4513",MOCHA_MOUSE_LIGHT:"#A0522D",MOCHA_MOUSE_DARK:"#5D2F0A",NEON_GREEN:"#A0522D",NEON_PURPLE:"#d946ef",NEON_ORANGE:"#f59e0b",SUCCESS:"#10b981",WARNING:"#f59e0b",ERROR:"#ef4444",INFO:"#000000"},CSS_VARIABLES:{PRIMARY:"--primary",BACKGROUND:"--background",SURFACE:"--surface",TEXT:"--text",TEXT_SECONDARY:"--text-secondary",BORDER:"--border"},ANIMATIONS:{ENABLED:"on",DISABLED:"off"}};class bt{constructor(){this.context={attachedItems:[],userLocation:"workspace"},this.listeners=new Set,this.handleAttachContext=e=>{const t=e.detail;this.context.attachedItems.findIndex(r=>r.id===t.id)===-1&&(this.context.attachedItems.push(t),this.notifyListeners(),console.log(`–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω: ${t.type} - ${t.title}`))},this.handleDetachContext=e=>{const{id:t}=e.detail;this.context.attachedItems=this.context.attachedItems.filter(s=>s.id!==t),this.notifyListeners(),console.log(`–ö–æ–Ω—Ç–µ–∫—Å—Ç —É–¥–∞–ª–µ–Ω: ${t}`)},this.handleWorkspaceNavigate=e=>{const{projectId:t}=e.detail,s=this.findProjectById(t);s&&(this.context.activeProject={id:s.id,title:s.title,type:"project"},this.context.userLocation="project",this.autoAttachActiveProject(),this.notifyListeners(),console.log(`–ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç: ${s.title}`))},this.handleWorkspaceSendToChat=e=>{const{items:t}=e.detail;t.forEach(s=>{const r={id:s.id,type:s.type==="folder"?"project":s.type==="note"?"document":s.type,title:s.title,icon:s.emoji||"üìÑ",content:s.content,metadata:{path:s.path,size:s.size,tags:s.tags,createdAt:s.createdAt,updatedAt:s.updatedAt},removable:!0,source:"workspace"};this.attachContext(r)})},this.initEventListeners()}initEventListeners(){window.addEventListener("chat:attach-context",this.handleAttachContext),window.addEventListener("chat:detach-context",this.handleDetachContext),window.addEventListener("workspace:navigate",this.handleWorkspaceNavigate),window.addEventListener("workspace:send-to-chat",this.handleWorkspaceSendToChat)}autoAttachActiveProject(){if(this.context.activeProject&&!this.context.attachedItems.find(t=>t.type==="project"&&t.id===this.context.activeProject.id)){const t={id:this.context.activeProject.id,type:"project",title:this.context.activeProject.title,icon:"üìÅ",removable:!0,source:"workspace",metadata:{autoAttached:!0}};this.context.attachedItems.push(t)}}findProjectById(e){var s;return(((s=window.__PLATFORM_STATE__)==null?void 0:s.workspaceItems)||[]).find(r=>r.id===e&&r.type==="folder")||null}attachContext(e){window.dispatchEvent(new CustomEvent("chat:attach-context",{detail:e}))}detachContext(e){window.dispatchEvent(new CustomEvent("chat:detach-context",{detail:{id:e}}))}getContext(){return l({},this.context)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.getContext())}catch(t){console.error("–û—à–∏–±–∫–∞ –≤ —Å–ª—É—à–∞—Ç–µ–ª–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–∞—Ç–∞:",t)}})}clearContext(){this.context.attachedItems=[],this.context.activeProject=void 0,this.context.activeDocument=void 0,this.context.userLocation="workspace",this.notifyListeners(),console.log("–ö–æ–Ω—Ç–µ–∫—Å—Ç —á–∞—Ç–∞ –æ—á–∏—â–µ–Ω")}getContextForAI(){const e=this.generateContextSummary();return{attachedItems:this.context.attachedItems,activeProject:this.context.activeProject,userLocation:this.context.userLocation,contextSummary:e}}generateContextSummary(){const e=[];if(this.context.activeProject&&e.push(`–ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç: ${this.context.activeProject.title}`),this.context.attachedItems.length>0){const t=this.context.attachedItems.map(s=>`${s.type}: ${s.title}`).join(", ");e.push(`–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã: ${t}`)}return e.push(`–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${this.context.userLocation}`),e.join(" | ")}}const Et=new bt;class wt{constructor(){this.serviceIntegrations=new Map,this.handlers=new Map,this.chatButtons=new Map,this.eventListeners={onMessageReceived:[],onResponseGenerated:[],onHandlerExecuted:[]}}registerServiceIntegration(e){this.serviceIntegrations.set(e.serviceId,e),e.handlers.forEach(t=>{this.handlers.set(t.id,t)}),e.chatButtons.forEach(t=>{this.chatButtons.set(t.id,t)}),console.log(`[ChatIntegration] –°–µ—Ä–≤–∏—Å ${e.serviceId} –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω`)}unregisterServiceIntegration(e){const t=this.serviceIntegrations.get(e);t&&(t.handlers.forEach(s=>{this.handlers.delete(s.id)}),t.chatButtons.forEach(s=>{this.chatButtons.delete(s.id)}),this.serviceIntegrations.delete(e),console.log(`[ChatIntegration] –°–µ—Ä–≤–∏—Å ${e} —É–¥–∞–ª–µ–Ω`))}registerHandler(e){this.handlers.set(e.id,e),console.log(`[ChatIntegration] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ ${e.id} –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω`)}unregisterHandler(e){this.handlers.delete(e),console.log(`[ChatIntegration] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ ${e} —É–¥–∞–ª–µ–Ω`)}getHandler(e){return this.handlers.get(e)||null}getAllHandlers(){return Array.from(this.handlers.values())}getServiceHandlers(e){return Array.from(this.handlers.values()).filter(t=>t.serviceId===e)}processMessage(e,t){return v(this,null,function*(){const s=[],r=this.findMatchingHandlers(e);for(const i of r)try{const o=yield this.executeHandler(i.id,e,t);s.push(o)}catch(o){console.error(`[ChatIntegration] –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ ${i.id}:`,o)}return s})}executeHandler(e,t,s){return v(this,null,function*(){const r=this.handlers.get(e);if(!r)throw new Error(`–û–±—Ä–∞–±–æ—Ç—á–∏–∫ ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω`);if(!r.isEnabled)throw new Error(`–û–±—Ä–∞–±–æ—Ç—á–∏–∫ ${e} –æ—Ç–∫–ª—é—á–µ–Ω`);const i=Date.now();try{const o=yield r.handler(t,s),c=Date.now()-i;return o.metadata.processingTime=c,o.metadata.handlerId=e,this.eventListeners.onHandlerExecuted.forEach(h=>h(r,o)),this.eventListeners.onResponseGenerated.forEach(h=>h(o)),console.log(`[ChatIntegration] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ ${e} –≤—ã–ø–æ–ª–Ω–µ–Ω –∑–∞ ${c}ms`),o}catch(o){throw console.error(`[ChatIntegration] –û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ ${e}:`,o),o}})}registerChatButton(e){this.chatButtons.set(e.id,e),console.log(`[ChatIntegration] –ö–Ω–æ–ø–∫–∞ ${e.id} –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞`)}unregisterChatButton(e){this.chatButtons.delete(e),console.log(`[ChatIntegration] –ö–Ω–æ–ø–∫–∞ ${e} —É–¥–∞–ª–µ–Ω–∞`)}getChatButtons(e){const t=Array.from(this.chatButtons.values());return e?t.filter(s=>s.serviceId===e):t}onMessageReceived(e){this.eventListeners.onMessageReceived.push(e)}onResponseGenerated(e){this.eventListeners.onResponseGenerated.push(e)}onHandlerExecuted(e){this.eventListeners.onHandlerExecuted.push(e)}syncWithChat(){console.log("[ChatIntegration] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —á–∞—Ç–æ–º")}exportHandlers(e){return e?this.getServiceHandlers(e):this.getAllHandlers()}importHandlers(e){e.forEach(t=>{this.handlers.set(t.id,t)}),console.log(`[ChatIntegration] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${e.length} –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤`)}findMatchingHandlers(e){const t=[];for(const s of this.handlers.values()){if(!s.isEnabled)continue;s.triggers.some(i=>e.toLowerCase().includes(i.toLowerCase()))&&t.push(s)}return t.sort((s,r)=>r.priority-s.priority)}}const ne=new wt;class xt{constructor(){this.cache=new Map,this.loadingPromises=new Map}get(e){return this.cache.get(e)}set(e,t){this.cache.set(e,t)}isLoading(e){return this.loadingPromises.has(e)}setLoadingPromise(e,t){this.loadingPromises.set(e,t)}getLoadingPromise(e){return this.loadingPromises.get(e)}deleteLoadingPromise(e){this.loadingPromises.delete(e)}clear(){this.cache.clear(),this.loadingPromises.clear()}delete(e){this.cache.delete(e),this.loadingPromises.delete(e)}}class Tt{constructor(){this.cache=new xt,this.basePath="/services/modules/",this.configPath="/services/"}loadServiceConfig(e){return v(this,null,function*(){try{const t=yield fetch(`${this.configPath}${e}.json`);if(!t.ok)throw new Error(`Failed to load service config: ${t.statusText}`);return yield t.json()}catch(t){const s=t instanceof Error?t.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";console.error(`Error loading service config for ${e}:`,s);const r=new Error(`Failed to load service config for ${e}: ${s}`);throw t instanceof Error&&t.stack&&(r.stack=t.stack),r}})}loadServiceModule(e){return v(this,null,function*(){const t=this.cache.get(e);if(t)return t;const s=this.cache.getLoadingPromise(e);if(s)return s;const r=this.loadModuleFromPath(e);this.cache.setLoadingPromise(e,r);try{const i=yield r;return this.cache.set(e,i),this.cache.deleteLoadingPromise(e),i}catch(i){throw this.cache.deleteLoadingPromise(e),i}})}loadModuleFromPath(e){return v(this,null,function*(){try{const t=`${this.basePath}${e}/index.js`;{const s=yield fetch(t);if(!s.ok)throw new Error(`Failed to load module: ${s.statusText}`);const r=yield s.blob(),i=URL.createObjectURL(r);try{return(yield Ee(()=>import(i),[])).default}finally{URL.revokeObjectURL(i)}}}catch(t){return console.error(`Error loading service module ${e}:`,t),this.createFallbackModule(e)}})}createFallbackModule(e){return{initialize:()=>v(this,null,function*(){console.warn(`Service ${e} is using fallback module`)}),execute:(t,s)=>v(this,null,function*(){return console.warn(`Tool ${t} from service ${e} is not implemented`),{error:"Tool not implemented"}}),cleanup:()=>v(this,null,function*(){})}}preloadService(e){return v(this,null,function*(){try{yield this.loadServiceModule(e)}catch(t){console.warn(`Failed to preload service ${e}:`,t)}})}preloadServices(e){return v(this,null,function*(){const t=e.map(s=>this.preloadService(s));yield Promise.allSettled(t)})}unloadService(e){const t=this.cache.get(e);t&&t.cleanup&&t.cleanup().catch(s=>{console.error(`Error cleaning up service ${e}:`,s)}),this.cache.delete(e)}isServiceLoaded(e){return this.cache.get(e)!==void 0}isServiceLoading(e){return this.cache.isLoading(e)}getLoadedServices(){return Array.from(this.cache.cache.keys())}clearCache(){this.cache.clear()}setBasePath(e){this.basePath=e}setConfigPath(e){this.configPath=e}}const F=new Tt;class At{constructor(e={}){this.subscriptions=new Map,this.activeRequests=new Map,this.middleware=[],this.isRunningFlag=!1,this.eventBuffer=[],this.requestHandlers=new Map,this.config=l({maxConcurrentRequests:100,defaultTimeout:3e4,eventBufferSize:1e3,enableLogging:!0,enableMetrics:!0},e)}publish(e){if(!this.isRunningFlag){this.log("ServiceBus –Ω–µ –∑–∞–ø—É—â–µ–Ω, —Å–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –±—É—Ñ–µ—Ä"),this.eventBuffer.push(e);return}let t=e;for(const s of this.middleware.sort((r,i)=>r.priority-i.priority))if(s.beforeEvent){const r=s.beforeEvent(t);if(r===null){this.log(`–°–æ–±—ã—Ç–∏–µ ${e.id} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ middleware ${s.name}`);return}t=r}this.deliverEvent(t);for(const s of this.middleware.sort((r,i)=>r.priority-i.priority))s.afterEvent&&s.afterEvent(t);this.log(`–°–æ–±—ã—Ç–∏–µ ${e.id} –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ`)}subscribe(e,t){const s=this.generateId(),r={id:s,eventType:e,handler:t,serviceId:"unknown",createdAt:new Date};return this.subscriptions.set(s,r),this.log(`–ü–æ–¥–ø–∏—Å–∫–∞ ${s} —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏—è ${e}`),s}unsubscribe(e){this.subscriptions.get(e)&&(this.subscriptions.delete(e),this.log(`–ü–æ–¥–ø–∏—Å–∫–∞ ${e} —É–¥–∞–ª–µ–Ω–∞`))}request(e){return v(this,null,function*(){if(!this.isRunningFlag)throw new Error("ServiceBus –Ω–µ –∑–∞–ø—É—â–µ–Ω");if(this.activeRequests.size>=this.config.maxConcurrentRequests)throw new Error("–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤");let t=e;for(const r of this.middleware.sort((i,o)=>i.priority-o.priority))if(r.beforeRequest){const i=r.beforeRequest(t);if(i===null)throw new Error(`–ó–∞–ø—Ä–æ—Å ${e.id} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω middleware`);t=i}const s={id:e.id,method:e.method,source:e.source,target:e.target,status:"pending",createdAt:new Date};this.activeRequests.set(e.id,s);try{const r=`${e.target}:${e.method}`,i=this.requestHandlers.get(r);if(!i)throw new Error(`–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è ${e.target}:${e.method} –Ω–µ –Ω–∞–π–¥–µ–Ω`);const o=yield i(t);s.status="completed",s.completedAt=new Date;let c=o;for(const h of this.middleware.sort((d,m)=>d.priority-m.priority))if(h.afterResponse){const d=h.afterResponse(c);d&&(c=d)}return this.log(`–ó–∞–ø—Ä–æ—Å ${e.id} –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ`),c}catch(r){return s.status="error",s.completedAt=new Date,this.log(`–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ ${e.id}:`,r),{id:this.generateId(),requestId:e.id,success:!1,error:r instanceof Error?r.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",timestamp:new Date}}finally{this.activeRequests.delete(e.id)}})}respond(e,t,s){const r=`${e}:${t}`;this.requestHandlers.set(r,s),this.log(`–û–±—Ä–∞–±–æ—Ç—á–∏–∫ ${r} –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω`)}unrespond(e,t){const s=`${e}:${t}`;this.requestHandlers.delete(s),this.log(`–û–±—Ä–∞–±–æ—Ç—á–∏–∫ ${s} —É–¥–∞–ª–µ–Ω`)}addMiddleware(e){this.middleware.push(e),this.middleware.sort((t,s)=>t.priority-s.priority),this.log(`Middleware ${e.name} –¥–æ–±–∞–≤–ª–µ–Ω`)}removeMiddleware(e){const t=this.middleware.findIndex(s=>s.name===e);t!==-1&&(this.middleware.splice(t,1),this.log(`Middleware ${e} —É–¥–∞–ª–µ–Ω`))}start(){for(this.isRunningFlag=!0,this.log("ServiceBus –∑–∞–ø—É—â–µ–Ω");this.eventBuffer.length>0;){const e=this.eventBuffer.shift();e&&this.publish(e)}}stop(){this.isRunningFlag=!1,this.log("ServiceBus –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")}isRunning(){return this.isRunningFlag}getSubscriptions(){return Array.from(this.subscriptions.values())}getActiveRequests(){return Array.from(this.activeRequests.values())}getMiddleware(){return[...this.middleware]}deliverEvent(e){const t=Array.from(this.subscriptions.values()).filter(s=>s.eventType===e.type||s.eventType==="*");for(const s of t)try{s.handler(e)}catch(r){this.log(`–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–±—ã—Ç–∏—è ${s.id}:`,r)}}generateId(){return`sb_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}log(e,...t){this.config.enableLogging&&console.log(`[ServiceBus] ${e}`,...t)}}class It{constructor(e=!0,t=!0){this.enableEventLogging=e,this.enableRequestLogging=t,this.name="LoggingMiddleware",this.priority=100}beforeEvent(e){return this.enableEventLogging&&console.log(`[ServiceBus] –°–æ–±—ã—Ç–∏–µ: ${e.type} –æ—Ç ${e.source}`,{id:e.id,data:e.data,timestamp:e.timestamp}),e}afterEvent(e){return this.enableEventLogging&&console.log(`[ServiceBus] –°–æ–±—ã—Ç–∏–µ ${e.id} –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ`),e}beforeRequest(e){return this.enableRequestLogging&&console.log(`[ServiceBus] –ó–∞–ø—Ä–æ—Å: ${e.method} –æ—Ç ${e.source} –∫ ${e.target}`,{id:e.id,params:e.params,timestamp:e.timestamp}),e}afterResponse(e){return this.enableRequestLogging&&console.log(`[ServiceBus] –û—Ç–≤–µ—Ç: ${e.requestId}`,{success:e.success,data:e.data,error:e.error,timestamp:e.timestamp}),e}}class Ct{constructor(e=[],t=[],s=[],r=[]){this.allowedSources=e,this.blockedSources=t,this.allowedMethods=s,this.blockedMethods=r,this.name="SecurityMiddleware",this.priority=10}beforeEvent(e){return this.blockedSources.includes(e.source)?(console.warn(`[ServiceBus] –°–æ–±—ã—Ç–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –∏—Å—Ç–æ—á–Ω–∏–∫ ${e.source} –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ`),null):this.allowedSources.length>0&&!this.allowedSources.includes(e.source)?(console.warn(`[ServiceBus] –°–æ–±—ã—Ç–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –∏—Å—Ç–æ—á–Ω–∏–∫ ${e.source} –Ω–µ –≤ –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ`),null):e.ttl&&e.ttl<Date.now()-e.timestamp.getTime()?(console.warn(`[ServiceBus] –°–æ–±—ã—Ç–∏–µ ${e.id} –∏—Å—Ç–µ–∫–ª–æ`),null):(e.data&&(e.data=this.sanitizeData(e.data)),e)}afterEvent(e){return e}beforeRequest(e){return this.blockedSources.includes(e.source)?(console.warn(`[ServiceBus] –ó–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –∏—Å—Ç–æ—á–Ω–∏–∫ ${e.source} –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ`),null):this.allowedSources.length>0&&!this.allowedSources.includes(e.source)?(console.warn(`[ServiceBus] –ó–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –∏—Å—Ç–æ—á–Ω–∏–∫ ${e.source} –Ω–µ –≤ –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ`),null):this.blockedMethods.includes(e.method)?(console.warn(`[ServiceBus] –ó–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –º–µ—Ç–æ–¥ ${e.method} –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ`),null):this.allowedMethods.length>0&&!this.allowedMethods.includes(e.method)?(console.warn(`[ServiceBus] –ó–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –º–µ—Ç–æ–¥ ${e.method} –Ω–µ –≤ –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ`),null):(e.params&&(e.params=this.sanitizeData(e.params)),e)}afterResponse(e){return e.data&&(e.data=this.sanitizeData(e.data)),e}sanitizeData(e){if(typeof e=="string")return e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");if(Array.isArray(e))return e.map(t=>this.sanitizeData(t));if(e&&typeof e=="object"){const t={};for(const[s,r]of Object.entries(e))s.startsWith("__")||s.includes("prototype")||s.includes("constructor")||(t[s]=this.sanitizeData(r));return t}return e}}class _t{constructor(e=!1){this.strictMode=e,this.name="ValidationMiddleware",this.priority=50}beforeEvent(e){return!e.id||!e.type||!e.source?(console.error("[ServiceBus] –ù–µ–≤–∞–ª–∏–¥–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è"),null):this.isValidEventType(e.type)?e.data&&typeof e.data!="object"?(console.error("[ServiceBus] –î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),null):e:(console.error(`[ServiceBus] –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è: ${e.type}`),null)}afterEvent(e){return e}beforeRequest(e){return!e.id||!e.method||!e.source||!e.target?(console.error("[ServiceBus] –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è"),null):this.isValidMethod(e.method)?e.params&&typeof e.params!="object"?(console.error("[ServiceBus] –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),null):e:(console.error(`[ServiceBus] –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –º–µ—Ç–æ–¥: ${e.method}`),null)}afterResponse(e){return typeof e.success!="boolean"?(console.error("[ServiceBus] –ü–æ–ª–µ success –≤ –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±—É–ª–µ–≤—ã–º"),null):(!e.success&&!e.error&&console.warn("[ServiceBus] –ù–µ—É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è –æ—à–∏–±–∫–∏"),e)}isValidEventType(e){return["service.registered","service.unregistered","service.activated","service.deactivated","service.error","data.changed","user.action","system.notification"].includes(e)||e.startsWith("custom.")}isValidMethod(e){return["get","set","create","update","delete","execute","process","validate","transform"].includes(e)||e.includes(".")}}const D=new At({maxConcurrentRequests:100,defaultTimeout:3e4,eventBufferSize:1e3,enableLogging:!0,enableMetrics:!0});D.addMiddleware(new It);D.addMiddleware(new _t);D.addMiddleware(new Ct);D.start();class ee{static validateColorScheme(e){const t=[],s=[];for(const i of this.REQUIRED_COLOR_KEYS){if(!e[i]){t.push(`–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ü–≤–µ—Ç: ${i}`);continue}this.isValidColor(e[i])||t.push(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ü–≤–µ—Ç–∞ –¥–ª—è ${i}: ${e[i]}`)}const r=Object.entries(e).filter(([i])=>!this.REQUIRED_COLOR_KEYS.includes(i));for(const[i,o]of r)o&&!this.isValidColor(o)&&s.push(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ ${i}: ${o}`);return{isValid:t.length===0,errors:t,warnings:s.length>0?s:void 0}}static validateServiceTheme(e){const t=[],s=[];if(e.id?/^[a-zA-Z0-9-_]+$/.test(e.id)||t.push("ID —Ç–µ–º—ã —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã"):t.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ID —Ç–µ–º—ã"),e.name||t.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã"),!e.colors)t.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞");else{const r=this.validateColorScheme(e.colors);t.push(...r.errors),r.warnings&&s.push(...r.warnings)}if(e.variables)for(const[r,i]of Object.entries(e.variables))this.VALID_CSS_VARIABLE_PATTERN.test(r)||t.push(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è CSS –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π: ${r}`),typeof i!="string"&&t.push(`CSS –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${r} –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π`);if(e.animations)for(const[r,i]of Object.entries(e.animations))this.VALID_ANIMATION_PATTERN.test(r)||t.push(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è –∞–Ω–∏–º–∞—Ü–∏–∏: ${r}`),typeof i!="string"&&t.push(`–ê–Ω–∏–º–∞—Ü–∏—è ${r} –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π`);return{isValid:t.length===0,errors:t,warnings:s.length>0?s:void 0}}static validateCSSVariable(e,t){const s=[];return this.VALID_CSS_VARIABLE_PATTERN.test(e)||s.push(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è CSS –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π: ${e}`),typeof t!="string"&&s.push("–ó–Ω–∞—á–µ–Ω–∏–µ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π"),{isValid:s.length===0,errors:s}}static isValidColor(e){if(typeof e!="string")return!1;for(const t of this.VALID_COLOR_FORMATS)if(t.test(e))return!0;try{const t=new Option().style;return t.color=e,t.color!==""}catch(t){return!1}}static validateAnimation(e,t){const s=[];return this.VALID_ANIMATION_PATTERN.test(e)||s.push(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è –∞–Ω–∏–º–∞—Ü–∏–∏: ${e}`),typeof t!="string"&&s.push("–ó–Ω–∞—á–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π"),{isValid:s.length===0,errors:s}}static validateThemeConfig(e){const t=[];if(!e||typeof e!="object")return t.push("–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ–º—ã –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{isValid:!1,errors:t};const s=e;return(!s.id||typeof s.id!="string")&&t.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Ç–µ–º—ã"),(!s.name||typeof s.name!="string")&&t.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã"),{isValid:t.length===0,errors:t}}}ee.VALID_COLOR_FORMATS=[/^#[0-9A-Fa-f]{3}$/,/^#[0-9A-Fa-f]{6}$/,/^#[0-9A-Fa-f]{8}$/,/^rgb\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*\)$/,/^rgba\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*,\s*[\d.]+\s*\)$/,/^hsl\(\s*\d+\s*,\s*\d+%\s*,\s*\d+%\s*\)$/,/^hsla\(\s*\d+\s*,\s*\d+%\s*,\s*\d+%\s*,\s*[\d.]+\s*\)$/,/^var\(--[a-zA-Z0-9-]+\)$/,/^theme\(['"][^'"]+['"]\)$/];ee.REQUIRED_COLOR_KEYS=["primary","secondary","accent","background","text","border"];ee.VALID_CSS_VARIABLE_PATTERN=/^--[a-zA-Z0-9-]+$/;ee.VALID_ANIMATION_PATTERN=/^[a-zA-Z0-9-]+$/;class K{constructor(){this.changeQueue=[],this.isProcessing=!1,this.processingTimeout=null,this.config={defaultTheme:"dark",enableBatching:!0,enableValidation:!0,enableServiceThemes:!0,batchDelay:16},this.state={currentTheme:this.config.defaultTheme,serviceThemes:new Map,isProcessing:!1,changeQueue:[],listeners:new Set},this.initializeDefaultThemes()}static getInstance(){return K.instance||(K.instance=new K),K.instance}initializeDefaultThemes(){this.registerServiceTheme("light",{id:"light",name:"–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞",description:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞",colors:{primary:"#000000",secondary:"#f3f4f6",accent:"#000000",background:"#ffffff",surface:"#ffffff",text:"#000000",textSecondary:"#000000",border:"rgba(0,0,0,0.12)",muted:"#000000",destructive:"#ef4444",success:"#10b981",warning:"#f59e0b",info:"#000000"},variables:{"--background":"#ffffff","--foreground":"#000000","--primary":"#000000","--secondary":"#f3f4f6","--muted":"#000000","--border":"rgba(0,0,0,0.12)"}}),this.registerServiceTheme("dark",{id:"dark",name:"–¢–µ–º–Ω–∞—è —Ç–µ–º–∞",description:"–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞",colors:{primary:"#000000",secondary:"#1a1a1a",accent:"#000000",background:"#000000",surface:"#1a1a1a",text:"#ffffff",textSecondary:"#ffffff",border:"rgba(255,255,255,0.10)",muted:"#ffffff",destructive:"#ef4444",success:"#10b981",warning:"#f59e0b",info:"#000000"},variables:{"--background":"#000000","--foreground":"#ffffff","--primary":"#ffffff","--secondary":"#1a1a1a","--muted":"#ffffff","--border":"rgba(255,255,255,0.10)"}})}setTheme(e){this.state.currentTheme!==e&&(this.state.currentTheme=e,this.applyTheme(),this.notifyListeners())}getCurrentTheme(){return this.state.currentTheme}registerServiceTheme(e,t){if(this.config.enableValidation){const s=ee.validateServiceTheme(t);if(!s.isValid){console.error(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–µ–º—ã —Å–µ—Ä–≤–∏—Å–∞ ${e}:`,s.errors);return}}this.state.serviceThemes.set(e,t)}unregisterServiceTheme(e){this.state.serviceThemes.delete(e)}getServiceTheme(e){if(!e||typeof e!="string"){console.warn("Invalid serviceId provided to getServiceTheme:",e);return}return this.state.serviceThemes.get(e)}getAllThemes(){const e=[];return e.push({id:"light",name:"–°–≤–µ—Ç–ª–∞—è",type:"light",isDefault:!1,version:"1.0.0",description:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞"},{id:"dark",name:"–¢–µ–º–Ω–∞—è",type:"dark",isDefault:!0,version:"1.0.0",description:"–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞"}),this.state.serviceThemes.forEach((t,s)=>{e.push({id:`service-${s}`,name:t.name,type:"service",isServiceTheme:!0,serviceId:s,version:t.version||"1.0.0",author:t.author,description:t.description})}),e}applyTheme(){const e=document.documentElement,s=this.state.currentTheme;e.setAttribute("data-theme",s),this.applyThemeVariables(s)}applyThemeVariables(e){const t=document.documentElement;let s;if(e.startsWith("service-")){const r=e.replace("service-","");s=this.state.serviceThemes.get(r)}else s=this.state.serviceThemes.get(e);if(!s){console.warn(`–¢–µ–º–∞ ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);return}s.variables&&Object.entries(s.variables).forEach(([r,i])=>{t.style.setProperty(r,i)}),Object.entries(s.colors).forEach(([r,i])=>{t.style.setProperty(`--${r}`,i)}),s.animations&&Object.entries(s.animations).forEach(([r,i])=>{t.style.setProperty(`--animation-${r}`,i)})}queueThemeChange(e){if(!this.config.enableBatching){this.applyThemeChange(e);return}this.changeQueue.push(e),this.isProcessing||this.processChanges()}processChanges(){if(this.isProcessing||this.changeQueue.length===0)return;this.isProcessing=!0;const e=this.groupChanges(this.changeQueue);this.batchApplyChanges(e),this.changeQueue=[],this.isProcessing=!1,this.notifyListeners()}groupChanges(e){const t={attributes:{},variables:{},animations:{}};return e.forEach(s=>{switch(s.type){case"theme":t.attributes["data-theme"]=s.value;break;case"color":case"variable":t.variables[s.key]=s.value;break;case"animation":t.animations[s.key]=s.value;break}}),t}batchApplyChanges(e){requestAnimationFrame(()=>{const t=document.documentElement;Object.entries(e.attributes).forEach(([s,r])=>{t.setAttribute(s,r)}),Object.entries(e.variables).forEach(([s,r])=>{t.style.setProperty(s,r)}),Object.entries(e.animations).forEach(([s,r])=>{t.style.setProperty(`--animation-${s}`,r)})})}applyThemeChange(e){const t=document.documentElement;switch(e.type){case"theme":t.setAttribute("data-theme",e.value);break;case"color":case"variable":t.style.setProperty(e.key,e.value);break;case"animation":t.style.setProperty(`--animation-${e.key}`,e.value);break}}subscribe(e){return this.state.listeners.add(e),()=>{this.state.listeners.delete(e)}}notifyListeners(){const e=[...this.changeQueue];this.state.listeners.forEach(t=>{try{t(this.state.currentTheme,e)}catch(s){console.error("–û—à–∏–±–∫–∞ –≤ —Å–ª—É—à–∞—Ç–µ–ª–µ —Ç–µ–º—ã:",s)}})}updateConfig(e){this.config=l(l({},this.config),e)}getConfig(){return l({},this.config)}reset(){this.state.currentTheme=this.config.defaultTheme,this.state.serviceThemes.clear(),this.changeQueue=[],this.initializeDefaultThemes(),this.applyTheme()}getStats(){return{currentTheme:this.state.currentTheme,registeredThemes:this.state.serviceThemes.size,pendingChanges:this.changeQueue.length,listeners:this.state.listeners.size,isProcessing:this.state.isProcessing}}}const le=K.getInstance();class kt{constructor(){this.serviceIntegrations=new Map,this.workspaceItems=new Map,this.eventListeners={onItemCreated:[],onItemUpdated:[],onItemDeleted:[],onItemSelected:[]}}registerServiceIntegration(e){this.serviceIntegrations.set(e.serviceId,e),e.autoCreateItems&&e.workspaceItems.forEach(t=>{this.workspaceItems.set(t.id,t),this.eventListeners.onItemCreated.forEach(s=>s(t))}),console.log(`[WorkspaceIntegration] –°–µ—Ä–≤–∏—Å ${e.serviceId} –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω`)}unregisterServiceIntegration(e){const t=this.serviceIntegrations.get(e);t&&(t.workspaceItems.forEach(s=>{this.workspaceItems.delete(s.id),this.eventListeners.onItemDeleted.forEach(r=>r(s.id))}),this.serviceIntegrations.delete(e),console.log(`[WorkspaceIntegration] –°–µ—Ä–≤–∏—Å ${e} —É–¥–∞–ª–µ–Ω`))}createWorkspaceItem(e,t,s){const r=this.serviceIntegrations.get(e);if(!r)throw new Error(`–°–µ—Ä–≤–∏—Å ${e} –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω`);const i=r.itemTemplates.find(c=>c.id===t);if(!i)throw new Error(`–®–∞–±–ª–æ–Ω ${t} –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ ${e}`);const o=l({id:this.generateId(),name:i.name,type:i.type,icon:i.icon,description:i.description,content:s||i.template.content,metadata:{serviceId:e,createdAt:new Date,updatedAt:new Date,tags:i.tags,permissions:{read:!0,write:!0,delete:!0}}},i.template);return this.workspaceItems.set(o.id,o),this.eventListeners.onItemCreated.forEach(c=>c(o)),console.log(`[WorkspaceIntegration] –°–æ–∑–¥–∞–Ω —ç–ª–µ–º–µ–Ω—Ç ${o.name} –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ ${e}`),o}updateWorkspaceItem(e,t){const s=this.workspaceItems.get(e);if(!s)return!1;const r=b(l(l({},s),t),{metadata:b(l({},s.metadata),{updatedAt:new Date})});return this.workspaceItems.set(e,r),this.eventListeners.onItemUpdated.forEach(i=>i(r)),console.log(`[WorkspaceIntegration] –û–±–Ω–æ–≤–ª–µ–Ω —ç–ª–µ–º–µ–Ω—Ç ${e}`),!0}deleteWorkspaceItem(e){return this.workspaceItems.get(e)?(this.workspaceItems.delete(e),this.eventListeners.onItemDeleted.forEach(s=>s(e)),console.log(`[WorkspaceIntegration] –£–¥–∞–ª–µ–Ω —ç–ª–µ–º–µ–Ω—Ç ${e}`),!0):!1}getWorkspaceItem(e){return this.workspaceItems.get(e)||null}getServiceItems(e){return Array.from(this.workspaceItems.values()).filter(t=>t.metadata.serviceId===e)}getAllItems(){return Array.from(this.workspaceItems.values())}getItemTemplates(e){const t=this.serviceIntegrations.get(e);return t?t.itemTemplates:[]}onItemCreated(e){this.eventListeners.onItemCreated.push(e)}onItemUpdated(e){this.eventListeners.onItemUpdated.push(e)}onItemDeleted(e){this.eventListeners.onItemDeleted.push(e)}onItemSelected(e){this.eventListeners.onItemSelected.push(e)}syncWithPlatform(){console.log("[WorkspaceIntegration] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π")}exportItems(e){return e?this.getServiceItems(e):this.getAllItems()}importItems(e){e.forEach(t=>{this.workspaceItems.set(t.id,t),this.eventListeners.onItemCreated.forEach(s=>s(t))}),console.log(`[WorkspaceIntegration] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${e.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤`)}generateId(){return`ws_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const oe=new kt;class Nt{constructor(){this.services=[],this.hasLoadedOnce=!1,this.isLoading=!1}validateAndNormalizeConfig(e){try{const t=l({},e);Array.isArray(t.tools)&&(t.tools=t.tools.map(i=>{const o=l({},i);return o.action||(o.action=o.id),o.action!==o.id&&console.warn(`[services] Tool action differs from id in service ${t.id}: tool.id='${o.id}', action='${o.action}'`),o})),Array.isArray(t.chatFunctions)&&(t.chatFunctions=t.chatFunctions.map(i=>{const o=l({},i);return o.id||console.warn(`[services] Chat function without id in service ${t.id}`),(!("action"in o)||!o.action)&&(o.action=o.id),o.action&&o.id&&o.action!==o.id&&console.warn(`[services] Chat function action differs from id in service ${t.id}: id='${o.id}', action='${o.action}'`),o.isChatFunction=!0,o}));const s=new Set,r=new Set;return(t.tools||[]).forEach(i=>{s.add(i.id),r.add(i.action||i.id)}),(t.chatFunctions||[]).forEach(i=>{s.add(i.id),r.add(i.action||i.id)}),Array.isArray(t.chatButtons)&&(t.chatButtons=t.chatButtons.map(i=>{const o=l({},i);return!o.isEnabled&&o.isEnabled!==!1&&(o.isEnabled=!0),o.position!=="top"&&o.position!=="bottom"&&(o.position!==void 0&&console.warn(`[services] Invalid chatButton.position '${o.position}' in service ${t.id}, defaulting to 'top'`),o.position="top"),o.action&&!(s.has(o.action)||r.has(o.action))&&console.warn(`[services] chatButton.action '${o.action}' not found in tools/chatFunctions of service ${t.id}`),o})),t}catch(t){return console.warn(`[services] Validation failed for service ${e.id}:`,t),e}}loadAllServices(){return v(this,null,function*(){try{if(this.isLoading){console.log("[ServiceManager] –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º");return}if(this.hasLoadedOnce&&this.services.length>0){console.log("[ServiceManager] –°–µ—Ä–≤–∏—Å—ã —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É");return}this.isLoading=!0,console.log("[ServiceManager] –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Ä–≤–∏—Å–æ–≤..."),this.services=[];const e=["ai-assistant.json","example-service.json","file-manager.json","settings.json","chatgpt-service.json","widgets-service.json","prompts-service.json","real-speech-service.json","ozon-manager.json","photo-studio.json"];for(const t of e)try{const s=yield fetch(`/services/${t}`);if(!s.ok){console.warn(`–§–∞–π–ª —Å–µ—Ä–≤–∏—Å–∞ ${t} –Ω–µ –Ω–∞–π–¥–µ–Ω`);continue}const r=yield s.json(),i=this.validateAndNormalizeConfig(r),o={config:i,module:null,isLoaded:!1};this.services.some(c=>c.config.id===i.id)||(this.services.push(o),i.theme&&le.registerServiceTheme(i.id,i.theme))}catch(s){const r=s instanceof Error?s.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ ${t}:`,r),s instanceof Error&&s.stack&&console.error("Stack trace:",s.stack)}this.hasLoadedOnce=!0,console.log("[ServiceManager] –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤:",e)}finally{this.isLoading=!1}})}loadServiceFromFile(e){return v(this,null,function*(){try{const t=yield fetch(`/services/${e}`);if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=yield t.json(),i={config:this.validateAndNormalizeConfig(s),module:null,isLoaded:!1};(s.id==="settings"||s.category==="settings")&&this.services.push(i)}catch(t){console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ ${e}:`,t)}})}loadService(e){return v(this,null,function*(){let t=this.services.find(s=>s.config.id===e);if(!t)try{const s=this.validateAndNormalizeConfig(yield F.loadServiceConfig(e));t={config:s,module:null,isLoaded:!1},this.services.push(t),s.theme&&le.registerServiceTheme(s.id,s.theme)}catch(s){throw console.error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–∞ ${e}:`,s),new Error(`–°–µ—Ä–≤–∏—Å ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω`)}if(!t.isLoaded)try{const s=yield F.loadServiceModule(e);s.initialize&&(yield s.initialize()),t.module=s,t.isLoaded=!0,t.error=void 0}catch(s){throw t.error=s instanceof Error?s.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ ${e}:`,s),s}})}unloadService(e){const t=this.services.find(s=>s.config.id===e);t&&(t.module&&t.module.cleanup&&t.module.cleanup().catch(s=>{console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–∏—Å–∞ ${e}:`,s)}),t.isLoaded=!1,t.module=null,F.unloadService(e))}getService(e){return this.services.find(t=>t.config.id===e)}getAllServices(){return this.services}executeTool(e,t,s){return v(this,null,function*(){const r=this.getService(e);if(!r)throw new Error(`–°–µ—Ä–≤–∏—Å ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω`);const i=r.config.tools.find(o=>o.id===t);if(!i)throw new Error(`–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${t} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–µ—Ä–≤–∏—Å–µ ${e}`);if(!i.isEnabled)throw new Error(`–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${t} –æ—Ç–∫–ª—é—á–µ–Ω`);if(i.isChatFunction)return yield this.executeChatFunction(r,i,s);if(r.isLoaded||(yield this.loadService(e)),r.module&&r.module.execute)try{return yield r.module.execute(t,l(l({},i),s))}catch(o){throw console.error(`–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ ${t} —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å:`,o),o}return{success:!0,message:`–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${i.name} –≤—ã–ø–æ–ª–Ω–µ–Ω`,data:null}})}executeChatFunction(e,t,s){return v(this,null,function*(){try{if(t.chatApiEndpoint&&e.config.chatApiBaseUrl){const r=yield fetch(`${e.config.chatApiBaseUrl}${t.chatApiEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.config.chatApiKey||""}`},body:JSON.stringify(l({prompt:t.chatPrompt||t.description,serviceId:e.config.id,toolId:t.id},s))});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const i=yield r.json();return{success:!0,message:`–ß–∞—Ç —Ñ—É–Ω–∫—Ü–∏—è ${t.name} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞`,data:i,isChatResponse:!0}}return{success:!0,message:`–ß–∞—Ç —Ñ—É–Ω–∫—Ü–∏—è ${t.name} –≥–æ—Ç–æ–≤–∞ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é`,data:{prompt:t.chatPrompt||t.description,serviceId:e.config.id,toolId:t.id},isChatResponse:!0}}catch(r){throw console.error(`–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —á–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏ ${t.name}:`,r),r}})}getChatButtons(){const e=[];return this.services.filter(t=>t.config.isActive).forEach(t=>{t.config.chatButtons&&e.push(...t.config.chatButtons.filter(s=>s.isEnabled))}),e}validateAllServices(){try{this.services.forEach(e=>{e.config=this.validateAndNormalizeConfig(e.config)})}catch(e){console.warn("[services] Validation pass failed:",e)}}getChatButtonsGrouped(){const e=[],t=[];return this.services.filter(s=>s.config.isActive).forEach(s=>{const r=(s.config.chatButtons||[]).filter(c=>c.isEnabled);if(r.length===0)return;const i=r.filter(c=>(c.position||"top")==="top"),o=r.filter(c=>(c.position||"top")==="bottom");i.length>0&&e.push({serviceId:s.config.id,serviceName:s.config.name,serviceIcon:s.config.icon,buttons:i}),o.length>0&&t.push({serviceId:s.config.id,serviceName:s.config.name,serviceIcon:s.config.icon,buttons:o})}),{top:e,bottom:t}}findChatFunctionInService(e,t){const s=(e.config.chatFunctions||[]).find(i=>i.isChatFunction&&i.isEnabled&&(i.id===t||i.action===t));return s||e.config.tools.find(i=>i.isChatFunction&&i.isEnabled&&(i.id===t||i.action===t))}executeChatButton(e,t,s){return v(this,null,function*(){const r=this.getService(e);if(!r)throw new Error(`–°–µ—Ä–≤–∏—Å ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω`);const i=this.findChatFunctionInService(r,t.action||t.id);return i?this.executeTool(r.config.id,i.id,s):{success:!1,message:`–ù–µ –Ω–∞–π–¥–µ–Ω–∞ —á–∞—Ç-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ ${t.name}`}})}getChatFunctions(){const e=[];return this.services.filter(t=>t.config.isActive&&t.isLoaded).forEach(t=>{t.config.chatFunctions&&e.push(...t.config.chatFunctions.filter(s=>s.isEnabled)),e.push(...t.config.tools.filter(s=>s.isChatFunction&&s.isEnabled))}),e}getActiveServices(){return this.services.filter(e=>e.config.isActive&&e.isLoaded)}getSortedServices(){return[...this.services].sort((e,t)=>e.config.priority-t.config.priority)}preloadService(e){return v(this,null,function*(){try{yield F.preloadService(e)}catch(t){console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–∏—Å ${e}:`,t)}})}preloadServices(e){return v(this,null,function*(){yield F.preloadServices(e)})}isServiceLoaded(e){const t=this.getService(e);return t?t.isLoaded:!1}isServiceLoading(e){return F.isServiceLoading(e)}getLoadedServices(){return this.services.filter(e=>e.isLoaded).map(e=>e.config.id)}registerWorkspaceIntegration(e,t,s=!0){oe.registerServiceIntegration({serviceId:e,workspaceItems:t,autoCreateItems:s,itemTemplates:[],eventHandlers:{onItemCreate:r=>{console.log(`[ServiceManager] –°–æ–∑–¥–∞–Ω —ç–ª–µ–º–µ–Ω—Ç Workspace: ${r.name}`)},onItemUpdate:r=>{console.log(`[ServiceManager] –û–±–Ω–æ–≤–ª–µ–Ω —ç–ª–µ–º–µ–Ω—Ç Workspace: ${r.name}`)},onItemDelete:r=>{console.log(`[ServiceManager] –£–¥–∞–ª–µ–Ω —ç–ª–µ–º–µ–Ω—Ç Workspace: ${r}`)},onItemSelect:r=>{console.log(`[ServiceManager] –í—ã–±—Ä–∞–Ω —ç–ª–µ–º–µ–Ω—Ç Workspace: ${r.name}`)}}})}createWorkspaceItem(e,t,s){return oe.createWorkspaceItem(e,t,s)}getServiceWorkspaceItems(e){return oe.getServiceItems(e)}syncWorkspace(){oe.syncWithPlatform()}registerChatIntegration(e,t,s){ne.registerServiceIntegration({serviceId:e,handlers:t,chatButtons:s,autoRegister:!0,eventHandlers:{onMessageReceived:r=>{console.log(`[ServiceManager] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ ${e}:`,r)},onResponseGenerated:r=>{console.log(`[ServiceManager] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –æ—Ç–≤–µ—Ç –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ ${e}:`,r)},onHandlerExecuted:(r,i)=>{console.log(`[ServiceManager] –í—ã–ø–æ–ª–Ω–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ ${r.name} –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ ${e}`)}}})}getServiceChatButtons(e){return ne.getChatButtons(e)}getServiceChatHandlers(e){return ne.getServiceHandlers(e)}syncChat(){ne.syncWithChat()}createServiceChannel(e,t,s){return null}sendServiceMessage(e,t,s="message"){return null}getServiceStatus(e){return null}setServiceStatus(e,t){}syncServiceData(e,t){}getServiceData(e){return null}getServiceCommunicationStats(){return null}publishEvent(e,t,s="ServiceManager"){D.publish({id:`sm_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,source:s,data:t,timestamp:new Date,priority:"normal"})}subscribeToEvents(e,t){return D.subscribe(e,t)}requestFromService(e,t,s){return v(this,null,function*(){const r=yield D.request({id:`sm_req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,method:t,params:s,source:"ServiceManager",target:e,timestamp:new Date});if(!r.success)throw new Error(r.error||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");return r.data})}registerServiceHandler(e,t,s){D.respond(e,t,r=>v(this,null,function*(){try{const i=yield s(r.params);return{id:`sm_resp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,requestId:r.id,success:!0,data:i,timestamp:new Date}}catch(i){return{id:`sm_resp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,requestId:r.id,success:!1,error:i instanceof Error?i.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",timestamp:new Date}}}))}}const P=new Nt;class Lt{constructor(){this.config={enableSystemCommands:!0,enableServiceRouting:!0,enableContextAnalysis:!0,maxHistoryLength:50,responseTimeout:3e4},this.context={activeService:null,activeSection:"workspace",conversationHistory:[],userPreferences:{},lastActivity:new Date}}processMessage(e,t=null,s="workspace"){return v(this,null,function*(){try{this.updateContext(t,s);const r=Et.getContextForAI(),i=yield this.analyzeIntentWithContext(e,r);return this.config.enableSystemCommands&&i.isSystemCommand?yield this.handleSystemCommand(e,i):this.config.enableServiceRouting&&i.shouldRouteToService&&i.serviceId?yield this.routeToService(e,{serviceId:i.serviceId,toolId:i.toolId,shouldRouteToService:i.shouldRouteToService}):yield this.handleGeneralQueryWithContext(e,i,r)}catch(r){return console.error("AI Brain error:",r),{success:!1,message:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è",isSystemResponse:!0}}})}analyzeIntentWithContext(e,t){return v(this,null,function*(){const s=yield this.analyzeIntent(e);return t.attachedItems.length>0&&(s.confidence=Math.min(s.confidence+.2,1),t.attachedItems.some(r=>r.type==="document")&&(s.serviceId||(s.serviceId="ai-assistant",s.shouldRouteToService=!0))),t.activeProject&&s.keywords.push(`–ø—Ä–æ–µ–∫—Ç:${t.activeProject.title}`),s})}analyzeIntent(e){return v(this,null,function*(){const t=e.toLowerCase(),s=this.extractKeywords(t),i=["–Ω–∞—Å—Ç—Ä–æ–π–∫–∏","settings","–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è","config","–ø–æ–º–æ—â—å","help","—Å–ø—Ä–∞–≤–∫–∞","–∫–æ–º–∞–Ω–¥—ã","–≤—ã—Ö–æ–¥","exit","–∑–∞–∫—Ä—ã—Ç—å","close","–æ—á–∏—Å—Ç–∏—Ç—å","clear","—Å–±—Ä–æ—Å","reset"].some(f=>t.includes(f)),o=[{service:"chatgpt-service",keywords:["chatgpt","gpt","openai","–∏–∏","ai","—á–∞—Ç","–ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å","rewrite","–∫—Ä–∞—Ç–∫–æ","summary","–ø–µ—Ä–µ–≤–µ—Å—Ç–∏","translate"]},{service:"settings",keywords:["–Ω–∞—Å—Ç—Ä–æ–π–∫–∏","settings","–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è","config","—Ç–µ–º–∞","theme","—Ü–≤–µ—Ç","color","–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å","interface","—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è","notifications"]},{service:"whisper-service",keywords:["–≥–æ–ª–æ—Å","voice","–º–∏–∫—Ä–æ—Ñ–æ–Ω","mic","–≥–æ–≤–æ—Ä–∏—Ç—å","speak","—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è","transcription","–∑–∞–ø–∏—Å–∞—Ç—å","record"]},{service:"ai-assistant",keywords:["–ø–æ–º–æ—â—å","help","–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç","assistant"]}];let c=!1,h,d,m=0;for(const f of o){const y=f.keywords.filter(w=>t.includes(w)).length;if(y>0){const w=y/f.keywords.length;w>m&&(m=w,h=f.service,c=!0,f.service==="chatgpt-service"?t.includes("–ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å")||t.includes("rewrite")?d="text-rewrite":t.includes("–∫—Ä–∞—Ç–∫–æ")||t.includes("summary")?d="summarize-text":t.includes("–ø–µ—Ä–µ–≤–µ—Å—Ç–∏")||t.includes("translate")?d="translate-chatgpt":d="chat-completion":f.service==="settings"?t.includes("—Ç–µ–º–∞")||t.includes("theme")?d="toggle-theme":t.includes("–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å")||t.includes("interface")?d="interface":t.includes("—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è")||t.includes("notifications")?d="notifications":t.includes("—á–∞—Ç")||t.includes("chat")?d="chat":t.includes("–≤–Ω–µ—à–Ω–∏–π –≤–∏–¥")||t.includes("appearance")?d="appearance":d="open-preferences":f.service==="whisper-service"&&(t.includes("–≥–æ–ª–æ—Å")||t.includes("voice")||t.includes("–º–∏–∫—Ä–æ—Ñ–æ–Ω")||t.includes("mic")?d="realtime-transcription":t.includes("—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è")||t.includes("transcription")?d="audio-transcription":t.includes("–∫–æ–º–∞–Ω–¥–∞")||t.includes("command")?d="voice-commands":d="realtime-transcription"))}}return{isSystemCommand:i,shouldRouteToService:c,serviceId:h,toolId:d,confidence:m,keywords:s}})}handleSystemCommand(e,t){return v(this,null,function*(){const s=e.toLowerCase();return s.includes("–ø–æ–º–æ—â—å")||s.includes("help")?{success:!0,message:this.getHelpMessage(),isSystemResponse:!0}:s.includes("–æ—á–∏—Å—Ç–∏—Ç—å")||s.includes("clear")?(this.context.conversationHistory=[],{success:!0,message:"–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –æ—á–∏—â–µ–Ω–∞",isSystemResponse:!0}):s.includes("–Ω–∞—Å—Ç—Ä–æ–π–∫–∏")||s.includes("settings")?yield this.routeToService(e,{serviceId:"settings",toolId:"open-preferences",shouldRouteToService:!0}):{success:!0,message:"–°–∏—Å—Ç–µ–º–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞",isSystemResponse:!0}})}routeToService(e,t){return v(this,null,function*(){if(!t.serviceId)return{success:!1,message:"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏",isSystemResponse:!0};try{const s=P.getService(t.serviceId);if(!s)return{success:!1,message:`–°–µ—Ä–≤–∏—Å ${t.serviceId} –Ω–µ –Ω–∞–π–¥–µ–Ω`,isSystemResponse:!0};if(s.isLoaded||(yield P.loadService(t.serviceId)),t.toolId){const o=yield P.executeTool(t.serviceId,t.toolId);return{success:!0,message:`–°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–µ—Ä–≤–∏—Å–æ–º ${s.config.name}`,data:o,serviceId:t.serviceId,toolId:t.toolId,shouldRouteToService:!0}}const i=P.getChatFunctions().find(o=>o.isChatFunction);if(i){const o=yield P.executeTool(t.serviceId,i.id);return{success:!0,message:`–°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–µ—Ä–≤–∏—Å–æ–º ${s.config.name}`,data:o,serviceId:t.serviceId,toolId:i.id,shouldRouteToService:!0}}return{success:!0,message:`–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ —Å–µ—Ä–≤–∏—Å–æ–º ${s.config.name}`,serviceId:t.serviceId,shouldRouteToService:!0}}catch(s){return console.error("Service routing error:",s),{success:!1,message:`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–∏—Å—É: ${s instanceof Error?s.message:"Unknown error"}`,isSystemResponse:!0}}})}handleGeneralQueryWithContext(e,t,s){return v(this,null,function*(){if(s.attachedItems.length>0||s.activeProject){const r=this.buildContextInfo(s),i=`${e}

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
${r}`;try{const o=P.getService("ai-assistant");if(o&&o.isLoaded)return{success:!0,message:`–ó–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: ${s.contextSummary}`,serviceId:"ai-assistant",shouldRouteToService:!0,data:{enhancedMessage:i,contextInfo:r}}}catch(o){console.error("–û—à–∏–±–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∫ AI Assistant:",o)}}return yield this.handleGeneralQuery(e,t)})}buildContextInfo(e){const t=[];if(e.activeProject&&t.push(`–ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç: ${e.activeProject.title}`),e.attachedItems.length>0){const s=e.attachedItems.map(r=>`${r.type}: ${r.title}${r.content?`
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ: ${r.content.substring(0,200)}...`:""}`).join(`

`);t.push(`–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:
${s}`)}return t.join(`

`)}handleGeneralQuery(e,t){return v(this,null,function*(){return this.context.activeSection==="workspace"?{success:!0,message:"–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º –º–æ–∑–≥–æ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã",isSystemResponse:!0}:this.context.activeService?{success:!0,message:`–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ —Å–µ—Ä–≤–∏—Å–æ–º ${this.context.activeService}`,serviceId:this.context.activeService,shouldRouteToService:!0}:{success:!0,message:"–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π",isSystemResponse:!0}})}updateContext(e,t){this.context.activeService=e,this.context.activeSection=t,this.context.lastActivity=new Date}extractKeywords(e){return e.split(/\s+/).filter(s=>s.length>2)}getHelpMessage(){return`üß† **BARSUKOV PLATFORM - AI BRAIN**

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

ü§ñ **ChatGPT —Å–µ—Ä–≤–∏—Å**
- "ChatGPT, –ø–æ–º–æ–≥–∏ —Å..." - –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ ChatGPT
- "–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç" - –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Å –ø–æ–º–æ—â—å—é GPT
- "–ö—Ä–∞—Ç–∫–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ" - —Å–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Ç–∫–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ
- "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç" - –ø–µ—Ä–µ–≤–æ–¥ —Å –ø–æ–º–æ—â—å—é GPT

üé§ **Whisper AI (–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥)**
- "–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥" - –Ω–∞—á–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
- "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è" - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ä–µ—á—å –≤ —Ç–µ–∫—Å—Ç
- "–ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã" - –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –ù–∞–∂–º–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω –¥–ª—è –∂–∏–≤–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞

‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**
- "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" - –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- "–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É" - –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
- "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞" - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π" - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

üìÅ **–†–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ**
- –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º –º–æ–∑–≥–æ–º
- –£–º–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ —Å–µ—Ä–≤–∏—Å–∞–º

üîß **–°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã**
- "–ü–æ–º–æ—â—å" - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
- "–û—á–∏—Å—Ç–∏—Ç—å" - –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

üí° **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
2. AI-–º–æ–∑–≥ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏—è
3. –°–æ–æ–±—â–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫ –Ω—É–∂–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É
4. –ü–æ–ª—É—á–∞–µ—Ç–µ –æ—Ç–≤–µ—Ç –æ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

üéØ **–°–æ–≤–µ—Ç—ã:**
- –ë—É–¥—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è
- –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–∞—Ö`}addMessageToHistory(e){this.context.conversationHistory.push(e),this.context.conversationHistory.length>this.config.maxHistoryLength&&(this.context.conversationHistory=this.context.conversationHistory.slice(-this.config.maxHistoryLength))}getContext(){return l({},this.context)}updateConfig(e){this.config=l(l({},this.config),e)}clearContext(){this.context={activeService:null,activeSection:"workspace",conversationHistory:[],userPreferences:{},lastActivity:new Date}}}const me=new Lt;class R{static hexToHsl(e){const t=parseInt(e.slice(1,3),16)/255,s=parseInt(e.slice(3,5),16)/255,r=parseInt(e.slice(5,7),16)/255,i=Math.max(t,s,r),o=Math.min(t,s,r);let c=0,h=0;const d=(i+o)/2;if(i!==o){const m=i-o;switch(h=d>.5?m/(2-i-o):m/(i+o),i){case t:c=(s-r)/m+(s<r?6:0);break;case s:c=(r-t)/m+2;break;case r:c=(t-s)/m+4;break}c/=6}return{h:c*360,s:h*100,l:d*100}}static hslToHex(e,t,s){const r=e/360,i=t/100,o=s/100,c=(y,w,A)=>(A<0&&(A+=1),A>1&&(A-=1),A<1/6?y+(w-y)*6*A:A<1/2?w:A<2/3?y+(w-y)*(2/3-A)*6:y);let h,d,m;if(i===0)h=d=m=o;else{const y=o<.5?o*(1+i):o+i-o*i,w=2*o-y;h=c(w,y,r+1/3),d=c(w,y,r),m=c(w,y,r-1/3)}const f=y=>{const w=Math.round(y*255).toString(16);return w.length===1?"0"+w:w};return`#${f(h)}${f(d)}${f(m)}`}static getLuminance(e){const t=this.hexToRgb(e);if(!t)return 0;const{r:s,g:r,b:i}=t,[o,c,h]=[s,r,i].map(d=>(d=d/255,d<=.03928?d/12.92:Math.pow((d+.055)/1.055,2.4)));return .2126*o+.7152*c+.0722*h}static hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}static generateSurfaceColor(e){const t=this.hexToHsl(e);return t.l>50?this.hslToHex(t.h,t.s,Math.max(t.l-5,10)):this.hslToHex(t.h,t.s,Math.min(t.l+5,90))}static generateBorderColor(e,t){return`rgba(${t?"0,0,0":"255,255,255"}, ${t?.12:.1})`}static generateButtonColors(e,t){const s=this.hexToHsl(e),i=this.hexToHsl(t).l>50;return{primary:e,secondary:this.hslToHex(s.h,s.s,i?Math.min(s.l+20,90):Math.max(s.l-20,10)),hover:this.hslToHex(s.h,s.s,i?Math.max(s.l-10,20):Math.min(s.l+10,80))}}static generateColorScheme(e){const t=this.hexToHsl(e),s=t.l>50,r=this.hslToHex(t.h,Math.min(t.s+10,100),Math.max(t.l-40,5)),i=t.l>90,o=i?"#111827":"#e5e7eb",c=i?"#6b7280":"#9ca3af";return{primary:e,background:r,surface:this.generateSurfaceColor(r),text:o,textSecondary:c,border:this.generateBorderColor(r,s),success:"#10b981",error:"#ef4444"}}static createCustomThemeVariables(e){const t=this.generateColorScheme(e),r=this.hexToHsl(e).l>50;return{"--primary":t.primary,"--background":t.background,"--surface":t.surface,"--text":t.text,"--text-secondary":t.textSecondary,"--border":t.border,"--focus-ring":e,"--focus-border":e,"--selection-bg":r?"#f3f4f6":"#374151","--selection-text":t.text,"--highlight-bg":r?"#f3f4f6":"#374151","--highlight-text":t.text,"--gradient-divider":`linear-gradient(to right, transparent, ${e}, transparent)`,"--gradient-divider-light":`linear-gradient(to right, transparent, ${e}30, transparent)`}}static getContrastIconColor(e){return this.getLuminance(e)>.5?"#111827":"#e5e7eb"}static getContrastIconColorForAccent(e,t=!0){const s=this.getLuminance(e);return t?s>.9?"#111827":"#e5e7eb":s<.1?"#e5e7eb":"#111827"}static getCustomVariablesToRemove(){return["--primary","--background","--surface","--text","--text-secondary","--border","--focus-ring","--focus-border","--selection-bg","--selection-text","--highlight-bg","--highlight-text","--gradient-divider","--gradient-divider-light"]}}class ae{static applyDarkAccent(e){const t=document.documentElement;let s;if(e.darkAccentHue===0&&e.lightAccentHue===0&&e.darkBrightness===50&&e.lightBrightness===50)s="#ffffff";else{const c=Math.round(50*(e.darkBrightness/100));s=this.hslToHex(e.darkAccentHue,100,c)}if(e.brightnessOverlay){const o=Math.round(4*(e.darkBrightness/100)),c=Math.round(10*(e.darkBrightness/100));t.style.setProperty("--background",`hsl(0, 0%, ${o}%)`),t.style.setProperty("--surface",`hsl(0, 0%, ${c}%)`)}else t.style.removeProperty("--background"),t.style.removeProperty("--surface");const i=R.getContrastIconColorForAccent(s,!0);t.style.setProperty("--accent-color",s,"important"),t.style.setProperty("--accent",s,"important"),t.style.setProperty("--focus-ring",s,"important"),t.style.setProperty("--icon-accent",i,"important"),t.style.setProperty("--icon-primary","#e5e7eb","important"),t.style.setProperty("--icon-secondary","#d1d5db","important"),t.style.setProperty("--icon-muted","#9ca3af","important"),t.style.setProperty("--border-active",s,"important"),t.style.setProperty("--selection-bg",`${s}20`,"important"),t.style.setProperty("--slider-active",s,"important"),t.style.setProperty("--slider-thumb",s,"important"),t.style.setProperty("--indicator-border",s,"important"),t.style.setProperty("--indicator-shadow",s,"important"),t.style.setProperty("--indicator-bg","#ffffff","important"),t.classList.remove("theme-accent-light"),t.classList.add("theme-accent-dark")}static applyLightAccent(e){const t=document.documentElement;let s;if(e.darkAccentHue===0&&e.lightAccentHue===0&&e.darkBrightness===50&&e.lightBrightness===50)s="#000000";else{const o=Math.round(20*(e.lightBrightness/100));s=this.hslToHex(e.lightAccentHue,100,o)}if(e.brightnessOverlay){const i=Math.round(100-20*(e.lightBrightness/100)),o=Math.round(98-10*(e.lightBrightness/100));t.style.setProperty("--background",`hsl(0, 0%, ${i}%)`),t.style.setProperty("--surface",`hsl(0, 0%, ${o}%)`)}else t.style.removeProperty("--background"),t.style.removeProperty("--surface");t.style.setProperty("--accent-color",s,"important"),t.style.setProperty("--accent",s,"important"),t.style.setProperty("--focus-ring",s,"important"),t.style.setProperty("--icon-accent",s,"important"),t.style.setProperty("--icon-primary","#111827","important"),t.style.setProperty("--icon-secondary","#6b7280","important"),t.style.setProperty("--icon-muted","#9ca3af","important"),t.style.setProperty("--border-active",s,"important"),t.style.setProperty("--selection-bg",`${s}20`,"important"),t.style.setProperty("--slider-active",s,"important"),t.style.setProperty("--slider-thumb",s,"important"),t.style.setProperty("--indicator-border",s,"important"),t.style.setProperty("--indicator-shadow",s,"important"),t.classList.remove("theme-accent-dark"),t.classList.add("theme-accent-light")}static applyCustomAccent(e){const t=document.documentElement;let s;e.darkAccentHue===0&&e.lightAccentHue===0&&e.darkBrightness===50&&e.lightBrightness===50?s="#ffffff":s=this.hslToHex(e.darkAccentHue,100,50),t.style.removeProperty("--global-brightness");const i=R.getContrastIconColorForAccent(s,!1);t.style.setProperty("--accent-color",s,"important"),t.style.setProperty("--accent",s,"important"),t.style.setProperty("--focus-ring",s,"important"),t.style.setProperty("--icon-accent",i,"important"),t.style.setProperty("--icon-primary",i,"important"),t.style.setProperty("--icon-secondary",i,"important"),t.style.setProperty("--icon-muted",i,"important"),t.style.setProperty("--border-active",s,"important"),t.style.setProperty("--selection-bg",`${s}20`,"important"),t.style.setProperty("--slider-active",s,"important"),t.style.setProperty("--slider-thumb",s,"important"),t.style.setProperty("--indicator-border",s,"important"),t.style.setProperty("--indicator-shadow",s,"important"),t.style.setProperty("--indicator-bg","#ffffff","important"),t.classList.remove("theme-accent-light","theme-accent-dark"),t.classList.add("theme-accent-custom")}static resetAccentColors(){const e=document.documentElement;e.style.removeProperty("--accent-color"),e.style.removeProperty("--accent"),e.style.removeProperty("--button-primary"),e.style.removeProperty("--focus-ring"),e.style.removeProperty("--icon-accent"),e.style.removeProperty("--icon-primary"),e.style.removeProperty("--icon-secondary"),e.style.removeProperty("--icon-muted"),e.style.removeProperty("--border-active"),e.style.removeProperty("--selection-bg"),e.style.removeProperty("--slider-active"),e.style.removeProperty("--slider-thumb"),e.style.removeProperty("--indicator-border"),e.style.removeProperty("--indicator-shadow"),e.classList.remove("theme-accent-dark","theme-accent-light","theme-accent-custom")}static hslToHex(e,t,s){e/=360,t/=100,s/=100;const r=(1-Math.abs(2*s-1))*t,i=r*(1-Math.abs(e*6%2-1)),o=s-r/2;let c=0,h=0,d=0;0<=e&&e<1/6?(c=r,h=i,d=0):1/6<=e&&e<2/6?(c=i,h=r,d=0):2/6<=e&&e<3/6?(c=0,h=r,d=i):3/6<=e&&e<4/6?(c=0,h=i,d=r):4/6<=e&&e<5/6?(c=i,h=0,d=r):5/6<=e&&e<1&&(c=r,h=0,d=i);const m=f=>{const y=Math.round((f+o)*255).toString(16);return y.length===1?"0"+y:y};return"#"+m(c)+m(h)+m(d)}}class Se{static loadState(){const e={};try{const t=localStorage.getItem(this.STORAGE_KEYS.DARK_ACCENT_HUE),s=localStorage.getItem(this.STORAGE_KEYS.LIGHT_ACCENT_HUE),r=localStorage.getItem(this.STORAGE_KEYS.DARK_BRIGHTNESS),i=localStorage.getItem(this.STORAGE_KEYS.LIGHT_BRIGHTNESS),o=localStorage.getItem(this.STORAGE_KEYS.ENABLED),c=localStorage.getItem(this.STORAGE_KEYS.BRIGHTNESS_OVERLAY);t&&(e.darkAccentHue=parseInt(t)),s&&(e.lightAccentHue=parseInt(s)),r&&(e.darkBrightness=parseInt(r)),i&&(e.lightBrightness=parseInt(i)),o!==null&&(e.isEnabled=o==="true"),c!==null&&(e.brightnessOverlay=c==="true")}catch(t){console.warn("Failed to load accent colors from localStorage:",t)}return e}static saveState(e){try{localStorage.setItem(this.STORAGE_KEYS.DARK_ACCENT_HUE,e.darkAccentHue.toString()),localStorage.setItem(this.STORAGE_KEYS.LIGHT_ACCENT_HUE,e.lightAccentHue.toString()),localStorage.setItem(this.STORAGE_KEYS.DARK_BRIGHTNESS,e.darkBrightness.toString()),localStorage.setItem(this.STORAGE_KEYS.LIGHT_BRIGHTNESS,e.lightBrightness.toString()),localStorage.setItem(this.STORAGE_KEYS.ENABLED,e.isEnabled.toString()),localStorage.setItem(this.STORAGE_KEYS.BRIGHTNESS_OVERLAY,e.brightnessOverlay.toString())}catch(t){console.warn("Failed to save accent colors to localStorage:",t)}}}Se.STORAGE_KEYS={DARK_ACCENT_HUE:"darkAccentHue",LIGHT_ACCENT_HUE:"lightAccentHue",DARK_BRIGHTNESS:"darkBrightness",LIGHT_BRIGHTNESS:"lightBrightness",ENABLED:"accentColorsEnabled",BRIGHTNESS_OVERLAY:"brightnessOverlay"};let Rt=class X{constructor(){this.state={darkAccentHue:0,lightAccentHue:0,darkBrightness:50,lightBrightness:50,isEnabled:!1,brightnessOverlay:!0},this.loadFromStorage()}static getInstance(){return X.instance||(X.instance=new X),X.instance}getDarkAccentHue(){return this.state.darkAccentHue}getLightAccentHue(){return this.state.lightAccentHue}getDarkBrightness(){return this.state.darkBrightness}getLightBrightness(){return this.state.lightBrightness}getState(){return l({},this.state)}getBrightnessOverlay(){return this.state.brightnessOverlay}setDarkAccentHue(e){this.state.darkAccentHue=Math.max(0,Math.min(360,e)),this.saveToStorage(),this.applyAccentColorsIfCurrentTheme("dark")}setLightAccentHue(e){this.state.lightAccentHue=Math.max(0,Math.min(360,e)),this.saveToStorage(),this.applyAccentColorsIfCurrentTheme("light")}setDarkBrightness(e){this.state.darkBrightness=Math.max(0,Math.min(100,e)),this.saveToStorage(),this.applyAccentColorsIfCurrentTheme("dark")}setLightBrightness(e){this.state.lightBrightness=Math.max(0,Math.min(100,e)),this.saveToStorage(),this.applyAccentColorsIfCurrentTheme("light")}setEnabled(e){this.state.isEnabled=e,this.saveToStorage(),this.applyAccentColors()}setBrightnessOverlay(e){this.state.brightnessOverlay=e,this.saveToStorage(),this.applyAccentColors()}setAccentColor(e){const t=this.hexToHsl(e);if(!t)return;const s=t.h;this.state.darkAccentHue=s,this.state.lightAccentHue=s,this.saveToStorage(),this.applyAccentColors()}setDarkContrastAccent(){this.state.darkAccentHue=210,this.saveToStorage(),this.applyAccentColors()}applyAccentColors(){const t=document.documentElement.getAttribute("data-theme");ae.resetAccentColors(),this.state.isEnabled&&(t==="dark"?ae.applyDarkAccent(this.state):t==="light"?ae.applyLightAccent(this.state):t==="custom"&&ae.applyCustomAccent(this.state))}hexToHsl(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!t)return null;const s=parseInt(t[1],16)/255,r=parseInt(t[2],16)/255,i=parseInt(t[3],16)/255,o=Math.max(s,r,i),c=Math.min(s,r,i);let h=0,d=0;const m=(o+c)/2;if(o!==c){const f=o-c;switch(d=m>.5?f/(2-o-c):f/(o+c),o){case s:h=(r-i)/f+(r<i?6:0);break;case r:h=(i-s)/f+2;break;case i:h=(s-r)/f+4;break}h/=6}return{h:Math.round(h*360),s:Math.round(d*100),l:Math.round(m*100)}}reset(){this.state={darkAccentHue:0,lightAccentHue:0,darkBrightness:50,lightBrightness:50,isEnabled:!1,brightnessOverlay:!0},this.saveToStorage(),this.applyAccentColors()}loadFromStorage(){const e=Se.loadState();this.state=l(l({},this.state),e)}saveToStorage(){Se.saveState(this.state)}applyAccentColorsIfCurrentTheme(e){document.documentElement.getAttribute("data-theme")===e&&this.applyAccentColors()}};const q=Rt.getInstance();class Y{constructor(){this.currentTheme="dark"}static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance}getThemeColors(e){switch(e){case"dark":return{primary:"#ffffff",background:"#000000",surface:"#1a1a1a",text:"#ffffff",textSecondary:"#ffffff",border:"rgba(255,255,255,0.1)"};case"light":return{primary:"#000000",background:"#ffffff",surface:"#ffffff",text:"#000000",textSecondary:"#000000",border:"rgba(0,0,0,0.1)"};case"custom":return{primary:"#000000",background:"#000000",surface:"#1a1a1a",text:"#ffffff",textSecondary:"#ffffff",border:"rgba(255,255,255,0.10)"};default:return this.getThemeColors("dark")}}applyTheme(e){this.currentTheme=e;const t=this.getThemeColors(e);document.documentElement.setAttribute("data-theme",e),this.setCSSVariables(t)}setCSSVariables(e){const t=document.documentElement;t.style.setProperty("--background",e.background),t.style.setProperty("--surface",e.surface),t.style.setProperty("--text",e.text),t.style.setProperty("--text-secondary",e.textSecondary),t.style.setProperty("--border",e.border),t.style.setProperty("--secondary",this.mixColors(e.primary,e.background,.8)),t.style.setProperty("--accent",this.mixColors(e.primary,e.background,.6)),t.style.setProperty("--text-muted",this.mixColors(e.text,e.background,.6)),t.style.setProperty("--border-light",this.mixColors(e.border,"transparent",.5)),t.style.setProperty("--border-strong",this.mixColors(e.border,"transparent",2)),t.style.setProperty("--border-active",this.mixColors(e.primary,"transparent",.6)),t.style.setProperty("--surface-hover",this.mixColors(e.surface,e.primary,.1)),t.style.setProperty("--icon-primary",e.text),t.style.setProperty("--icon-secondary",e.textSecondary),t.style.setProperty("--icon-accent",e.primary)}mixColors(e,t,s){return e}getCurrentTheme(){return this.currentTheme}setCustomColor(e){if(this.currentTheme==="custom"){const t=document.documentElement,s=t.style.getPropertyValue("--background")||"#0a0a0a";t.style.setProperty("--secondary",this.mixColors(e,s,.8)),t.style.setProperty("--accent",this.mixColors(e,s,.6)),t.style.setProperty("--icon-accent",e)}}}const O=Y.getInstance(),Pe=class H{constructor(){this.settings={},this.listeners=new Map,this.loadSettings()}static getInstance(){return H.instance||(H.instance=new H),H.instance}loadSettings(){try{const e=localStorage.getItem("barsukov-settings"),t=localStorage.getItem("barsukov-settings-version");if(e){const s=JSON.parse(e);t!==H.SETTINGS_VERSION&&(console.log("–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫..."),this.migrateSettings(s,t)),this.settings=l(l({},this.getDefaultSettings()),s),this.saveSettings()}else this.settings=this.getDefaultSettings(),this.saveSettings()}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:",e),this.settings=this.getDefaultSettings(),this.saveSettings()}}migrateSettings(e,t){if(!t){const s=this.getDefaultSettings();Object.keys(s).forEach(r=>{r in e||(e[r]=s[r])})}localStorage.setItem("barsukov-settings-version",H.SETTINGS_VERSION)}saveSettings(){try{localStorage.setItem("barsukov-settings",JSON.stringify(this.settings))}catch(e){console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:",e)}}getDefaultSettings(){return{theme:"dark",customColor:"#000000",accentsEnabled:!1,accentColor:"#000000",useColoredText:!1,textColor:"#000000",sidebarCollapsed:!1,sidebarWidth:280,notifications:!0,animations:!0,chatWidth:350,chatInputHeight:300,workspaceLayout:"grid",autoSave:!0,showTimestamps:!0,enableVoice:!0,enableFileUpload:!0,maxMessages:100,autoScroll:!0,brightnessOverlay:!0,hideChatFunctionButtons:!1}}getSetting(e){return this.settings[e]}validateSetting(e,t){const r={theme:i=>["dark","light","custom"].includes(i),customColor:i=>typeof i=="string"&&/^#[0-9A-Fa-f]{6}$/.test(i),accentColor:i=>typeof i=="string"&&/^#[0-9A-Fa-f]{6}$/.test(i),textColor:i=>typeof i=="string"&&/^#[0-9A-Fa-f]{6}$/.test(i),sidebarWidth:i=>typeof i=="number"&&i>=200&&i<=500,chatWidth:i=>typeof i=="number"&&i>=250&&i<=2e3,chatInputHeight:i=>typeof i=="number"&&i>=256&&i<=1200,maxMessages:i=>typeof i=="number"&&i>=50&&i<=1e3,workspaceLayout:i=>["grid","list","compact"].includes(i)}[e];return r?r(t):!0}setSetting(e,t){return v(this,null,function*(){if(!this.validateSetting(e,t))throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ${e}: ${t}`);if(this.settings[e]=t,this.saveSettings(),this.notifyListeners(e,t),e==="theme"){const s=this.settings.theme||"dark";O.applyTheme(s)}if(e==="customColor"&&this.settings.theme==="custom"){const s=this.settings.customColor;O.setCustomColor(s)}e==="brightnessOverlay"&&q.setBrightnessOverlay(t)})}getAllSettings(){return l({},this.settings)}resetSettings(){this.settings=this.getDefaultSettings(),this.saveSettings(),this.notifyAllListeners()}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{var s;(s=this.listeners.get(e))==null||s.delete(t)}}notifyListeners(e,t){var s;(s=this.listeners.get(e))==null||s.forEach(r=>r(t))}notifyAllListeners(){this.listeners.forEach((e,t)=>{e.forEach(s=>s(this.settings[t]))})}getUserPreferences(){return{theme:this.getSetting("theme")||"dark",sidebarCollapsed:this.getSetting("sidebarCollapsed")||!1,notifications:this.getSetting("notifications")||!0,animations:this.getSetting("animations")||!0,sounds:this.getSetting("sounds")||!0}}updateUserPreferences(e){Object.entries(e).forEach(([t,s])=>{this.setSetting(t,s)})}getSettingsCategories(){return[{id:"appearance",name:"–í–Ω–µ—à–Ω–∏–π –≤–∏–¥",description:"–¢–µ–º–∞ –∏ —à—Ä–∏—Ñ—Ç—ã",icon:"appearance",items:[{id:"theme",name:"–¢–µ–º–∞",description:"–°—Ö–µ–º–∞",type:"theme-buttons",value:this.getSetting("theme"),onChange:e=>this.setSetting("theme",e)},{id:"animations",name:"–ê–Ω–∏–º–∞—Ü–∏–∏",description:"–ü–ª–∞–≤–Ω–æ",type:"boolean",value:this.getSetting("animations"),onChange:e=>this.setSetting("animations",e)},{id:"autoSave",name:"–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ",description:"–ê–≤—Ç–æ",type:"boolean",value:this.getSetting("autoSave"),onChange:e=>this.setSetting("autoSave",e)},{id:"customColor",name:"–ö–∞—Å—Ç–æ–º–Ω—ã–π —Ü–≤–µ—Ç",description:"–°–≤–æ–π",type:"color",value:this.getSetting("customColor"),onChange:e=>this.setSetting("customColor",e)},{id:"accentsEnabled",name:"–ê–∫—Ü–µ–Ω—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞",description:"–ê–∫—Ü–µ–Ω—Ç—ã",type:"boolean",value:this.getSetting("accentsEnabled"),onChange:e=>this.setSetting("accentsEnabled",e)},{id:"accentColor",name:"–¶–≤–µ—Ç –∞–∫—Ü–µ–Ω—Ç–æ–≤",description:"–¶–≤–µ—Ç",type:"color",value:this.getSetting("accentColor"),onChange:e=>this.setSetting("accentColor",e)},{id:"useColoredText",name:"–¶–≤–µ—Ç–Ω–æ–π —Ç–µ–∫—Å—Ç",description:"–¶–≤–µ—Ç–Ω–æ–π",type:"boolean",value:this.getSetting("useColoredText"),onChange:e=>this.setSetting("useColoredText",e)},{id:"textColor",name:"–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞",description:"–¢–µ–∫—Å—Ç",type:"color",value:this.getSetting("textColor"),onChange:e=>this.setSetting("textColor",e)},{id:"sidebarCollapsed",name:"–°–≤–µ—Ä–Ω—É—Ç—ã–π —Å–∞–π–¥–±–∞—Ä",description:"–°–≤–µ—Ä–Ω—É—Ç—å",type:"boolean",value:this.getSetting("sidebarCollapsed"),onChange:e=>this.setSetting("sidebarCollapsed",e)},{id:"sidebarWidth",name:"–®–∏—Ä–∏–Ω–∞ —Å–∞–π–¥–±–∞—Ä–∞",description:"–ü–∏–∫—Å–µ–ª–∏",type:"number",value:this.getSetting("sidebarWidth"),min:256,max:500,step:10,onChange:e=>this.setSetting("sidebarWidth",e)},{id:"workspaceLayout",name:"–ú–∞–∫–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞",description:"–ú–∞–∫–µ—Ç",type:"select",value:this.getSetting("workspaceLayout"),options:[{label:"–°–µ—Ç–∫–∞",value:"grid"},{label:"–°–ø–∏—Å–æ–∫",value:"list"},{label:"–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π",value:"compact"}],onChange:e=>this.setSetting("workspaceLayout",e)}]},{id:"chat",name:"–ß–∞—Ç",description:"–ß–∞—Ç",icon:"chat",items:[{id:"chatWidth",name:"–®–∏—Ä–∏–Ω–∞ —á–∞—Ç–∞",description:"–ü–∏–∫—Å–µ–ª–∏",type:"number",value:this.getSetting("chatWidth"),min:250,max:2e3,step:10,onChange:e=>this.setSetting("chatWidth",e)},{id:"chatInputHeight",name:"–í—ã—Å–æ—Ç–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞",description:"–ü–∏–∫—Å–µ–ª–∏",type:"number",value:this.getSetting("chatInputHeight"),min:256,max:1200,step:10,onChange:e=>this.setSetting("chatInputHeight",e)},{id:"showTimestamps",name:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä–µ–º—è",description:"–í—Ä–µ–º—è",type:"boolean",value:this.getSetting("showTimestamps"),onChange:e=>this.setSetting("showTimestamps",e)},{id:"autoScroll",name:"–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞",description:"–ü—Ä–æ–∫—Ä—É—Ç–∫–∞",type:"boolean",value:this.getSetting("autoScroll"),onChange:e=>this.setSetting("autoScroll",e)},{id:"maxMessages",name:"–ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π",description:"–ú–∞–∫—Å–∏–º—É–º",type:"number",value:this.getSetting("maxMessages"),min:50,max:1e3,step:50,onChange:e=>this.setSetting("maxMessages",e)},{id:"enableVoice",name:"–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è",description:"–ì–æ–ª–æ—Å",type:"boolean",value:this.getSetting("enableVoice"),onChange:e=>this.setSetting("enableVoice",e)},{id:"enableFileUpload",name:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤",description:"–§–∞–π–ª—ã",type:"boolean",value:this.getSetting("enableFileUpload"),onChange:e=>this.setSetting("enableFileUpload",e)},{id:"hideChatFunctionButtons",name:"–°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π",description:"–°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π –≤ —á–∞—Ç–µ",type:"boolean",value:this.getSetting("hideChatFunctionButtons"),onChange:e=>this.setSetting("hideChatFunctionButtons",e)}]},{id:"notifications",name:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",description:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",icon:"notifications",items:[{id:"notifications",name:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",description:"–í–∫–ª—é—á–∏—Ç—å",type:"boolean",value:this.getSetting("notifications"),onChange:e=>this.setSetting("notifications",e)}]}]}exportSettings(){return JSON.stringify(this.settings,null,2)}importSettings(e){try{const t=JSON.parse(e);return this.settings=l(l({},this.getDefaultSettings()),t),this.saveSettings(),this.notifyAllListeners(),!0}catch(t){return console.error("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫:",t),!1}}};Pe.SETTINGS_VERSION="1.0.0";let jt=Pe;const Mt=jt.getInstance();class J{constructor(){this.themes=new Map,this.currentTheme="dark",this.initializeDefaultThemes()}static getInstance(){return J.instance||(J.instance=new J),J.instance}initializeDefaultThemes(){this.themes.set("light",this.createThemeConfig("light","#111827","#ffffff","–°–≤–µ—Ç–ª–∞—è")),this.themes.set("dark",this.createThemeConfig("dark","#e5e7eb","#0a0a0a","–¢–µ–º–Ω–∞—è"))}createThemeConfig(e,t,s,r){const i=R.getLuminance(s)>.5,o=i?"#000000":"#ffffff";return{id:e,name:r,colors:{primary:t,secondary:R.generateButtonColors(t,s).secondary,accent:R.generateButtonColors(t,s).secondary,background:s,surface:R.generateSurfaceColor(s),text:o,textSecondary:i?"#6b7280":"#9ca3af",border:R.generateBorderColor(s,i),success:"#10b981",warning:"#f59e0b",error:"#ef4444",info:"#10b981"},isCustom:!1}}getThemes(){return Array.from(this.themes.values())}getTheme(e){return this.themes.get(e)}createCustomTheme(e){const t=R.generateColorScheme(e),s="#ffffff",r={id:"custom",name:"–¶–≤–µ—Ç–Ω–∞—è",colors:b(l({},t),{text:s,secondary:R.generateButtonColors(e,t.background).secondary,accent:R.generateButtonColors(e,t.background).secondary,warning:"#f59e0b",info:t.success}),isCustom:!0};return this.themes.set("custom",r),r}applyColoredText(e){document.documentElement.style.setProperty("--text",e)}resetColoredText(){const e=document.documentElement,t=e.getAttribute("data-theme")||"dark",s=this.getTheme(t);s&&e.style.setProperty("--text",s.colors.text)}applyTheme(e,t,s,r,i,o){const c=document.documentElement;c.classList.add("theme-transitioning"),requestAnimationFrame(()=>{c.getAttribute("data-theme")!==e&&c.setAttribute("data-theme",e),e==="custom"&&t?this.applyCustomTheme(t):this.applyStandardTheme(e),setTimeout(()=>{c.classList.remove("theme-transitioning"),s&&r?this.applyColoredText(r):this.resetColoredText(),i&&o?(q.setAccentColor(o),q.applyAccentColors()):q.getState().isEnabled&&q.applyAccentColors()},500)})}applyCustomTheme(e){const t=document.documentElement,s=R.createCustomThemeVariables(e);Object.entries(s).forEach(([r,i])=>{t.style.setProperty(r,i)})}applyStandardTheme(e){const t=document.documentElement;R.getCustomVariablesToRemove().forEach(r=>{t.style.removeProperty(r)}),t.setAttribute("data-theme",e)}getCurrentTheme(){return this.currentTheme}resetCustomTheme(){this.themes.delete("custom"),this.currentTheme==="custom"&&(this.currentTheme="dark",this.applyTheme("dark"))}}J.getInstance();const Oe=u.createContext(void 0),Pt={user:null,authUser:null,authLoading:!1,authError:null,layout:{sidebarCollapsed:!1,sidebarWidth:ge.SIDEBAR.DEFAULT_WIDTH,chatVisible:!0,chatWidth:ge.CHAT.DEFAULT_WIDTH,chatInputHeight:ge.CHAT.INPUT_DEFAULT_HEIGHT,workspaceLayout:"grid",activeService:null,activeTool:null,activeSection:"workspace",activeSettingsCategory:"all",activeWidgetsCategory:[],chatType:"default",expandedTabsHeight:0},services:[],activeChat:null,workspaceItems:[],settings:{theme:Re.AVAILABLE.DARK,fontSize:Re.FONT_SIZES.MEDIUM,animations:!0,sidebarCollapsed:!1,useColoredText:!1,textColor:"#ffffff",accentsEnabled:!1,autoScroll:!0,hideChatFunctionButtons:!1,showTimestamps:!1},isLoading:!0,error:null,isInitialized:!1};function Ot(a,e){var t;switch(e.type){case"SET_USER":return b(l({},a),{user:e.payload});case"SET_AUTH_USER":{const s=e.payload;if(!s||!s.id)return console.warn("[PlatformContext] Invalid authUser, clearing auth:",s),b(l({},a),{authUser:null,user:null,authError:"–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"});const r={id:String(s.id),name:`${s.first_name||""} ${s.last_name||""}`.trim()||"User",email:s.username?`${s.username}@telegram.user`:"",avatar:s.photo_url||"",preferences:((t=a.user)==null?void 0:t.preferences)||{theme:"dark",sidebarCollapsed:!1,notifications:!0,animations:!0,sounds:!1}};return b(l({},a),{authUser:s,user:r,authError:null})}case"CLEAR_AUTH_USER":return b(l({},a),{authUser:null,user:null,authError:null});case"SET_AUTH_LOADING":return b(l({},a),{authLoading:e.payload});case"SET_AUTH_ERROR":return b(l({},a),{authError:e.payload});case"SET_LOADING":return b(l({},a),{isLoading:e.payload});case"SET_ERROR":return b(l({},a),{error:e.payload});case"SET_INITIALIZED":return b(l({},a),{isInitialized:e.payload});case"SWITCH_SERVICE":{const s=e.payload,r=a.services.find(i=>i.config.id===s);return r!=null&&r.config.theme&&le.setTheme(`service-${s}`),b(l({},a),{layout:b(l({},a.layout),{activeService:e.payload,activeTool:null})})}case"SWITCH_TOOL":return b(l({},a),{layout:b(l({},a.layout),{activeTool:e.payload})});case"ADD_MESSAGE":return a.activeChat?b(l({},a),{activeChat:b(l({},a.activeChat),{messages:[...a.activeChat.messages,e.payload],updatedAt:new Date})}):a;case"CREATE_WORKSPACE_ITEM":{const s=e.payload;if(a.workspaceItems.find(c=>c.id===s.id))return a;const i=b(l({},s),{createdAt:s.createdAt instanceof Date?s.createdAt:new Date(s.createdAt),updatedAt:s.updatedAt instanceof Date?s.updatedAt:new Date(s.updatedAt)}),o=[...a.workspaceItems,i];try{localStorage.setItem("barsukov-workspace",JSON.stringify(o))}catch(c){}return b(l({},a),{workspaceItems:o})}case"REMOVE_WORKSPACE_ITEM":{const s=a.workspaceItems.find(o=>o.id===e.payload),r=a.workspaceItems.filter(o=>o.id!==e.payload);try{localStorage.setItem("barsukov-workspace",JSON.stringify(r))}catch(o){}const i=b(l({},a),{workspaceItems:r});return s&&ve.info("–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª—ë–Ω",s.title,{duration:5e3,actions:[{label:"–û—Ç–º–µ–Ω–∏—Ç—å",action:()=>{const o=[...i.workspaceItems,s];try{localStorage.setItem("barsukov-workspace",JSON.stringify(o))}catch(c){}window.dispatchEvent(new CustomEvent("workspace:restore",{detail:s}))},variant:"primary"}]}),i}case"UPDATE_SETTINGS":{Mt.setSetting(e.payload.key,e.payload.value);const s=b(l({},a),{settings:b(l({},a.settings),{[e.payload.key]:e.payload.value})});return e.payload.key==="chatInputHeight"&&(s.layout=b(l({},s.layout),{chatInputHeight:typeof e.payload.value=="number"?e.payload.value:300})),s}case"UPDATE_WORKSPACE_ITEM":{const{id:s,updates:r}=e.payload,i=a.workspaceItems.map(o=>o.id===s?b(l(l({},o),r),{updatedAt:new Date}):o);try{localStorage.setItem("barsukov-workspace",JSON.stringify(i))}catch(o){}return b(l({},a),{workspaceItems:i})}case"TOGGLE_SIDEBAR":return b(l({},a),{layout:b(l({},a.layout),{sidebarCollapsed:!a.layout.sidebarCollapsed})});case"TOGGLE_CHAT":return b(l({},a),{layout:b(l({},a.layout),{chatVisible:!a.layout.chatVisible})});case"SET_CHAT_TYPE":return b(l({},a),{layout:b(l({},a.layout),{chatType:e.payload})});case"SET_LAYOUT":return b(l({},a),{layout:l(l({},a.layout),e.payload)});case"SWITCH_SECTION":return b(l({},a),{layout:b(l({},a.layout),{activeSection:e.payload})});case"SET_ACTIVE_SETTINGS_CATEGORY":return b(l({},a),{layout:b(l({},a.layout),{activeSettingsCategory:e.payload})});case"SET_ACTIVE_WIDGETS_CATEGORY":return b(l({},a),{layout:b(l({},a.layout),{activeWidgetsCategory:e.payload})});case"SET_EXPANDED_TABS_HEIGHT":return b(l({},a),{layout:b(l({},a.layout),{expandedTabsHeight:e.payload})});case"ADD_SERVICE":{const s=a.services.findIndex(r=>r.config.id===e.payload.config.id);if(s>=0){const r=[...a.services];return r[s]=e.payload,b(l({},a),{services:r})}else return b(l({},a),{services:[...a.services,e.payload]})}case"TOGGLE_SERVICE":return b(l({},a),{services:a.services.map(s=>s.config.id===e.payload?b(l({},s),{config:b(l({},s.config),{isActive:!s.config.isActive})}):s)});case"SET_ACTIVE_CHAT":return b(l({},a),{activeChat:e.payload});default:return a}}function Dt({children:a}){var te,se,N,L,_,$,U;const[e,t]=u.useReducer(Ot,Pt);u.useEffect(()=>{const p=S=>{const T=S.detail;T&&t({type:"CREATE_WORKSPACE_ITEM",payload:T})};return window.addEventListener("workspace:restore",p),()=>window.removeEventListener("workspace:restore",p)},[]),u.useEffect(()=>{if(e.isInitialized)return;(()=>v(this,null,function*(){var S,T;try{t({type:"SET_LOADING",payload:!0});const[I,W,we]=yield Promise.all([Promise.resolve(localStorage.getItem("barsukov-user")),Promise.resolve(localStorage.getItem("barsukov-settings")),Promise.resolve(localStorage.getItem("barsukov-workspace"))]);if(yield x(),!e.authUser&&I){const z=JSON.parse(I);t({type:"SET_USER",payload:z})}if(W){const z=JSON.parse(W),G={chatWidth:"chatWidth",chatInputHeight:"chatInputHeight",sidebarCollapsed:"sidebarCollapsed",sidebarWidth:"sidebarWidth",workspaceLayout:"workspaceLayout"};Object.entries(z).forEach(([Q,Te])=>{t({type:"UPDATE_SETTINGS",payload:{key:Q,value:Te}}),Q in G&&t({type:"SET_LAYOUT",payload:{[G[Q]]:Te}})})}we&&JSON.parse(we).forEach(G=>{const Q=b(l({},G),{createdAt:new Date(G.createdAt),updatedAt:new Date(G.updatedAt)});t({type:"CREATE_WORKSPACE_ITEM",payload:Q})}),yield P.loadAllServices(),P.getSortedServices().forEach(z=>{t({type:"ADD_SERVICE",payload:z})}),t({type:"SET_ACTIVE_CHAT",payload:{id:"default-chat",title:"–û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç",messages:[],createdAt:new Date,updatedAt:new Date,isActive:!0}});const he=((S=e.settings)==null?void 0:S.theme)||"light",xe=(T=e.settings)==null?void 0:T.customColor;document.documentElement.setAttribute("data-theme",he),he==="custom"&&xe?(O.applyTheme("custom"),O.setCustomColor(xe)):O.applyTheme(he),t({type:"SET_LOADING",payload:!1}),t({type:"SET_INITIALIZED",payload:!0})}catch(I){console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:",I),t({type:"SET_ERROR",payload:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã"}),t({type:"SET_LOADING",payload:!1})}}))()},[(te=e.settings)==null?void 0:te.theme,(se=e.settings)==null?void 0:se.customColor]),u.useEffect(()=>{var T,I;const p=((T=e.settings)==null?void 0:T.theme)||"dark",S=(I=e.settings)==null?void 0:I.customColor;document.documentElement.setAttribute("data-theme",p),p==="custom"&&S?(O.applyTheme("custom"),O.setCustomColor(S)):O.applyTheme(p)},[(N=e.settings)==null?void 0:N.theme,(L=e.settings)==null?void 0:L.customColor]),u.useEffect(()=>{var S;const p=((S=e.settings)==null?void 0:S.fontSize)||"medium";document.documentElement.setAttribute("data-font-size",p)},[(_=e.settings)==null?void 0:_.fontSize]),u.useEffect(()=>{var S;const p=(S=e.settings)==null?void 0:S.animations;le.queueThemeChange({type:"animation",key:"enabled",value:p?"true":"false"}),document.documentElement.setAttribute("data-animations",p?"on":"off")},[($=e.settings)==null?void 0:$.animations]),u.useEffect(()=>{try{e.user&&localStorage.setItem("barsukov-user",JSON.stringify(e.user)),localStorage.setItem("barsukov-settings",JSON.stringify(e.settings)),localStorage.setItem("barsukov-workspace",JSON.stringify(e.workspaceItems))}catch(p){console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:",p)}},[e.user,e.settings,e.workspaceItems]);const s=u.useCallback(p=>{t({type:"SWITCH_SERVICE",payload:p})},[]),r=u.useCallback(p=>{t({type:"SWITCH_TOOL",payload:p})},[]),i=u.useCallback(p=>v(this,null,function*(){const S={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,content:p,sender:"user",timestamp:new Date,type:"text"};t({type:"ADD_MESSAGE",payload:S}),me.addMessageToHistory(S);try{const T=yield me.processMessage(p,e.layout.activeService,e.layout.activeSection),I={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,content:T.message,sender:T.isSystemResponse?"system":"assistant",timestamp:new Date,type:"text"};t({type:"ADD_MESSAGE",payload:I}),me.addMessageToHistory(I),T.shouldRouteToService&&T.serviceId&&t({type:"SWITCH_SERVICE",payload:T.serviceId})}catch(T){console.error("AI Brain processing error:",T);const I={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,content:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",sender:"system",timestamp:new Date,type:"text"};t({type:"ADD_MESSAGE",payload:I})}}),[e.layout.activeService,e.layout.activeSection]),o=u.useCallback(p=>{if(e.workspaceItems.find(T=>T.id===p.id)){console.warn("–≠–ª–µ–º–µ–Ω—Ç —Å —Ç–∞–∫–∏–º ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:",p.id);return}t({type:"CREATE_WORKSPACE_ITEM",payload:p})},[e.workspaceItems]),c=u.useCallback((p,S)=>{t({type:"UPDATE_SETTINGS",payload:{key:p,value:S}});try{const I=JSON.parse(localStorage.getItem("barsukov-settings")||"{}");I[p]=S,localStorage.setItem("barsukov-settings",JSON.stringify(I))}catch(I){console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ localStorage:",I)}const T={chatWidth:"chatWidth",sidebarCollapsed:"sidebarCollapsed",sidebarWidth:"sidebarWidth",workspaceLayout:"workspaceLayout"};p in T&&t({type:"SET_LAYOUT",payload:{[T[p]]:S}})},[]),h=u.useCallback(()=>{t({type:"TOGGLE_SIDEBAR"})},[]),d=u.useCallback(()=>{t({type:"TOGGLE_CHAT"})},[]),m=u.useCallback(p=>{t({type:"SET_CHAT_TYPE",payload:p})},[]),f=u.useCallback(p=>{t({type:"SWITCH_SECTION",payload:p}),setTimeout(()=>{document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()},0)},[]),y=u.useCallback(p=>{t({type:"SET_ACTIVE_SETTINGS_CATEGORY",payload:p})},[]),w=u.useCallback(p=>{t({type:"SET_EXPANDED_TABS_HEIGHT",payload:p})},[]),A=u.useCallback(p=>{t({type:"TOGGLE_SERVICE",payload:p}),setTimeout(()=>{document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()},0)},[]),k=u.useCallback((p,S)=>v(this,null,function*(){var T;try{if(p==="settings"){if(S==="open-preferences"||S==="appearance"||S==="interface"||S==="chat"||S==="notifications"){const I=S==="open-preferences"?"appearance":S;return t({type:"SWITCH_SECTION",payload:"settings"}),t({type:"UPDATE_SETTINGS",payload:{key:"selectedSettingsCategory",value:I}}),setTimeout(()=>{document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()},0),{success:!0,message:"–û—Ç–∫—Ä—ã—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",data:{section:I}}}if(S==="toggle-theme"){const W=(((T=e.settings)==null?void 0:T.theme)||"dark")==="dark"?"light":"dark";return t({type:"UPDATE_SETTINGS",payload:{key:"theme",value:W}}),{success:!0,message:`–¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞: ${W}`,data:{theme:W}}}}return yield P.executeTool(p,S)}catch(I){throw console.error("–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:",I),I}}),[(U=e.settings)==null?void 0:U.theme]),E=u.useCallback(p=>v(this,null,function*(){try{t({type:"SET_AUTH_LOADING",payload:!0}),t({type:"SET_AUTH_ERROR",payload:null}),console.log("[PlatformContext] –ù–∞—á–∏–Ω–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Telegram:",p);const S=yield j.loginWithTelegram(p);t({type:"SET_AUTH_USER",payload:S.user}),console.log("[PlatformContext] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞:",{userId:S.user.id,needsAgreement:S.needsAgreement}),S.needsAgreement&&console.log("[PlatformContext] –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç–∏–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è")}catch(S){console.error("[PlatformContext] –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",S);const T=S instanceof Error?S.message:"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏";throw t({type:"SET_AUTH_ERROR",payload:T}),S}finally{t({type:"SET_AUTH_LOADING",payload:!1})}}),[]),g=u.useCallback(()=>v(this,null,function*(){try{console.log("[PlatformContext] –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã"),yield j.logout(),t({type:"CLEAR_AUTH_USER"}),console.log("[PlatformContext] –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ")}catch(p){console.error("[PlatformContext] –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:",p),t({type:"CLEAR_AUTH_USER"})}}),[]),x=u.useCallback(()=>v(this,null,function*(){try{if(console.log("[PlatformContext] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏..."),!j.getStoredToken()){console.log("[PlatformContext] –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω");return}console.log("[PlatformContext] –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...");const S=yield j.getCurrentUser();if(!S||!S.id){console.warn("[PlatformContext] –ü–æ–ª—É—á–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π user, –æ—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω:",S),j.clearStorage(),t({type:"CLEAR_AUTH_USER"});return}t({type:"SET_AUTH_USER",payload:S}),console.log("[PlatformContext] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞:",{userId:S.id,username:S.username})}catch(p){console.error("[PlatformContext] –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",p),j.clearStorage(),t({type:"CLEAR_AUTH_USER"})}}),[]),de=u.useMemo(()=>({state:e,dispatch:t,switchService:s,switchTool:r,sendMessage:i,createWorkspaceItem:o,updateSettings:c,toggleSidebar:h,toggleChat:d,setChatType:m,switchSection:f,setActiveSettingsCategory:y,setExpandedTabsHeight:w,toggleService:A,executeServiceTool:k,loginWithTelegram:E,logout:g,checkAuth:x}),[e,t,s,r,i,o,c,h,d,m,f,y,w,A,k,E,g,x]);return n.jsx(Oe.Provider,{value:de,children:a})}const $t=()=>({handleError:(e,t)=>{console.error("Application error:",e,t)}});function Ht(){const a=u.useContext(Oe);return a===void 0?(console.warn("usePlatform called outside PlatformProvider, returning fallback context"),{state:{user:null,authUser:null,authLoading:!1,authError:null,layout:{sidebarCollapsed:!1,sidebarWidth:300,chatVisible:!0,chatWidth:400,chatInputHeight:300,workspaceLayout:"grid",activeService:null,activeTool:null,activeSection:"workspace",activeSettingsCategory:"all",activeWidgetsCategory:[],chatType:"default",expandedTabsHeight:0},services:[],activeChat:null,workspaceItems:[],settings:{theme:"dark",fontSize:"medium",animations:!0,sidebarCollapsed:!1,useColoredText:!1,textColor:"#ffffff",accentsEnabled:!1,autoScroll:!0,hideChatFunctionButtons:!1,showTimestamps:!1},isLoading:!0,error:null,isInitialized:!1},dispatch:()=>{},switchService:()=>{},switchTool:()=>{},sendMessage:()=>v(this,null,function*(){}),createWorkspaceItem:()=>{},updateSettings:()=>{},toggleSidebar:()=>{},toggleChat:()=>{},setChatType:()=>{},switchSection:()=>{},setActiveSettingsCategory:()=>{},setExpandedTabsHeight:()=>{},toggleService:()=>{},executeServiceTool:()=>v(this,null,function*(){return{success:!1}}),loginWithTelegram:()=>v(this,null,function*(){}),logout:()=>v(this,null,function*(){}),checkAuth:()=>v(this,null,function*(){})}):a}class Z{constructor(){this.currentAccentSet={primary:"#ff0000",secondary:"#ff8000",tertiary:"#ffff00",name:"rainbow-red-orange-yellow"},this.accentSets=[{primary:"#ff0000",secondary:"#ff8000",tertiary:"#ffff00",name:"rainbow-red-orange-yellow"},{primary:"#ff8000",secondary:"#ffff00",tertiary:"#00ff00",name:"rainbow-orange-yellow-green"},{primary:"#ffff00",secondary:"#00ff00",tertiary:"#000000",name:"rainbow-yellow-green-black"},{primary:"#00ff00",secondary:"#000000",tertiary:"#8000ff",name:"rainbow-green-black-purple"},{primary:"#000000",secondary:"#8000ff",tertiary:"#ff0000",name:"rainbow-black-purple-red"},{primary:"#8000ff",secondary:"#ff0000",tertiary:"#ff8000",name:"rainbow-purple-red-orange"}],this.initializeAccentColors()}static getInstance(){return Z.instance||(Z.instance=new Z),Z.instance}initializeAccentColors(){this.applyAccentColors(this.currentAccentSet)}applyAccentColors(e){const t=document.documentElement;t.style.setProperty("--dynamic-accent-primary",e.primary),t.style.setProperty("--dynamic-accent-secondary",e.secondary),t.style.setProperty("--dynamic-accent-tertiary",e.tertiary),t.style.setProperty("--accent-primary",e.primary),t.style.setProperty("--accent-secondary",e.secondary),t.style.setProperty("--accent-tertiary",e.tertiary)}setAccentSet(e){const t=this.accentSets.find(s=>s.name===e);t&&(this.currentAccentSet=t,this.applyAccentColors(t),this.saveAccentSet(e))}getCurrentAccentSet(){return this.currentAccentSet}getAllAccentSets(){return this.accentSets}cycleAccentSets(){const t=(this.accentSets.findIndex(r=>r.name===this.currentAccentSet.name)+1)%this.accentSets.length,s=this.accentSets[t];this.setAccentSet(s.name)}setRandomAccentSet(){const e=Math.floor(Math.random()*this.accentSets.length),t=this.accentSets[e];this.setAccentSet(t.name)}saveAccentSet(e){try{localStorage.setItem("barsukov-accent-set",e)}catch(t){console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–∫—Ü–µ–Ω—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞:",t)}}loadAccentSet(){try{return localStorage.getItem("barsukov-accent-set")}catch(e){return console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ü–µ–Ω—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞:",e),null}}restoreAccentSet(){const e=this.loadAccentSet();e&&this.setAccentSet(e)}startAutoCycle(e=1e4){setInterval(()=>{this.cycleAccentSets()},e)}getAccentColor(e){return this.currentAccentSet[e]}createAccentGradient(e="diagonal"){const{primary:t,secondary:s,tertiary:r}=this.currentAccentSet;switch(e){case"horizontal":return`linear-gradient(90deg, ${t}, ${s}, ${r})`;case"vertical":return`linear-gradient(180deg, ${t}, ${s}, ${r})`;case"diagonal":default:return`linear-gradient(135deg, ${t}, ${s}, ${r})`}}}const Bt=Z.getInstance(),Vt=({widget:a,onMinimize:e,onClose:t,isMinimized:s,onDragStart:r})=>{const[i,o]=u.useState(new Date),[c,h]=u.useState(!1),d=u.useRef(null);u.useEffect(()=>{const y=()=>{o(new Date)};return y(),d.current=setInterval(y,1e3),()=>{d.current&&clearInterval(d.current)}},[]);const m=y=>{const w=y.getHours(),A=y.getMinutes(),k=y.getSeconds();if(a.settings.format24h){let E=`${w.toString().padStart(2,"0")}:${A.toString().padStart(2,"0")}`;return a.settings["show-seconds"]&&(E+=`:${k.toString().padStart(2,"0")}`),E}else{const E=w>=12?"PM":"AM";let x=`${w%12||12}:${A.toString().padStart(2,"0")}`;return a.settings["show-seconds"]&&(x+=`:${k.toString().padStart(2,"0")}`),x+=` ${E}`,x}},f=y=>{const w={weekday:"short",day:"numeric",month:"short"};return y.toLocaleDateString("ru-RU",w)};return s?n.jsx("div",{className:"widget-minimized time-widget-minimized",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onClick:e,children:n.jsxs("div",{className:"widget-minimized-content",children:[n.jsx(Ne,{size:16,className:"widget-minimized-icon"}),n.jsx("div",{className:"widget-minimized-time",children:m(i)})]})}):n.jsxs("div",{className:"widget-container time-widget-container active","data-testid":"widget-container",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onMouseDown:r,children:[n.jsxs("div",{className:"widget-header",children:[n.jsxs("div",{className:"widget-title",children:[n.jsx(Ne,{size:16,className:"widget-icon"}),n.jsx("span",{children:"–ß–∞—Å—ã"})]}),n.jsxs("div",{className:B("widget-controls",c&&"widget-controls-visible"),children:[n.jsx("button",{onClick:()=>{const y=document.querySelector(".time-widget-container");y&&y.classList.toggle("no-shadow")},className:"widget-control-btn",title:"–£–±—Ä–∞—Ç—å —Ç–µ–Ω—å",children:n.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),n.jsx("path",{d:"M2 17l10 5 10-5"}),n.jsx("path",{d:"M2 12l10 5 10-5"})]})}),n.jsx("button",{onClick:t,className:"widget-control-btn widget-control-close",title:"–ó–∞–∫—Ä—ã—Ç—å",children:n.jsx(be,{size:12})})]})]}),n.jsxs("div",{className:"widget-content time-widget-content",children:[n.jsx("div",{className:"time-display",children:n.jsx("div",{className:"time-main",children:m(i)})}),a.settings["show-date"]&&n.jsxs("div",{className:"date-display",children:[n.jsx(tt,{size:14,className:"date-icon"}),n.jsx("span",{className:"date-text",children:f(i)})]})]})]})},Ut=({onClose:a,settings:e={}})=>{const[t,s]=u.useState(!1),[r,i]=u.useState(!1),[o,c]=u.useState(!0),h=u.useRef(null),{autoPlay:d=!0,showControls:m=!1}=e,f="boss-ai-intro-video-watched";u.useEffect(()=>{localStorage.getItem(f)==="true"?i(!0):s(!0),c(!1)},[]);const y=()=>{localStorage.setItem(f,"true"),s(!1),i(!0)},w=()=>{console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ"),s(!1),i(!0)},A=()=>{localStorage.removeItem(f),i(!1),s(!0)},k=()=>{a&&a()};return o?n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-black/20 rounded-lg",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):n.jsxs("div",{className:"relative w-full h-full bg-black/20 rounded-lg overflow-hidden",children:[n.jsx("button",{onClick:k,className:"absolute top-2 right-2 z-10 p-1 bg-black/50 hover:bg-black/70 rounded-full transition-colors",title:"–ó–∞–∫—Ä—ã—Ç—å –≤–∏–¥–∂–µ—Ç",children:n.jsx(be,{className:"w-4 h-4 text-white"})}),r&&n.jsx("button",{onClick:A,className:"absolute top-2 left-2 z-10 p-1 bg-black/50 hover:bg-black/70 rounded-full transition-colors",title:"–ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–µ–æ —Å–Ω–æ–≤–∞",children:n.jsx(st,{className:"w-4 h-4 text-white"})}),t&&n.jsx("div",{className:"w-full h-full flex items-center justify-center",children:n.jsxs("video",{ref:h,className:"w-full h-full object-contain",autoPlay:d,controls:m,muted:!1,onEnded:y,onError:w,playsInline:!0,children:[n.jsx("source",{src:"/media/intro-video.mp4",type:"video/mp4"}),"–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ."]})}),r&&!t&&n.jsx("div",{className:"w-full h-full flex items-center justify-center p-4",children:n.jsxs("div",{className:"text-center",children:[n.jsx("img",{src:"/media/logo.png",alt:"Boss AI Logo",className:"max-w-full max-h-full object-contain mx-auto",onLoad:()=>{},onError:()=>{}}),n.jsx("p",{className:"text-white/80 text-sm mt-2",children:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Boss AI Platform"})]})})]})},Wt=({widget:a,onMinimize:e,onClose:t,isMinimized:s,onTranscriptionComplete:r,onDragStart:i})=>{const[o,c]=u.useState(!1),[h,d]=u.useState(!1),[m,f]=u.useState(0),[y,w]=u.useState(""),[A,k]=u.useState(!1),E=u.useRef(null);ce.useEffect(()=>{a.settings["auto-start"]&&!s&&x()},[a.settings,s]),ce.useEffect(()=>(o&&!h?E.current=setInterval(()=>{f(N=>N+1)},1e3):E.current&&(clearInterval(E.current),E.current=null),()=>{E.current&&clearInterval(E.current)}),[o,h]);const g=N=>{const L=Math.floor(N/60),_=N%60;return`${L.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`},x=()=>{c(!0),d(!1),f(0),w("")},de=()=>{c(!1),d(!1),f(0)},te=()=>{d(N=>!N)},se=()=>{y.trim()&&(r(y.trim()),w(""),de())};return ce.useEffect(()=>{if(o&&!h){const N=window.SpeechRecognition||window.webkitSpeechRecognition;if(!N){console.error("Web Speech API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ"),w("–û—à–∏–±–∫–∞: Web Speech API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");return}const L=new N;L.continuous=!0,L.interimResults=!0,L.lang="ru-RU",L.maxAlternatives=1,L.onresult=_=>{let $="",U="";if(_.results&&Array.isArray(_.results)&&typeof _.resultIndex=="number")for(let p=_.resultIndex;p<_.results.length;p++){const S=_.results[p][0].transcript;_.results[p].isFinal?$+=S:U+=S}w(p=>{const T=p.replace(/<span class="interim">.*?<\/span>/g,"")+$;return U?`${T} <span class="interim">${U}</span>`:T})},L.onerror=_=>{console.error("–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏:",_.error),w($=>$+` [–û—à–∏–±–∫–∞: ${_.error}]`)},L.onend=()=>{o&&!h&&setTimeout(()=>{try{L.start()}catch(_){console.error("Restart speech recognition failed",_)}},100)};try{L.start()}catch(_){console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏",_),w("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏")}return()=>{try{L.stop()}catch(_){console.error("–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è",_)}}}},[o,h]),s?n.jsx("div",{className:"widget-minimized voice-widget-minimized",onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),onClick:e,children:n.jsxs("div",{className:"widget-minimized-content",children:[n.jsx("button",{className:"widget-minimized-mic-btn",onClick:N=>{N.stopPropagation(),o||x()},title:o?"–ò–¥—ë—Ç –∑–∞–ø–∏—Å—å":"–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å",children:n.jsx(ue,{size:16,className:B("widget-minimized-icon",o&&"recording")})}),o&&n.jsx("div",{className:"widget-minimized-time",children:g(m)})]})}):n.jsxs("div",{className:"widget-container voice-widget-container active",onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),onMouseDown:i,children:[n.jsxs("div",{className:"widget-header",children:[n.jsxs("div",{className:"widget-title",children:[n.jsx(ue,{size:16,className:"widget-icon"}),n.jsx("span",{children:"–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥"})]}),n.jsxs("div",{className:B("widget-controls",A&&"widget-controls-visible"),children:[n.jsx("button",{onClick:()=>{const N=document.querySelector(".voice-widget-container");N&&N.classList.toggle("no-shadow")},className:"widget-control-btn",title:"–£–±—Ä–∞—Ç—å —Ç–µ–Ω—å",children:n.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),n.jsx("path",{d:"M2 17l10 5 10-5"}),n.jsx("path",{d:"M2 12l10 5 10-5"})]})}),n.jsx("button",{onClick:t,className:"widget-control-btn widget-control-close",title:"–ó–∞–∫—Ä—ã—Ç—å",children:n.jsx(be,{size:12})})]})]}),n.jsxs("div",{className:"widget-content voice-widget-content",children:[n.jsx("div",{className:"voice-main-controls",children:o?n.jsxs("div",{className:"voice-recording-info",children:[n.jsx("div",{className:"voice-recording-time",children:g(m)}),n.jsx("div",{className:"voice-recording-status",children:h?"–ü–∞—É–∑–∞":"–ò–¥—ë—Ç –∑–∞–ø–∏—Å—å..."})]}):n.jsxs("button",{className:"voice-start-btn-small",onClick:x,title:"–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å",children:[n.jsx(ue,{size:20}),n.jsx("span",{children:"–ó–∞–ø–∏—Å—å"})]})}),o&&n.jsxs("div",{className:"voice-recording-controls",children:[n.jsx("button",{className:"voice-control-btn voice-pause-btn",onClick:te,title:h?"–í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å":"–ü–∞—É–∑–∞",children:n.jsx(it,{size:16})}),n.jsx("button",{className:"voice-control-btn voice-send-btn",onClick:se,title:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å",disabled:!y.trim(),children:n.jsx(je,{size:16})})]}),a.settings["show-transcription"]&&y&&n.jsx("div",{className:"voice-transcription",dangerouslySetInnerHTML:{__html:y}})]})]})};class zt{constructor(){this.widgets=new Map,this.widgetTypes=new Map,this.nextZIndex=1e3,this.isEnabled=!0,this.initializeDefaultWidgets()}initializeDefaultWidgets(){this.registerWidgetType({id:"time-widget",name:"–ß–∞—Å—ã",description:"–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –∏ –¥–∞—Ç—É",icon:"Clock",category:"utility",defaultSize:{width:200,height:120},minSize:{width:150,height:80},maxSize:{width:300,height:200},component:()=>null,settings:[{id:"show-seconds",name:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–µ–∫—É–Ω–¥—ã",type:"boolean",defaultValue:!0,description:"–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–µ–∫—É–Ω–¥—ã –≤ —á–∞—Å–∞—Ö"},{id:"show-date",name:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞—Ç—É",type:"boolean",defaultValue:!0,description:"–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥–∞—Ç—É –ø–æ–¥ –≤—Ä–µ–º–µ–Ω–µ–º"},{id:"format24h",name:"24-—á–∞—Å–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç",type:"boolean",defaultValue:!0,description:"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 24-—á–∞—Å–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏"}]}),this.registerWidgetType({id:"voice-widget",name:"–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥",description:"–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –≤–≤–æ–¥—É",icon:"Mic",category:"input",defaultSize:{width:180,height:100},minSize:{width:120,height:60},maxSize:{width:250,height:150},component:()=>null,settings:[{id:"auto-start",name:"–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫",type:"boolean",defaultValue:!1,description:"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–ø–∏—Å—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏"},{id:"show-transcription",name:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é",type:"boolean",defaultValue:!0,description:"–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç"}]})}registerWidgetType(e){this.widgetTypes.set(e.id,e)}createWidget(e,t={}){const s=this.widgetTypes.get(e);if(!s)throw new Error(`Widget type ${e} not found`);const r=l({id:`widget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,title:s.name,description:s.description,icon:s.icon,serviceId:t.serviceId,position:t.position||{x:100,y:100},size:t.size||l({},s.defaultSize),isMinimized:!1,isVisible:!0,isDraggable:!0,isResizable:!0,zIndex:this.nextZIndex++,settings:this.initializeWidgetSettings(s.settings),component:s.component},t);return this.widgets.set(r.id,r),r}initializeWidgetSettings(e){const t={};return e.forEach(s=>{t[s.id]=s.defaultValue}),t}getWidget(e){return this.widgets.get(e)}getAllWidgets(){return Array.from(this.widgets.values())}getVisibleWidgets(){return Array.from(this.widgets.values()).filter(e=>e.isVisible)}getWidgetTypes(){return Array.from(this.widgetTypes.values())}getWidgetTypesByCategory(e){return Array.from(this.widgetTypes.values()).filter(t=>t.category===e)}updateWidget(e,t){const s=this.widgets.get(e);s&&Object.assign(s,t)}moveWidget(e,t){this.updateWidget(e,{position:t})}resizeWidget(e,t){const s=this.widgets.get(e);if(s){const r=this.widgetTypes.get(s.type);if(r){const i={width:Math.max(r.minSize.width,Math.min(r.maxSize.width,t.width)),height:Math.max(r.minSize.height,Math.min(r.maxSize.height,t.height))};this.updateWidget(e,{size:i})}}}toggleMinimize(e){const t=this.widgets.get(e);t&&this.updateWidget(e,{isMinimized:!t.isMinimized})}toggleVisibility(e){const t=this.widgets.get(e);t&&this.updateWidget(e,{isVisible:!t.isVisible})}bringToFront(e){this.updateWidget(e,{zIndex:this.nextZIndex++})}removeWidget(e){this.widgets.delete(e)}clearAllWidgets(){this.widgets.clear()}setEnabled(e){this.isEnabled=e}isWidgetsEnabled(){return this.isEnabled}exportConfig(){const e={widgets:Array.from(this.widgets.values()).map(t=>({id:t.id,type:t.type,title:t.title,position:t.position,size:t.size,isMinimized:t.isMinimized,isVisible:t.isVisible,settings:t.settings})),widgetTypes:Array.from(this.widgetTypes.values())};return JSON.stringify(e,null,2)}importConfig(e){try{const t=JSON.parse(e);if(t.widgets)for(const s of t.widgets)this.widgetTypes.get(s.type)&&this.createWidget(s.type,s)}catch(t){console.error("Error importing widgets config:",t)}}}const pe=new zt;function Gt(){pe.registerWidgetType({id:"time-widget",name:"–ß–∞—Å—ã",description:"–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –∏ –¥–∞—Ç—É",icon:"Clock",category:"utility",defaultSize:{width:200,height:120},minSize:{width:150,height:80},maxSize:{width:300,height:200},component:Vt,settings:[{id:"show-seconds",name:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–µ–∫—É–Ω–¥—ã",type:"boolean",defaultValue:!0,description:"–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–µ–∫—É–Ω–¥—ã –≤ —á–∞—Å–∞—Ö"},{id:"show-date",name:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞—Ç—É",type:"boolean",defaultValue:!0,description:"–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥–∞—Ç—É –ø–æ–¥ –≤—Ä–µ–º–µ–Ω–µ–º"},{id:"format24h",name:"24-—á–∞—Å–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç",type:"boolean",defaultValue:!0,description:"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 24-—á–∞—Å–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏"}]}),pe.registerWidgetType({id:"voice-widget",name:"–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥",description:"–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –≤–≤–æ–¥—É",icon:"Mic",category:"input",defaultSize:{width:180,height:100},minSize:{width:120,height:60},maxSize:{width:250,height:150},component:Wt,settings:[{id:"auto-start",name:"–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫",type:"boolean",defaultValue:!1,description:"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–ø–∏—Å—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏"},{id:"show-transcription",name:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é",type:"boolean",defaultValue:!0,description:"–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç"}]}),pe.registerWidgetType({id:"video-intro-widget",name:"–í–≤–æ–¥–Ω–æ–µ –≤–∏–¥–µ–æ",description:"–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–≤–æ–¥–Ω–æ–µ –≤–∏–¥–µ–æ –æ–¥–∏–Ω —Ä–∞–∑, –∑–∞—Ç–µ–º –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –ª–æ–≥–æ—Ç–∏–ø",icon:"Play",category:"media",defaultSize:{width:400,height:300},minSize:{width:300,height:200},maxSize:{width:600,height:400},component:Ut,settings:[{id:"autoPlay",name:"–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ",type:"boolean",defaultValue:!0,description:"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –≤–∏–¥–µ–æ"},{id:"showControls",name:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",type:"boolean",defaultValue:!1,description:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ"}]}),console.log("Widgets initialized successfully")}class Ft{constructor(e){this.metrics=[],this.observer=null,this.reportingInterval=null,this.config=e,this.sessionId=this.generateSessionId(),this.initializeMonitoring()}initializeMonitoring(){typeof window=="undefined"||!window.performance||(this.config.enableNavigationTiming&&this.collectNavigationMetrics(),this.config.enableResourceTiming&&this.setupResourceObserver(),this.config.enablePaintTiming&&this.setupPaintObserver(),this.config.enableLayoutTiming&&this.setupLayoutObserver(),this.config.enableScriptTiming&&this.setupScriptObserver(),this.config.enableReporting&&this.setupReporting())}collectNavigationMetrics(){const e=performance.getEntriesByType("navigation")[0];if(e){const t=[{id:this.generateMetricId(),name:"DOMContentLoaded",value:e.domContentLoadedEventEnd-e.domContentLoadedEventStart,unit:"ms",timestamp:new Date,category:"navigation"},{id:this.generateMetricId(),name:"LoadComplete",value:e.loadEventEnd-e.loadEventStart,unit:"ms",timestamp:new Date,category:"navigation"},{id:this.generateMetricId(),name:"FirstByte",value:e.responseStart-e.requestStart,unit:"ms",timestamp:new Date,category:"navigation"},{id:this.generateMetricId(),name:"DOMInteractive",value:e.domInteractive-e.fetchStart,unit:"ms",timestamp:new Date,category:"navigation"}];this.addMetrics(t)}}setupResourceObserver(){window.PerformanceObserver&&(this.observer=new PerformanceObserver(e=>{const t=e.getEntries(),s=[];t.forEach(r=>{this.shouldSample()&&s.push({id:this.generateMetricId(),name:`Resource_${r.name.split("/").pop()}`,value:r.duration,unit:"ms",timestamp:new Date,category:"resource",metadata:{resourceType:r.initiatorType||"unknown",resourceSize:r.transferSize||0}})}),this.addMetrics(s)}),this.observer.observe({entryTypes:["resource"]}))}setupPaintObserver(){if(!window.PerformanceObserver)return;new PerformanceObserver(t=>{const s=t.getEntries(),r=[];s.forEach(i=>{this.shouldSample()&&r.push({id:this.generateMetricId(),name:i.name,value:i.startTime,unit:"ms",timestamp:new Date,category:"paint"})}),this.addMetrics(r)}).observe({entryTypes:["paint"]})}setupLayoutObserver(){if(!window.PerformanceObserver)return;new PerformanceObserver(t=>{const s=t.getEntries(),r=[];s.forEach(i=>{this.shouldSample()&&r.push({id:this.generateMetricId(),name:"LayoutShift",value:i.value,unit:"count",timestamp:new Date,category:"layout",metadata:{hadRecentInput:i.hadRecentInput}})}),this.addMetrics(r)}).observe({entryTypes:["layout-shift"]})}setupScriptObserver(){if(!window.PerformanceObserver)return;new PerformanceObserver(t=>{const s=t.getEntries(),r=[];s.forEach(i=>{this.shouldSample()&&r.push({id:this.generateMetricId(),name:"ScriptExecution",value:i.duration,unit:"ms",timestamp:new Date,category:"script",metadata:{scriptName:i.name}})}),this.addMetrics(r)}).observe({entryTypes:["measure","mark"]})}addCustomMetric(e,t,s,r){if(!this.config.enableCustomMetrics)return;const i={id:this.generateMetricId(),name:e,value:t,unit:s,timestamp:new Date,category:"custom",metadata:r};this.addMetrics([i])}measureFunction(e,t){const s=performance.now(),r=t(),i=performance.now();return this.addCustomMetric(`Function_${e}`,i-s,"ms"),r}measureAsyncFunction(e,t){return v(this,null,function*(){const s=performance.now(),r=yield t(),i=performance.now();return this.addCustomMetric(`AsyncFunction_${e}`,i-s,"ms"),r})}getMetrics(){return[...this.metrics]}getMetricsByCategory(e){return this.metrics.filter(t=>t.category===e)}getMetricsByName(e){return this.metrics.filter(t=>t.name===e)}getPerformanceStats(){var m;const e=this.getMetricsByName("LoadComplete"),t=this.getMetricsByCategory("paint"),s=this.getMetricsByCategory("resource"),r=e.length>0?e.reduce((f,y)=>f+y.value,0)/e.length:0,i=t.length>0?t.reduce((f,y)=>f+y.value,0)/t.length:0,o=((m=performance.memory)==null?void 0:m.usedJSHeapSize)||0,c=s.sort((f,y)=>f.value-y.value),h=c.slice(-5),d=c.slice(0,5);return{totalMetrics:this.metrics.length,averageLoadTime:r,averageRenderTime:i,memoryUsage:o,slowestResources:h,fastestResources:d}}generateReport(){const e=this.getPerformanceStats();return{sessionId:this.sessionId,timestamp:new Date,metrics:this.metrics,summary:{totalMetrics:e.totalMetrics,averageLoadTime:e.averageLoadTime,averageRenderTime:e.averageRenderTime,memoryUsage:e.memoryUsage,errorCount:0}}}clearMetrics(){this.metrics=[]}stopMonitoring(){this.observer&&(this.observer.disconnect(),this.observer=null),this.reportingInterval&&(clearInterval(this.reportingInterval),this.reportingInterval=null)}addMetrics(e){this.metrics.length>=this.config.maxMetricsPerSession||this.metrics.push(...e)}shouldSample(){return Math.random()<this.config.sampleRate}setupReporting(){this.config.reportingEndpoint&&(this.reportingInterval=setInterval(()=>{const e=this.generateReport();this.sendReport(e)},this.config.reportingInterval))}sendReport(e){return v(this,null,function*(){if(this.config.reportingEndpoint)try{yield fetch(this.config.reportingEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){console.error("Failed to send performance report:",t)}})}generateSessionId(){return`perf_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateMetricId(){return`metric_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const Kt=new Ft({enableNavigationTiming:!0,enableResourceTiming:!0,enablePaintTiming:!0,enableLayoutTiming:!0,enableScriptTiming:!0,enableCustomMetrics:!0,sampleRate:.1,maxMetricsPerSession:1e3,enableReporting:!1,reportingInterval:6e4});class Yt{constructor(e){this.currentSession=null,this.sessions=[],this.events=[],this.reportingInterval=null,this.sessionTimeout=null,this.config=e,this.initializeTracking()}initializeTracking(){this.config.enableTracking&&(this.config.enableSessionTracking&&this.startSession(),this.config.enablePageTracking&&this.setupPageTracking(),this.config.enableServiceTracking&&this.setupServiceTracking(),this.config.enableReporting&&this.setupReporting(),this.setupSessionTimeout())}startSession(){this.currentSession&&this.endSession(),this.currentSession={id:this.generateSessionId(),startTime:new Date,events:[],userAgent:navigator.userAgent,referrer:document.referrer,pageViews:0,interactions:0},this.sessions.push(this.currentSession),this.resetSessionTimeout()}endSession(){this.currentSession&&(this.currentSession.endTime=new Date,this.currentSession.duration=this.currentSession.endTime.getTime()-this.currentSession.startTime.getTime(),this.currentSession=null,this.sessionTimeout&&(clearTimeout(this.sessionTimeout),this.sessionTimeout=null))}trackEvent(e,t,s,r,i){if(!this.config.enableEventTracking||!this.currentSession)return;const o={id:this.generateEventId(),type:e,action:t,component:s,service:r,timestamp:new Date,sessionId:this.currentSession.id,metadata:i};this.events.push(o),this.currentSession.events.push(o),this.currentSession.interactions++,this.currentSession.events.length>=this.config.maxEventsPerSession&&(this.endSession(),this.startSession())}trackPageView(e,t){this.config.enablePageTracking&&(this.trackEvent("page","view",void 0,void 0,l({page:e},t)),this.currentSession&&this.currentSession.pageViews++)}trackServiceUsage(e,t,s){this.config.enableServiceTracking&&this.trackEvent("service",t,void 0,e,s)}trackComponentInteraction(e,t,s){this.trackEvent("component",t,e,void 0,s)}trackError(e,t,s,r){this.trackEvent("error","occurred",t,s,l({errorMessage:e.message,errorStack:e.stack,errorName:e.name},r))}trackPerformance(e,t,s,r){this.trackEvent("performance",e,void 0,void 0,l({value:t,unit:s},r))}getUsageStats(){const e=this.sessions.length,t=this.events.length,s=e>0?this.sessions.reduce((g,x)=>g+(x.duration||0),0)/e:0,r=new Map;this.events.forEach(g=>{g.component&&r.set(g.component,(r.get(g.component)||0)+1)});const i=Array.from(r.entries()).map(([g,x])=>({component:g,count:x})).sort((g,x)=>x.count-g.count).slice(0,10),o=new Map;this.events.forEach(g=>{g.service&&o.set(g.service,(o.get(g.service)||0)+1)});const c=Array.from(o.entries()).map(([g,x])=>({service:g,count:x})).sort((g,x)=>x.count-g.count).slice(0,10),h=new Map;this.events.forEach(g=>{h.set(g.action,(h.get(g.action)||0)+1)});const d=Array.from(h.entries()).map(([g,x])=>({action:g,count:x})).sort((g,x)=>x.count-g.count).slice(0,10),m=new Date,f=new Date(m.getTime()-24*60*60*1e3),y=new Date(m.getTime()-7*24*60*60*1e3),w=new Date(m.getTime()-30*24*60*60*1e3),A=new Set(this.sessions.filter(g=>g.startTime>=f).map(g=>g.userId).filter(Boolean)).size,k=new Set(this.sessions.filter(g=>g.startTime>=y).map(g=>g.userId).filter(Boolean)).size,E=new Set(this.sessions.filter(g=>g.startTime>=w).map(g=>g.userId).filter(Boolean)).size;return{totalSessions:e,totalEvents:t,averageSessionDuration:s,mostUsedComponents:i,mostUsedServices:c,popularActions:d,userEngagement:{dailyActiveUsers:A,weeklyActiveUsers:k,monthlyActiveUsers:E}}}getEventsByType(e){return this.events.filter(t=>t.type===e)}getEventsByComponent(e){return this.events.filter(t=>t.component===e)}getEventsByService(e){return this.events.filter(t=>t.service===e)}getUserSessions(e){return this.sessions.filter(t=>t.userId===e)}clearData(){this.events=[],this.sessions=[],this.currentSession&&(this.currentSession.events=[])}stopTracking(){this.endSession(),this.reportingInterval&&(clearInterval(this.reportingInterval),this.reportingInterval=null),this.sessionTimeout&&(clearTimeout(this.sessionTimeout),this.sessionTimeout=null)}setupPageTracking(){let e=window.location.href;const t=()=>{window.location.href!==e&&(e=window.location.href,this.trackPageView(e))};window.addEventListener("popstate",t);const s=history.pushState,r=history.replaceState;history.pushState=function(...i){s.apply(history,i),t()},history.replaceState=function(...i){r.apply(history,i),t()}}setupServiceTracking(){}setupReporting(){this.config.reportingEndpoint&&(this.reportingInterval=setInterval(()=>{this.sendReport()},this.config.reportingInterval))}setupSessionTimeout(){this.resetSessionTimeout()}resetSessionTimeout(){this.sessionTimeout&&clearTimeout(this.sessionTimeout),this.sessionTimeout=setTimeout(()=>{this.endSession(),this.startSession()},this.config.sessionTimeout)}sendReport(){return v(this,null,function*(){if(!this.config.reportingEndpoint)return;const e={sessions:this.sessions,events:this.events,stats:this.getUsageStats(),timestamp:new Date};try{yield fetch(this.config.reportingEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){console.error("Failed to send analytics report:",t)}})}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateEventId(){return`event_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const fe=new Yt({enableTracking:!0,enableSessionTracking:!0,enableEventTracking:!0,enableUserTracking:!0,enablePageTracking:!0,enableServiceTracking:!0,sessionTimeout:30*60*1e3,maxEventsPerSession:1e3,enableReporting:!1,reportingInterval:5*60*1e3,enableLocalStorage:!0,enableCookies:!1}),Jt=[{id:"ozon-manager",name:"Ozon",icon:"üõí",description:"–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å Ozon",avatarUrl:"/images/agents/ozon-manager-avatar.jpg",chatAvatarUrl:"/images/agents/ozon-manager-chat.jpg",color:"bg-blue-500",welcomeMessage:"–ü—Ä–∏–≤–µ—Ç! –Ø Ozon –ú–µ–Ω–µ–¥–∂–µ—Ä. –ñ–µ–ª–∞–µ—Ç–µ –ª–∏ –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ –∞–≤—Ç–æ–∞—Ä—Ö–∏–≤–æ–≤ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ –∞–≤—Ç–æ–∞–∫—Ü–∏–π –≤ Ozon –∫–∞–±–∏–Ω–µ—Ç–µ?",initialButtons:[{id:"remove-archive",text:"–î–∞, —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ –∞–≤—Ç–æ–∞—Ä—Ö–∏–≤–∞",action:"remove_archive"},{id:"remove-promotions",text:"–î–∞, —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ –∞–≤—Ç–æ–∞–∫—Ü–∏–π",action:"remove_promotions"},{id:"both",text:"–ò —Ç–æ –∏ –¥—Ä—É–≥–æ–µ",action:"both"}]},{id:"ai-lawyer",name:"–Æ—Ä–∏—Å—Ç",icon:"‚öñÔ∏è",description:"–ü—Ä–∞–≤–æ–≤–∞—è –ø–æ–º–æ—â—å –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏",avatarUrl:"/images/agents/ai-lawyer-avatar.jpg",chatAvatarUrl:"/images/agents/ai-lawyer-chat.jpg",color:"bg-purple-500",welcomeMessage:"–ü—Ä–∏–≤–µ—Ç! –Ø AI –Æ—Ä–∏—Å—Ç. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å —Å –ø—Ä–∞–≤–æ–≤—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏?",initialButtons:[{id:"contract-review",text:"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä",action:"contract_review"},{id:"legal-advice",text:"–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é",action:"legal_advice"},{id:"document-help",text:"–ü–æ–º–æ—â—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏",action:"document_help"}]},{id:"photo-studio",name:"–§–æ—Ç–æ",icon:"üì∏",description:"–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π",avatarUrl:"/images/agents/photo-studio-avatar.jpg",chatAvatarUrl:"/images/agents/photo-studio-chat.jpg",color:"bg-green-500",welcomeMessage:"–ü—Ä–∏–≤–µ—Ç! –Ø –§–æ—Ç–æ –°—Ç—É–¥–∏—è. –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤–∞—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π!",initialButtons:[{id:"enhance-photo",text:"–£–ª—É—á—à–∏—Ç—å —Ñ–æ—Ç–æ",action:"enhance_photo"},{id:"remove-background",text:"–£–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω",action:"remove_background"},{id:"resize-image",text:"–ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä",action:"resize_image"}]}],De=u.memo(()=>{const a=Ht(),{state:e,dispatch:t}=a;return u.useEffect(()=>{Gt()},[]),u.useEffect(()=>{Bt.restoreAccentSet()},[]),u.useEffect(()=>{fe.startSession(),fe.trackPageView(window.location.href),Kt.addCustomMetric("AppLoad",performance.now(),"ms"),Me.registerErrorHandler((s,r)=>{fe.trackError(s,r==null?void 0:r.component,r==null?void 0:r.service,r==null?void 0:r.metadata)})},[]),e.isInitialized?e.isInitialized&&!e.authUser?n.jsx(Je,{onAuthSuccess:(s,r)=>v(void 0,null,function*(){console.log("[App] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞:",s),t({type:"SET_AUTH_USER",payload:s})}),onAuthError:s=>{console.error("[App] –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:",s)}}):e.isLoading?n.jsx(C.div,{className:"h-screen w-screen flex flex-col items-center justify-center bg-gray-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-4",children:"Boss AI"}),n.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"})]})}):e.error?n.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mb-4 mx-auto",children:n.jsx("span",{className:"text-2xl",children:"‚ö†Ô∏è"})}),n.jsx("h2",{className:"text-xl font-semibold mb-2",children:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"}),n.jsx("p",{className:"mb-4 text-gray-600",children:e.error}),n.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å"})]})}):n.jsx(St,{agents:Jt}):n.jsx(C.div,{className:"h-screen w-screen flex flex-col items-center justify-center bg-gray-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-4",children:"Boss AI"}),n.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"})]})})});De.displayName="AppContent";const $e=u.memo(()=>{const{handleError:a}=$t();return n.jsx(ot,{onError:a,children:n.jsxs(Dt,{children:[n.jsx(V,{mode:"wait",children:n.jsx(De,{})}),n.jsx(lt,{})]})})});$e.displayName="App";document.documentElement.getAttribute("data-theme")||document.documentElement.setAttribute("data-theme","dark");const Zt=ye.createRoot(document.getElementById("root"));Zt.render(n.jsx(ce.StrictMode,{children:n.jsx($e,{})}));export{st as R,ut as T,be as X,Ee as _,Ge as a,M as c};
