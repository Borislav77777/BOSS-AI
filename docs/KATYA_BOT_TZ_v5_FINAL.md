# üìã –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï v5.0 FINAL: Telegram Bot "–ö–∞—Ç—è" –¥–ª—è Boss AI Platform

**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** –ù–∏–∫–æ–ª–∞–π
**–î–∞—Ç–∞:** 21 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 5.0 FINAL (–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è, —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è)
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ üöÄ

---

## üéØ –¶–ï–õ–¨ –ü–†–û–ï–ö–¢–ê

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å **"–ö–∞—Ç—é"** - Telegram –±–æ—Ç–∞ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π **Institutional Knowledge** (–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏ –∫–æ–º–∞–Ω–¥—ã) –¥–ª—è Boss AI Platform:

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **–î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:**

   - üì± **Telegram Bot** - –æ—Ç–≤–µ—á–∞–µ—Ç –≤ TG —á–∞—Ç–∞—Ö –Ω–∞ @–ö–∞—Ç—è (–æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∂–∏–º)
   - üí¨ **Platform Chat** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —á–∞—Ç –≤ Boss AI (–±—É–¥—É—â–µ–µ)

2. **–ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (MVP):**

   - üß† **–°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è** - –ø–æ–¥–≤–æ–¥–∏—Ç –∏—Ç–æ–≥–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–π
   - üîç **–ü–æ–∏—Å–∫** - –Ω–∞—Ö–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏—Å—Ç–æ—Ä–∏–∏
   - üí¨ **–í–æ–ø—Ä–æ—Å—ã** - –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —á–∞—Ç–∞
   - ‚úÖ **–†–µ—à–µ–Ω–∏—è** - —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ä–µ—à–µ–Ω–∏–π

3. **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
   - ‚úÖ SQLite (shared —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π) - –ù–ï PostgreSQL!
   - ‚úÖ GPT —á–µ—Ä–µ–∑ `/api/ai/chatgpt` (–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π endpoint)
   - ‚úÖ –ï–¥–∏–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥ Boss AI (BT —Ç–æ–∫–µ–Ω—ã)
   - ‚úÖ –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –¢–µ–∫—É—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Boss AI

```
Boss AI Platform (Production)
‚îú‚îÄ‚îÄ Frontend (React + Vite) ‚Üí https://boss-ai.online
‚îú‚îÄ‚îÄ API Gateway (Node.js, port 3000)
‚îÇ   ‚îú‚îÄ‚îÄ /api/auth/* - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (Telegram Login Widget)
‚îÇ   ‚îú‚îÄ‚îÄ /api/billing/* - –±–∏–ª–ª–∏–Ω–≥ (BT —Ç–æ–∫–µ–Ω—ã)
‚îÇ   ‚îú‚îÄ‚îÄ /api/ai/chatgpt - GPT-5 nano ‚úÖ (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!)
‚îÇ   ‚îú‚îÄ‚îÄ /api/ozon/* - Ozon Manager
‚îÇ   ‚îî‚îÄ‚îÄ /api/katya/* - Katya Service (–¥–æ–±–∞–≤–∏—Ç—å)
‚îú‚îÄ‚îÄ Ozon Manager (Node.js, port 4200)
‚îî‚îÄ‚îÄ Database: SQLite (WAL mode)
    ‚îî‚îÄ‚îÄ /var/www/boss-ai/backend/ozon-manager/data/ozon_manager.db
```

**–ö–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (—É–∂–µ –µ—Å—Ç—å):**

- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (id INTEGER, telegram_id BIGINT UNIQUE)
- `sessions` - —Å–µ—Å—Å–∏–∏ JWT
- `user_balance` - –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (BT —Ç–æ–∫–µ–Ω—ã)
- `transactions` - –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- `service_pricing` - —Ç–∞—Ä–∏—Ñ—ã —Å–µ—Ä–≤–∏—Å–æ–≤

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –ö–∞—Ç–µ–π

```
Katya AI Service (NEW, port 4300)
‚îú‚îÄ‚îÄ Express API Server
‚îÇ   ‚îú‚îÄ‚îÄ /health - health check
‚îÇ   ‚îú‚îÄ‚îÄ /summarize - —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ /search - –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ /question - –≤–æ–ø—Ä–æ—Å –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
‚îÇ   ‚îú‚îÄ‚îÄ /decisions - —Å–ø–∏—Å–æ–∫ —Ä–µ—à–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ /settings - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ
‚îú‚îÄ‚îÄ Telegram Bot (polling)
‚îÇ   ‚îú‚îÄ‚îÄ @–ö–∞—Ç—è —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ —á–∞—Ç–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ –ö–æ–º–∞–Ω–¥—ã: /summary, /search, /decisions
‚îÇ   ‚îî‚îÄ‚îÄ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ
‚îú‚îÄ‚îÄ Services:
‚îÇ   ‚îú‚îÄ‚îÄ PlatformGPTService - –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ /api/ai/chatgpt ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ ContextManagerService - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
‚îÇ   ‚îî‚îÄ‚îÄ UserChatMappingService - —Å–≤—è–∑—å TG user ‚Üî platform user
‚îÇ
‚îî‚îÄ‚îÄ Database: SQLite (shared —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π)
    ‚îî‚îÄ‚îÄ –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ö–∞—Ç–∏ (—Å –∏–∑–æ–ª—è—Ü–∏–µ–π –ø–æ user_id)
```

---

## üë• –ú–ù–û–ì–û–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ë–î

### –ö–ª—é—á–µ–≤–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –ò–ó–û–õ–Ø–¶–ò–Ø –î–ê–ù–ù–´–•

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ö–∞—Ç—é –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ TG —á–∞—Ç–æ–≤ (–¥–æ–º–∞—à–Ω–∏–π, —Ä–∞–±–æ—á–∏–π, —Å–µ–º–µ–π–Ω—ã–π)
- –ö–∞–∂–¥—ã–π —á–∞—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å–≤–æ—é –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é –∏—Å—Ç–æ—Ä–∏—é
- –î–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ù–ï –¥–æ–ª–∂–Ω—ã —Å–º–µ—à–∏–≤–∞—Ç—å—Å—è —Å –¥—Ä—É–≥–∏–º–∏

**–†–µ—à–µ–Ω–∏–µ:**

```
users (–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
  ‚îú‚îÄ‚îÄ id = 123 (platform user_id)
  ‚îî‚îÄ‚îÄ telegram_id = 987654321

katya_user_chats (NEW)
  ‚îú‚îÄ‚îÄ user_id = 123 (–≤–ª–∞–¥–µ–ª–µ—Ü)
  ‚îú‚îÄ‚îÄ telegram_chat_id = -1001234567890 (—á–∞—Ç –≥–¥–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ö–∞—Ç—è)
  ‚îú‚îÄ‚îÄ chat_name = "–†–∞–±–æ—á–∏–π —á–∞—Ç –∫–æ–º–∞–Ω–¥—ã"
  ‚îî‚îÄ‚îÄ is_active = true

chat_messages (NEW)
  ‚îú‚îÄ‚îÄ user_id = 123 (–≤–ª–∞–¥–µ–ª–µ—Ü –¥–∞–Ω–Ω—ã—Ö)
  ‚îú‚îÄ‚îÄ telegram_chat_id = -1001234567890 (–≤ –∫–∞–∫–æ–º —á–∞—Ç–µ)
  ‚îú‚îÄ‚îÄ text = "–û–±—Å—É–¥–∏–ª–∏ –Ω–æ–≤—É—é —Ñ–∏—á—É"
  ‚îî‚îÄ‚îÄ created_at = 1729500000

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã: WHERE user_id = ? AND telegram_chat_id = ?
```

**–ü—Ä–∏–º–µ—Ä—ã –∏–∑–æ–ª—è—Ü–∏–∏:**

```sql
-- User 123 –¥–æ–±–∞–≤–∏–ª –ö–∞—Ç—é –≤ 3 —á–∞—Ç–∞:
katya_user_chats:
  (user_id=123, telegram_chat_id=-1001111111, chat_name="–î–æ–º–∞—à–Ω–∏–π")
  (user_id=123, telegram_chat_id=-1001222222, chat_name="–†–∞–±–æ—á–∏–π")
  (user_id=123, telegram_chat_id=-1001333333, chat_name="–•–æ–±–±–∏")

-- User 456 –¥–æ–±–∞–≤–∏–ª –ö–∞—Ç—é –≤ 1 —á–∞—Ç:
katya_user_chats:
  (user_id=456, telegram_chat_id=-1001444444, chat_name="–°—Ç–∞—Ä—Ç–∞–ø")

-- –ó–∞–ø—Ä–æ—Å —Å–æ–æ–±—â–µ–Ω–∏–π User 123 –≤ —Ä–∞–±–æ—á–µ–º —á–∞—Ç–µ:
SELECT * FROM chat_messages
WHERE user_id = 123 AND telegram_chat_id = -1001222222
ORDER BY created_at DESC LIMIT 50;

-- –ù–ï –í–ò–î–ò–¢ —Å–æ–æ–±—â–µ–Ω–∏–π –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!
```

### Mapping: Telegram User ‚Üí Platform User

**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram Bot –ø–æ–ª—É—á–∞–µ—Ç `telegram_user_id` –∏ `telegram_chat_id`, –Ω–æ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `user_id` (platform).

**–†–µ—à–µ–Ω–∏–µ:**

```typescript
// src/services/user-chat-mapping.service.ts
export class UserChatMappingService {
  private db: Database;

  /**
   * –°–≤—è–∑–∞—Ç—å Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
   * –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Telegram Login Widget,
   * –æ–Ω –µ—Å—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ users
   */
  async getPlatformUserId(telegramUserId: number): Promise<number | null> {
    const user = this.db
      .prepare(
        `
      SELECT id FROM users WHERE telegram_id = ?
    `
      )
      .get(telegramUserId);

    return user ? (user as any).id : null;
  }

  /**
   * –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –±–æ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç
   */
  async registerUserChat(
    userId: number,
    telegramChatId: number,
    chatName: string
  ): Promise<void> {
    this.db
      .prepare(
        `
      INSERT OR IGNORE INTO katya_user_chats
        (user_id, telegram_chat_id, chat_name, is_active)
      VALUES (?, ?, ?, 1)
    `
      )
      .run(userId, telegramChatId, chatName);
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–µ–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—Å—Ç—É–ø –∫ —á–∞—Ç—É
   */
  async hasAccessToChat(
    userId: number,
    telegramChatId: number
  ): Promise<boolean> {
    const chat = this.db
      .prepare(
        `
      SELECT id FROM katya_user_chats
      WHERE user_id = ? AND telegram_chat_id = ? AND is_active = 1
    `
      )
      .get(userId, telegramChatId);

    return !!chat;
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  async getUserChats(userId: number): Promise<UserChat[]> {
    return this.db
      .prepare(
        `
      SELECT
        telegram_chat_id,
        chat_name,
        created_at,
        (SELECT COUNT(*) FROM chat_messages
         WHERE user_id = ? AND telegram_chat_id = k.telegram_chat_id) as message_count
      FROM katya_user_chats k
      WHERE user_id = ? AND is_active = 1
      ORDER BY created_at DESC
    `
      )
      .all(userId, userId) as UserChat[];
  }
}

interface UserChat {
  telegram_chat_id: number;
  chat_name: string;
  created_at: number;
  message_count: number;
}
```

---

## üíæ –°–•–ï–ú–ê –ë–ê–ó–´ –î–ê–ù–ù–´–• (SQLite)

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ö–∞—Ç–∏ (–¥–æ–±–∞–≤–∏—Ç—å –≤ ozon_manager.db)

```sql
-- 1. –ß–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–≤—è–∑—å user ‚Üî telegram chat)
CREATE TABLE IF NOT EXISTS katya_user_chats (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  telegram_chat_id BIGINT NOT NULL,
  chat_name TEXT NOT NULL,
  chat_type TEXT DEFAULT 'group', -- 'group', 'supergroup', 'private'
  is_active BOOLEAN DEFAULT 1,
  created_at INTEGER DEFAULT (strftime('%s', 'now')),
  updated_at INTEGER DEFAULT (strftime('%s', 'now')),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  UNIQUE(user_id, telegram_chat_id)
);

CREATE INDEX idx_user_chats_user ON katya_user_chats(user_id);
CREATE INDEX idx_user_chats_telegram ON katya_user_chats(telegram_chat_id);

-- 2. –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–æ–≤ (—Å –∏–∑–æ–ª—è—Ü–∏–µ–π –ø–æ user_id!)
CREATE TABLE IF NOT EXISTS chat_messages (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL, -- –≤–ª–∞–¥–µ–ª–µ—Ü –¥–∞–Ω–Ω—ã—Ö (–∏–∑–æ–ª—è—Ü–∏—è!)
  telegram_chat_id BIGINT NOT NULL,
  message_id BIGINT NOT NULL,
  telegram_user_id BIGINT, -- –∫—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ
  username TEXT,
  first_name TEXT,
  text TEXT NOT NULL,
  reply_to_message_id BIGINT,
  is_katya_mention BOOLEAN DEFAULT 0,
  created_at INTEGER DEFAULT (strftime('%s', 'now')),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  UNIQUE(user_id, telegram_chat_id, message_id)
);

CREATE INDEX idx_messages_user_chat ON chat_messages(user_id, telegram_chat_id, created_at DESC);
CREATE INDEX idx_messages_mention ON chat_messages(user_id, telegram_chat_id, is_katya_mention);

-- 3. –°—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã (—Å –∏–∑–æ–ª—è—Ü–∏–µ–π!)
CREATE TABLE IF NOT EXISTS chat_summaries (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  telegram_chat_id BIGINT NOT NULL,
  summary_text TEXT NOT NULL,
  message_count INTEGER DEFAULT 0,
  start_message_id BIGINT,
  end_message_id BIGINT,
  keywords TEXT, -- JSON array
  topics TEXT,   -- JSON array
  decisions TEXT, -- JSON array
  created_at INTEGER DEFAULT (strftime('%s', 'now')),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_summaries_user_chat ON chat_summaries(user_id, telegram_chat_id, created_at DESC);

-- 4. –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π / —Ä–µ—à–µ–Ω–∏—è (—Å –∏–∑–æ–ª—è—Ü–∏–µ–π!)
CREATE TABLE IF NOT EXISTS chat_contexts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  telegram_chat_id BIGINT NOT NULL,
  topic TEXT NOT NULL,
  description TEXT,
  keywords TEXT, -- JSON
  ref_message_ids TEXT, -- JSON array
  decision TEXT,
  decided_by TEXT,
  decided_at INTEGER,
  created_at INTEGER DEFAULT (strftime('%s', 'now')),
  updated_at INTEGER DEFAULT (strftime('%s', 'now')),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_contexts_user_chat ON chat_contexts(user_id, telegram_chat_id);
CREATE INDEX idx_contexts_topic ON chat_contexts(topic);

-- 5. –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π Q&A (—Å –∏–∑–æ–ª—è—Ü–∏–µ–π!)
CREATE TABLE IF NOT EXISTS knowledge_base (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  telegram_chat_id BIGINT NOT NULL,
  question TEXT NOT NULL,
  answer TEXT NOT NULL,
  source_message_ids TEXT, -- JSON
  context_id INTEGER,
  created_by TEXT,
  relevance_score REAL DEFAULT 1.0,
  created_at INTEGER DEFAULT (strftime('%s', 'now')),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (context_id) REFERENCES chat_contexts(id) ON DELETE SET NULL
);

CREATE INDEX idx_knowledge_user_chat ON knowledge_base(user_id, telegram_chat_id);

-- 6. –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ö–∞—Ç–∏ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–¥–ª—è –±–∏–ª–ª–∏–Ω–≥–∞)
CREATE TABLE IF NOT EXISTS katya_requests (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  telegram_chat_id BIGINT,
  request_type TEXT NOT NULL, -- 'summarize', 'search', 'question'
  request_data TEXT, -- JSON
  response_data TEXT, -- JSON
  cost_bt REAL NOT NULL,
  cost_rub REAL NOT NULL,
  duration_ms INTEGER,
  created_at INTEGER DEFAULT (strftime('%s', 'now')),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_requests_user ON katya_requests(user_id, created_at DESC);
CREATE INDEX idx_requests_type ON katya_requests(request_type);

-- 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ö–∞—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE IF NOT EXISTS katya_user_settings (
  user_id INTEGER PRIMARY KEY,
  telegram_enabled BOOLEAN DEFAULT 1,
  platform_chat_enabled BOOLEAN DEFAULT 0, -- –ø–æ–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–æ
  auto_summarize BOOLEAN DEFAULT 0,
  auto_summarize_threshold INTEGER DEFAULT 100,
  context_window INTEGER DEFAULT 50,
  ai_model TEXT DEFAULT 'gpt-4o-mini', -- fallback –µ—Å–ª–∏ gpt-5-nano –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
  updated_at INTEGER DEFAULT (strftime('%s', 'now')),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

### –ú–∏–≥—Ä–∞—Ü–∏—è (–¥–æ–±–∞–≤–∏—Ç—å –≤ katya-service)

```typescript
// src/database/migrations.ts
import Database from "better-sqlite3";

export function runKatyaMigrations(db: Database.Database): void {
  // WAL mode –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  db.pragma("journal_mode = WAL");
  db.pragma("synchronous = NORMAL");
  db.pragma("busy_timeout = 5000");

  // –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ CREATE TABLE IF NOT EXISTS ... (—Å–º. –≤—ã—à–µ)

  console.log("‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ö–∞—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ");
}
```

---

## ü§ñ AI –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –ß–ï–†–ï–ó –ü–õ–ê–¢–§–û–†–ú–£

### PlatformGPTService (–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ /api/ai/chatgpt)

```typescript
// src/services/platform-gpt.service.ts
import axios, { AxiosInstance } from "axios";

export class PlatformGPTService {
  private client: AxiosInstance;
  private apiGatewayUrl: string;

  constructor(apiGatewayUrl: string = "https://boss-ai.online") {
    this.apiGatewayUrl = apiGatewayUrl;

    this.client = axios.create({
      baseURL: this.apiGatewayUrl,
      timeout: 60000,
      headers: {
        "Content-Type": "application/json",
        "X-Service": "katya-ai",
      },
    });
  }

  /**
   * –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π GPT
   * –ë–∏–ª–ª–∏–Ω–≥ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ middleware –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã!
   */
  async summarize(
    messages: string[],
    userToken: string,
    context?: string
  ): Promise<SummaryResult> {
    const prompt = this.buildSummarizationPrompt(messages, context);

    try {
      const response = await this.client.post(
        "/api/ai/chatgpt",
        {
          prompt,
          options: {
            model: "gpt-4o-mini", // –∏–ª–∏ 'gpt-5-nano' –∫–æ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω
            temperature: 0.3,
            max_tokens: 2000,
          },
        },
        {
          headers: {
            Authorization: `Bearer ${userToken}`, // –¢–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
          },
        }
      );

      if (!response.data.success) {
        throw new Error(response.data.error?.message || "AI request failed");
      }

      // –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç
      const content = response.data.data.choices[0].message.content;

      // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ)
      return {
        summary: content,
        topics: this.extractTopics(content),
        decisions: this.extractDecisions(content),
        keywords: this.extractKeywords(content),
      };
    } catch (error: any) {
      console.error("–û—à–∏–±–∫–∞ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏:", error);

      if (error.response?.status === 402) {
        throw new Error("Insufficient funds");
      }

      throw error;
    }
  }

  /**
   * –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ + AI —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
   */
  async searchAndRank(
    query: string,
    searchResults: string[],
    userToken: string
  ): Promise<string> {
    const prompt = this.buildSearchPrompt(query, searchResults);

    try {
      const response = await this.client.post(
        "/api/ai/chatgpt",
        {
          prompt,
          options: {
            model: "gpt-4o-mini",
            temperature: 0.5,
            max_tokens: 1500,
          },
        },
        {
          headers: { Authorization: `Bearer ${userToken}` },
        }
      );

      return response.data.data.choices[0].message.content;
    } catch (error: any) {
      console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:", error);
      throw error;
    }
  }

  /**
   * –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å
   */
  async answer(
    question: string,
    context: string[],
    userToken: string
  ): Promise<string> {
    const prompt = this.buildQuestionPrompt(question, context);

    try {
      const response = await this.client.post(
        "/api/ai/chatgpt",
        {
          prompt,
          options: {
            model: "gpt-4o-mini",
            temperature: 0.7,
            max_tokens: 1000,
          },
        },
        {
          headers: { Authorization: `Bearer ${userToken}` },
        }
      );

      return response.data.data.choices[0].message.content;
    } catch (error: any) {
      console.error("–û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞:", error);
      throw error;
    }
  }

  // –ü—Ä–æ–º–ø—Ç—ã
  private buildSummarizationPrompt(
    messages: string[],
    context?: string
  ): string {
    return `–¢—ã - –ö–∞—Ç—è, AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∫–æ–º–∞–Ω–¥—ã Boss AI.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: ${context || "–û–±—â–µ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ"}

–°–æ–æ–±—â–µ–Ω–∏—è (${messages.length} —à—Ç.):
${messages.join("\n---\n")}

–í—ã–¥–µ–ª–∏:
- –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã –æ–±—Å—É–∂–¥–µ–Ω–∏—è
- –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è (–∫—Ç–æ —Ä–µ—à–∏–ª, –∫–æ–≥–¥–∞)
- –ù–µ—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞

–û—Ç–≤–µ—Ç –¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ.`;
  }

  private buildSearchPrompt(query: string, results: string[]): string {
    return `–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "${query}"

–ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è:
${results.map((r, i) => `${i + 1}. ${r}`).join("\n\n")}

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ –¥–∞–π –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç —Å –æ—Ç—Å—ã–ª–∫–∞–º–∏ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º.`;
  }

  private buildQuestionPrompt(question: string, context: string[]): string {
    return `–¢—ã - –ö–∞—Ç—è. –û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–æ–º–∞–Ω–¥—ã.

–í–æ–ø—Ä–æ—Å: ${question}

–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏:
${context.join("\n---\n")}

–î–∞–π –∫—Ä–∞—Ç–∫–∏–π –∏ —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç.`;
  }

  // –£—Ç–∏–ª–∏—Ç—ã
  private extractTopics(text: string): string[] {
    // –ü—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ (—É–ª—É—á—à–∏—Ç—å!)
    const matches = text.match(/—Ç–µ–º—ã?:?\s*([^\n]+)/i);
    if (matches) {
      return matches[1]
        .split(",")
        .map((t) => t.trim())
        .filter(Boolean);
    }
    return [];
  }

  private extractDecisions(text: string): Array<{ decision: string }> {
    // –ü—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ (—É–ª—É—á—à–∏—Ç—å!)
    const matches = text.match(/—Ä–µ—à–µ–Ω–∏[—è–µ]:?\s*([^\n]+)/i);
    if (matches) {
      return [{ decision: matches[1].trim() }];
    }
    return [];
  }

  private extractKeywords(text: string): string[] {
    // –ü—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ (—É–ª—É—á—à–∏—Ç—å!)
    const words = text.toLowerCase().match(/\b\w{4,}\b/g) || [];
    return [...new Set(words)].slice(0, 5);
  }
}

interface SummaryResult {
  summary: string;
  topics: string[];
  decisions: Array<{ decision: string }>;
  keywords: string[];
}
```

---

## üì± TELEGRAM BOT

### Telegram Bot —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```typescript
// src/telegram/bot.ts
import TelegramBot from "node-telegram-bot-api";
import Database from "better-sqlite3";
import { PlatformGPTService } from "../services/platform-gpt.service";
import { UserChatMappingService } from "../services/user-chat-mapping.service";
import { MessagesRepository } from "../database/repositories/messages.repo";

export class KatyaTelegramBot {
  private bot: TelegramBot;
  private db: Database.Database;
  private platformGPT: PlatformGPTService;
  private userChatMapping: UserChatMappingService;
  private messagesRepo: MessagesRepository;

  constructor(botToken: string, dbPath: string, apiGatewayUrl: string) {
    this.bot = new TelegramBot(botToken, { polling: true });
    this.db = new Database(dbPath);
    this.platformGPT = new PlatformGPTService(apiGatewayUrl);
    this.userChatMapping = new UserChatMappingService(this.db);
    this.messagesRepo = new MessagesRepository(this.db);

    this.setupHandlers();
    console.log("‚úÖ Telegram –±–æ—Ç –ö–∞—Ç—è –∑–∞–ø—É—â–µ–Ω");
  }

  private setupHandlers() {
    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    this.bot.on("message", async (msg) => {
      try {
        // –ü–æ–ª—É—á–∏—Ç—å platform user_id –ø–æ telegram_id
        const userId = await this.userChatMapping.getPlatformUserId(
          msg.from!.id
        );

        if (!userId) {
          // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
          console.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${msg.from!.id} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ`);
          return;
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        await this.messagesRepo.create({
          userId,
          telegramChatId: msg.chat.id,
          messageId: msg.message_id,
          telegramUserId: msg.from!.id,
          username: msg.from!.username || "unknown",
          firstName: msg.from!.first_name,
          text: msg.text || "",
          isKatyaMention: this.isMentioned(msg.text),
        });
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –≤ —á–∞—Ç
    this.bot.on("my_chat_member", async (update) => {
      if (
        update.new_chat_member.status === "member" ||
        update.new_chat_member.status === "administrator"
      ) {
        // –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç
        const addedBy = update.from;
        const chat = update.chat;

        const userId = await this.userChatMapping.getPlatformUserId(addedBy.id);

        if (!userId) {
          await this.bot.sendMessage(
            chat.id,
            `‚ö†Ô∏è –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ö–∞—Ç—é, —Å–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –Ω–∞ https://boss-ai.online —á–µ—Ä–µ–∑ Telegram Login`
          );
          return;
        }

        // –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await this.userChatMapping.registerUserChat(
          userId,
          chat.id,
          chat.title || "Private chat"
        );

        await this.bot.sendMessage(
          chat.id,
          `üëã –ü—Ä–∏–≤–µ—Ç! –Ø –ö–∞—Ç—è - AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∫–æ–º–∞–Ω–¥—ã Boss AI.\n\n` +
            `–Ø –º–æ–≥—É:\n` +
            `üìä –°—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏—è (@–ö–∞—Ç—è –ø–æ–¥–≤–µ–¥–∏ –∏—Ç–æ–≥–∏)\n` +
            `üîç –ò—Å–∫–∞—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ (/search –∑–∞–ø—Ä–æ—Å)\n` +
            `üí¨ –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã\n` +
            `‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è (/decisions)\n\n` +
            `–£–ø–æ–º—è–Ω–∏—Ç–µ –º–µ–Ω—è –≤ —á–∞—Ç–µ (@–ö–∞—Ç—è) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã!`
        );
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ @–ö–∞—Ç—è —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
    this.bot.on("message", async (msg) => {
      if (!this.isMentioned(msg.text)) return;

      try {
        const userId = await this.userChatMapping.getPlatformUserId(
          msg.from!.id
        );

        if (!userId) {
          await this.bot.sendMessage(
            msg.chat.id,
            "‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –Ω–∞ https://boss-ai.online",
            { reply_to_message_id: msg.message_id }
          );
          return;
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —á–∞—Ç—É
        const hasAccess = await this.userChatMapping.hasAccessToChat(
          userId,
          msg.chat.id
        );

        if (!hasAccess) {
          await this.bot.sendMessage(
            msg.chat.id,
            "‚ö†Ô∏è –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É —á–∞—Ç—É",
            { reply_to_message_id: msg.message_id }
          );
          return;
        }

        await this.bot.sendChatAction(msg.chat.id, "typing");

        // –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å –∏–∑–æ–ª—è—Ü–∏–µ–π!)
        const messages = await this.messagesRepo.getLastMessages(
          userId,
          msg.chat.id,
          50
        );

        // ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –£ –Ω–∞—Å –Ω–µ—Ç platform token –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
        // –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SYSTEM_TOKEN (–±–µ–∑ –±–∏–ª–ª–∏–Ω–≥–∞ –¥–ª—è TG —Ä–µ–∂–∏–º–∞)
        // –ò–õ–ò: —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ TG —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –∏ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã

        const systemToken = process.env.SYSTEM_TOKEN || "";

        const summary = await this.platformGPT.summarize(
          messages.map((m) => `${m.username}: ${m.text}`),
          systemToken, // ‚ö†Ô∏è –ë–µ–∑ –±–∏–ª–ª–∏–Ω–≥–∞ (system token)
          msg.text
        );

        await this.bot.sendMessage(msg.chat.id, this.formatSummary(summary), {
          parse_mode: "Markdown",
          reply_to_message_id: msg.message_id,
        });
      } catch (error: any) {
        console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ @–ö–∞—Ç—è:", error);
        await this.bot.sendMessage(msg.chat.id, `‚ö†Ô∏è –û—à–∏–±–∫–∞: ${error.message}`, {
          reply_to_message_id: msg.message_id,
        });
      }
    });

    // –ö–æ–º–∞–Ω–¥—ã
    this.bot.onText(/\/summary/, (msg) => this.handleSummaryCommand(msg));
    this.bot.onText(/\/search (.+)/, (msg, match) =>
      this.handleSearchCommand(msg, match)
    );
    this.bot.onText(/\/decisions/, (msg) => this.handleDecisionsCommand(msg));
  }

  private isMentioned(text?: string): boolean {
    if (!text) return false;
    return (
      text.includes("@–ö–∞—Ç—è") ||
      text.includes("@Katya") ||
      text.includes("@katya_boss_ai_bot")
    );
  }

  private formatSummary(summary: SummaryResult): string {
    return (
      `üìä *–°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è*\n\n` +
      `${summary.summary}\n\n` +
      `üîë *–ö–ª—é—á–µ–≤—ã–µ —Ç–µ–º—ã:*\n${summary.topics
        .map((t) => `‚Ä¢ ${t}`)
        .join("\n")}\n\n` +
      `‚úÖ *–†–µ—à–µ–Ω–∏—è:*\n${
        summary.decisions.map((d) => `‚Ä¢ ${d.decision}`).join("\n") || "–ù–µ—Ç"
      }`
    );
  }

  private async handleSummaryCommand(msg: TelegramBot.Message) {
    // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ @–ö–∞—Ç—è mention
  }

  private async handleSearchCommand(
    msg: TelegramBot.Message,
    match: RegExpExecArray | null
  ) {
    const query = match?.[1];
    if (!query) return;

    const userId = await this.userChatMapping.getPlatformUserId(msg.from!.id);
    if (!userId) return;

    // –ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º (—Å –∏–∑–æ–ª—è—Ü–∏–µ–π!)
    const results = await this.messagesRepo.search(
      userId,
      msg.chat.id,
      query,
      10
    );

    if (results.length === 0) {
      await this.bot.sendMessage(msg.chat.id, "‚ùå –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ");
      return;
    }

    const response =
      `üîç *–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:*\n\n` +
      results
        .map((r, i) => `${i + 1}. ${r.text.substring(0, 100)}...`)
        .join("\n\n");

    await this.bot.sendMessage(msg.chat.id, response, {
      parse_mode: "Markdown",
    });
  }

  private async handleDecisionsCommand(msg: TelegramBot.Message) {
    const userId = await this.userChatMapping.getPlatformUserId(msg.from!.id);
    if (!userId) return;

    // –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—à–µ–Ω–∏—è (—Å –∏–∑–æ–ª—è—Ü–∏–µ–π!)
    const decisions = await this.db
      .prepare(
        `
      SELECT decision, decided_by, decided_at
      FROM chat_contexts
      WHERE user_id = ? AND telegram_chat_id = ? AND decision IS NOT NULL
      ORDER BY decided_at DESC
      LIMIT 10
    `
      )
      .all(userId, msg.chat.id);

    if (decisions.length === 0) {
      await this.bot.sendMessage(msg.chat.id, "‚úÖ –ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ä–µ—à–µ–Ω–∏–π");
      return;
    }

    const response =
      `‚úÖ *–ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è:*\n\n` +
      decisions
        .map((d: any, i) => `${i + 1}. ${d.decision}\n   _by ${d.decided_by}_`)
        .join("\n\n");

    await this.bot.sendMessage(msg.chat.id, response, {
      parse_mode: "Markdown",
    });
  }
}
```

---

## üîå BACKEND API ENDPOINTS

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Katya Service

```
backend/katya-service/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts                # Express server (port 4300)
‚îÇ   ‚îú‚îÄ‚îÄ config/index.ts         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ summarize.route.ts  # POST /summarize
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search.route.ts     # POST /search
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ question.route.ts   # POST /question
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decisions.route.ts  # GET /decisions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.route.ts   # GET/PUT /settings
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health.route.ts     # GET /health
‚îÇ   ‚îú‚îÄ‚îÄ telegram/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bot.ts              # Telegram Bot
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ platform-gpt.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user-chat-mapping.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ context-manager.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ messages.repo.ts
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ summaries.repo.ts
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ contexts.repo.ts
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ logger.ts
‚îÇ       ‚îî‚îÄ‚îÄ prompts.ts
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```

### API Routes (–ø—Ä–∏–º–µ—Ä—ã)

```typescript
// src/routes/summarize.route.ts
import { Router, Request, Response } from "express";
import { PlatformGPTService } from "../services/platform-gpt.service";
import { MessagesRepository } from "../database/repositories/messages.repo";

const router = Router();
const platformGPT = new PlatformGPTService();
const messagesRepo = new MessagesRepository();

/**
 * POST /summarize
 * –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –æ–±—Å—É–∂–¥–µ–Ω–∏–π —Å –∏–∑–æ–ª—è—Ü–∏–µ–π –ø–æ user_id
 */
router.post("/summarize", async (req: Request, res: Response) => {
  try {
    const { telegramChatId, messageCount = 50, query } = req.body;
    const userId = (req as any).user.id; // –∏–∑ authenticateToken middleware
    const userToken = req.headers.authorization?.replace("Bearer ", "");

    if (!userToken) {
      return res.status(401).json({ success: false, error: "Unauthorized" });
    }

    // –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è (–° –ò–ó–û–õ–Ø–¶–ò–ï–ô!)
    const messages = await messagesRepo.getLastMessages(
      userId,
      telegramChatId,
      messageCount
    );

    if (messages.length === 0) {
      return res.json({
        success: true,
        data: {
          summary: "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏",
          topics: [],
          decisions: [],
          keywords: [],
        },
      });
    }

    // –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
    const summary = await platformGPT.summarize(
      messages.map((m) => `${m.username}: ${m.text}`),
      userToken,
      query
    );

    res.json({
      success: true,
      data: summary,
    });
  } catch (error: any) {
    console.error("Summarize error:", error);

    if (error.message === "Insufficient funds") {
      return res.status(402).json({
        success: false,
        error: "Insufficient funds",
        message: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å BT —Ç–æ–∫–µ–Ω–æ–≤.",
      });
    }

    res.status(500).json({
      success: false,
      error: error.message || "Internal server error",
    });
  }
});

export default router;
```

---

## üí∞ –ë–ò–õ–õ–ò–ù–ì

### Pricing –¥–ª—è –ö–∞—Ç–∏

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –≤ service_pricing
INSERT OR IGNORE INTO service_pricing (service_name, unit_type, price_per_unit, currency, is_active) VALUES
  ('katya_summarize', 'request', 5.0, 'RUB', 1),  -- —Å—Ç–æ–∏–º–æ—Å—Ç—å /api/ai/chatgpt
  ('katya_search', 'request', 2.0, 'RUB', 1),
  ('katya_question', 'request', 3.0, 'RUB', 1);
```

### –ë–∏–ª–ª–∏–Ω–≥ –¥–ª—è Telegram —Ä–µ–∂–∏–º–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –£ Telegram —Å–æ–æ–±—â–µ–Ω–∏–π –ù–ï–¢ platform token ‚Üí –ù–ï–¢ –±–∏–ª–ª–∏–Ω–≥–∞!

**–†–µ—à–µ–Ω–∏—è:**

**–í–∞—Ä–∏–∞–Ω—Ç A (–ø—Ä–æ—Å—Ç–æ–π, –¥–ª—è MVP):**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SYSTEM_TOKEN` –¥–ª—è TG —Ä–µ–∂–∏–º–∞
- **–ù–ï —Å–ø–∏—Å—ã–≤–∞—Ç—å** –¥–µ–Ω—å–≥–∏ –∑–∞ TG –∑–∞–ø—Ä–æ—Å—ã
- Telegram –±–æ—Ç = –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π (–¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

**–í–∞—Ä–∏–∞–Ω—Ç B (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –¥–ª—è production):**

- –¢—Ä–µ–±–æ–≤–∞—Ç—å —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ TG –∞–∫–∫–∞—É–Ω—Ç–∞ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
- –•—Ä–∞–Ω–∏—Ç—å `platform_token` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `telegram_id`
- –°–ø–∏—Å—ã–≤–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è MVP:** –í–∞—Ä–∏–∞–Ω—Ç A (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π TG –±–æ—Ç)

---

## üöÄ DEPLOYMENT

### PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```javascript
// ecosystem.config.js (–¥–æ–±–∞–≤–∏—Ç—å)
{
  name: "boss-ai-katya-service",
  script: "dist/index.js",
  cwd: "/var/www/boss-ai/backend/katya-service",
  instances: 1,
  exec_mode: "fork",
  env: {
    NODE_ENV: "production",
    PORT: 4300,

    // Database (shared —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π)
    DB_PATH: "/var/www/boss-ai/backend/ozon-manager/data/ozon_manager.db",

    // API Gateway
    API_GATEWAY_URL: "https://boss-ai.online",

    // Telegram Bot
    TELEGRAM_BOT_TOKEN: "<–ø–æ–ª—É—á–∏—Ç—å –æ—Ç @BotFather>",
    TELEGRAM_BOT_USERNAME: "katya_boss_ai_bot",

    // System Token (–¥–ª—è TG –±–µ–∑ –±–∏–ª–ª–∏–Ω–≥–∞)
    SYSTEM_TOKEN: "<–≤–∑—è—Ç—å –∏–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã>",

    // Logging
    LOG_LEVEL: "info"
  },
  error_file: "./logs/katya_err.log",
  out_file: "./logs/katya_out.log",
  time: true,
  autorestart: true,
  watch: false,
  max_memory_restart: "512M"
}
```

### API Gateway Integration

```typescript
// backend/main/src/routes/katya.routes.ts (–ù–û–í–´–ô –§–ê–ô–õ!)
import { Router } from "express";
import { authenticateToken } from "../middleware/auth.middleware";
import { ProxyClient } from "../utils/proxy";

const router = Router();

const createKatyaProxy = (): ProxyClient => {
  return new ProxyClient({
    baseURL: process.env.KATYA_SERVICE_URL || "http://localhost:4300",
    timeout: 60000,
    headers: {
      "X-Service": "katya-ai",
    },
  });
};

const katyaProxy = createKatyaProxy();

/**
 * –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ö–∞—Ç–µ
 * Middleware: authenticateToken (–¥–ª—è —Ç–æ–∫–µ–Ω–∞ user)
 */
router.use("/api/katya/*", authenticateToken, async (req, res) => {
  try {
    const targetPath = req.originalUrl.replace("/api/katya", "");

    const result = await katyaProxy.request(
      req.method as any,
      targetPath,
      req.body,
      {
        headers: {
          Authorization: req.headers.authorization, // –ü–µ—Ä–µ–¥–∞–µ–º —Ç–æ–∫–µ–Ω!
        },
      }
    );

    res.json(result);
  } catch (error: any) {
    res.status(error.status || 500).json(
      error.data || {
        success: false,
        error: error.message,
      }
    );
  }
});

export default router;
```

–î–æ–±–∞–≤–∏—Ç—å –≤ `backend/main/src/index.ts`:

```typescript
import katyaRoutes from "./routes/katya.routes";

// –í setupRoutes():
this.app.use(katyaRoutes);
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –†–ê–ó–†–ê–ë–û–¢–ö–ò

### –≠—Ç–∞–ø 1: Backend Core (3-4 –¥–Ω—è)

- [ ] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Express server (port 4300)
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite –ë–î (shared —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü (—Å user_id –∏–∑–æ–ª—è—Ü–∏–µ–π!)
- [ ] Health check endpoint
- [ ] Logger setup

### –≠—Ç–∞–ø 2: PlatformGPTService (2 –¥–Ω—è)

- [ ] –ö–ª–∞—Å—Å `PlatformGPTService`
- [ ] –ú–µ—Ç–æ–¥ `summarize()` —á–µ—Ä–µ–∑ `/api/ai/chatgpt`
- [ ] –ú–µ—Ç–æ–¥ `searchAndRank()`
- [ ] –ú–µ—Ç–æ–¥ `answer()`
- [ ] –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è GPT
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (402 Insufficient funds)

### –≠—Ç–∞–ø 3: UserChatMappingService (1 –¥–µ–Ω—å)

- [ ] –ö–ª–∞—Å—Å `UserChatMappingService`
- [ ] –ú–µ—Ç–æ–¥ `getPlatformUserId(telegram_id)`
- [ ] –ú–µ—Ç–æ–¥ `registerUserChat()`
- [ ] –ú–µ—Ç–æ–¥ `hasAccessToChat()`
- [ ] –ú–µ—Ç–æ–¥ `getUserChats()`

### –≠—Ç–∞–ø 4: Database Repositories (2 –¥–Ω—è)

- [ ] `MessagesRepository` - CRUD —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- [ ] `SummariesRepository` - CRUD —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- [ ] `ContextsRepository` - CRUD —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- [ ] All queries: `WHERE user_id = ? AND telegram_chat_id = ?`

### –≠—Ç–∞–ø 5: API Routes (2 –¥–Ω—è)

- [ ] POST `/summarize` —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- [ ] POST `/search` —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- [ ] POST `/question` —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- [ ] GET `/decisions` —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- [ ] GET/PUT `/settings`

### –≠—Ç–∞–ø 6: Telegram Bot (3-4 –¥–Ω—è)

- [ ] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ (polling)
- [ ] Handler: `my_chat_member` (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —á–∞—Ç)
- [ ] Handler: `message` (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [ ] Handler: @–ö–∞—Ç—è —É–ø–æ–º–∏–Ω–∞–Ω–∏—è
- [ ] –ö–æ–º–∞–Ω–¥—ã: `/summary`, `/search`, `/decisions`
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ user_id

### –≠—Ç–∞–ø 7: API Gateway Proxy (1 –¥–µ–Ω—å)

- [ ] –î–æ–±–∞–≤–∏—Ç—å `/api/katya/*` —Ä–æ—É—Ç—ã –≤ API Gateway
- [ ] –ü—Ä–æ–∫—Å–∏ –∫ Katya Service (port 4300)
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å authenticateToken middleware

### –≠—Ç–∞–ø 8: PM2 & Deployment (1 –¥–µ–Ω—å)

- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PM2 –¥–ª—è katya-service
- [ ] .env.example —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- [ ] README.md –∏ INTEGRATION.md
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏

### –≠—Ç–∞–ø 9: Testing (2-3 –¥–Ω—è)

- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è PlatformGPTService
- [ ] Integration —Ç–µ—Å—Ç—ã –¥–ª—è routes
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram –±–æ—Ç–∞
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] E2E —Ç–µ—Å—Ç—ã

**–ò—Ç–æ–≥–æ:** ~17-20 –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üì¶ DELIVERABLES –î–õ–Ø –ù–ò–ö–û–õ–ê–Ø

–ü–æ—Å–ª–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ù–∏–∫–æ–ª–∞–π –¥–æ–ª–∂–µ–Ω –ø—Ä–∏—Å–ª–∞—Ç—å:

### 1. katya-service.tar.gz

```
katya-service/
‚îú‚îÄ‚îÄ dist/                  # Compiled JavaScript
‚îú‚îÄ‚îÄ node_modules/          # Dependencies
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ package-lock.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ INTEGRATION.md
```

### 2. katya-service.json (–¥–ª—è frontend/public/services/)

```json
{
  "id": "katya-ai-service",
  "name": "–ö–∞—Ç—è AI",
  "description": "AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é –∫–æ–º–∞–Ω–¥—ã",
  "icon": "Brain",
  "version": "1.0.0",
  "isActive": true,
  "category": "ai",
  "priority": 2,
  "author": "–ù–∏–∫–æ–ª–∞–π –¥–ª—è BOSS AI Team",
  "tools": [
    {
      "id": "summarize-chat",
      "name": "üìä –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è",
      "description": "–ü–æ–¥–≤–æ–¥–∏—Ç –∏—Ç–æ–≥–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–π",
      "icon": "FileText",
      "action": "summarize",
      "isEnabled": true,
      "category": "analysis",
      "isChatFunction": true,
      "chatPrompt": "–ü–æ–¥–≤–µ–¥–∏ –∏—Ç–æ–≥–∏: {userInput}",
      "chatApiEndpoint": "/api/katya/summarize",
      "pricing": {
        "type": "per_request",
        "cost_bt": 0.5,
        "cost_rub": 5.0
      }
    }
  ],
  "telegram": {
    "enabled": true,
    "bot_username": "katya_boss_ai_bot"
  }
}
```

### 3. migrations.sql

```sql
-- SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü –ö–∞—Ç–∏
-- (—Å–º. —Ä–∞–∑–¥–µ–ª "–°–•–ï–ú–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•")
```

### 4. INTEGRATION.md

```markdown
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Katya Service –≤ Boss AI Platform

## 1. –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤

\`\`\`bash
cd /var/www/boss-ai/backend
mkdir katya-service
cd katya-service
tar -xzf ~/katya-service.tar.gz
\`\`\`

## 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env

\`\`\`bash
cp .env.example .env
nano .env
\`\`\`

–ó–∞–ø–æ–ª–Ω–∏—Ç—å:
\`\`\`env
TELEGRAM_BOT_TOKEN=<–æ—Ç @BotFather>
DB_PATH=/var/www/boss-ai/backend/ozon-manager/data/ozon_manager.db
API_GATEWAY_URL=https://boss-ai.online
SYSTEM_TOKEN=<–≤–∑—è—Ç—å –∏–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã>
\`\`\`

## 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

\`\`\`bash
sqlite3 /var/www/boss-ai/backend/ozon-manager/data/ozon_manager.db < migrations.sql
\`\`\`

## 4. –î–æ–±–∞–≤–∏—Ç—å –≤ PM2

(—Å–º. —Ä–∞–∑–¥–µ–ª DEPLOYMENT)

## 5. –û–±–Ω–æ–≤–∏—Ç—å API Gateway

(—Å–º. —Ä–∞–∑–¥–µ–ª API Gateway Integration)

## 6. –ü—Ä–æ–≤–µ—Ä–∫–∞

\`\`\`bash
curl http://localhost:4300/health
pm2 logs boss-ai-katya-service --lines 50
\`\`\`
```

---

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò v5.0

### –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –≤–µ—Ä—Å–∏—è–º–∏:

1. ‚úÖ **SQLite –≤–º–µ—Å—Ç–æ PostgreSQL**

   - –ù–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
   - Shared –ë–î —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
   - –ü—Ä–æ—â–µ –∏ –±—ã—Å—Ç—Ä–µ–µ

2. ‚úÖ **–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è**

   - –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å `user_id`
   - `telegram_chat_id` –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤
   - `WHERE user_id = ? AND telegram_chat_id = ?`

3. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π**

   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `users` (—É–∂–µ –µ—Å—Ç—å!)
   - Mapping: `telegram_id` ‚Üí `user_id`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —á–∞—Ç–∞–º

4. ‚úÖ **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (MVP)**

   - ‚ùå –£–±—Ä–∞–Ω–æ: PostgreSQL, Mini App, Knowledge Graph
   - ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω–æ: Core —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, Telegram Bot, Billing

5. ‚úÖ **–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ**

   - –í—Å–µ AI –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ `/api/ai/chatgpt`
   - –û–¥–∏–Ω OpenAI –∫–ª—é—á
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥

6. ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤**
   - User –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ö–∞—Ç—é –≤ —Ä–∞–∑–Ω—ã–µ —á–∞—Ç—ã
   - –ö–∞–∂–¥—ã–π —á–∞—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π
   - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è

---

## üí° ROADMAP (Phase 2)

### –ü–æ—Å–ª–µ MVP:

- üìä **Platform Chat** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Boss AI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- üîç **Semantic Search** - –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (pgvector)
- üï∏Ô∏è **Knowledge Graph** - –≥—Ä–∞—Ñ —Å–≤—è–∑–µ–π
- üì± **Telegram Mini App** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- üí∞ **Billing –¥–ª—è TG** - —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ TG ‚Üî platform —Ç–æ–∫–µ–Ω–æ–≤
- üîî **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- üì§ **Export** - PDF/Markdown —ç–∫—Å–ø–æ—Ä—Ç –∑–Ω–∞–Ω–∏–π

---

## üìã –ß–¢–û –ù–£–ñ–ù–û –û–¢ @BOSS –ü–ï–†–ï–î –°–¢–ê–†–¢–û–ú

### –î–ª—è –ù–∏–∫–æ–ª–∞—è:

1. **–î–æ—Å—Ç—É–ø –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É** (staging environment)

   - URL: `https://staging.boss-ai.online` –∏–ª–∏ `https://boss-ai.online`
   - SSH –¥–æ—Å—Ç—É–ø –¥–ª—è –¥–µ–ø–ª–æ—è

2. **–¢–µ—Å—Ç–æ–≤—ã–π platform token**

   - –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `/api/ai/chatgpt`
   - –ü–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

3. **–ö–æ–ø–∏—è –ë–î –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

   - `ozon_manager.db` —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - –ò–ª–∏ –¥–æ—Å—Ç—É–ø –∫ dev –ë–î

4. **Telegram Bot Token**

   - –°–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ @BotFather
   - `katya_test_bot` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

5. **System Token**

   - –î–ª—è TG —Ä–µ–∂–∏–º–∞ –±–µ–∑ –±–∏–ª–ª–∏–Ω–≥–∞
   - –ü–æ–ª—É—á–∏—Ç—å —É @boss

6. **–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - `backend/ozon-manager/` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
   - `backend/main/src/routes/ai.routes.ts` - –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç GPT endpoint

---

## üåê –í–ï–ë-–ò–ù–¢–ï–†–§–ï–ô–° –î–õ–Ø –ü–†–û–°–ú–û–¢–†–ê –ß–ê–¢–û–í (–£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û!)

### –û–ø–∏—Å–∞–Ω–∏–µ

–í Boss AI Platform —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω **–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ Telegram —á–∞—Ç–æ–≤ —Å –ö–∞—Ç–µ–π**. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç:

- –í–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–≤–æ–∏—Ö TG —á–∞—Ç–æ–≤, –≥–¥–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ö–∞—Ç—è
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞
- –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ AI (—Å —Å–ø–∏—Å–∞–Ω–∏–µ–º BT —Ç–æ–∫–µ–Ω–æ–≤)
- –í–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π, —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –ö–∞—Ç–∏, —Ç–æ–ø —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

### Backend API Endpoints (—É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç)

```
GET  /api/katya-chats                      - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET  /api/katya-chats/:chatId              - –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞
GET  /api/katya-chats/:chatId/messages     - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)
GET  /api/katya-chats/:chatId/stats        - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞
POST /api/katya-chats/:chatId/summarize    - –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞ —á–µ—Ä–µ–∑ AI
```

**–í–∞–∂–Ω–æ:** –≠—Ç–∏ endpoints —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ API Gateway –∏ —Ä–∞–±–æ—Ç–∞—é—Ç! –ù–æ –æ–Ω–∏ –±—É–¥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –ù–∏–∫–æ–ª–∞–π –Ω–µ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ Telegram –±–æ—Ç –Ω–µ –Ω–∞—á–Ω–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.

### –¢—Ä–µ–±—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î

Telegram –±–æ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å —ç—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã:

```sql
-- 1. –°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å –∏—Ö TG —á–∞—Ç–∞–º–∏
CREATE TABLE IF NOT EXISTS katya_user_chats (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL REFERENCES users(id),
  telegram_chat_id BIGINT NOT NULL,
  chat_name TEXT NOT NULL,
  chat_type TEXT NOT NULL CHECK(chat_type IN ('private', 'group', 'supergroup', 'channel')),
  is_active BOOLEAN DEFAULT 1,
  created_at INTEGER DEFAULT (strftime('%s', 'now')),
  UNIQUE(user_id, telegram_chat_id)
);

-- 2. –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–∞—Ö
CREATE TABLE IF NOT EXISTS chat_messages (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL REFERENCES users(id),
  telegram_chat_id BIGINT NOT NULL,
  message_id BIGINT NOT NULL,
  telegram_user_id BIGINT NOT NULL,
  username TEXT,
  first_name TEXT,
  text TEXT NOT NULL,
  is_katya_mention BOOLEAN DEFAULT 0,
  created_at INTEGER DEFAULT (strftime('%s', 'now')),
  UNIQUE(telegram_chat_id, message_id)
);

CREATE INDEX idx_chat_messages_user_chat ON chat_messages(user_id, telegram_chat_id, created_at DESC);
CREATE INDEX idx_chat_messages_mentions ON chat_messages(is_katya_mention, user_id, telegram_chat_id);
```

### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)

1. **`KatyaChats.tsx`** - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º —á–∞—Ç–æ–≤

   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ TG —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ö–∞—Ç–µ–π
   - –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º, —Ç–∏–ø–æ–º —á–∞—Ç–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ö–Ω–æ–ø–∫–∏ "–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç" –∏ "–°—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å"
   - Empty state —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π, –µ—Å–ª–∏ —á–∞—Ç–æ–≤ –Ω–µ—Ç

2. **`KatyaChatInterface.tsx`** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —á–∞—Ç–∞

   - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π (lazy loading)
   - –í—ã–¥–µ–ª–µ–Ω–∏–µ @–ö–∞—Ç—è —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞ (—Å–æ–æ–±—â–µ–Ω–∏—è, —É—á–∞—Å—Ç–Ω–∏–∫–∏, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
   - –ö–Ω–æ–ø–∫–∞ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–∞–ª–∞–Ω—Å–∞ BT

3. **–ö–Ω–æ–ø–∫–∞ "üß† –ö–∞—Ç—è —á–∞—Ç—ã" –≤ Sidebar**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ª–µ–≤—É—é –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å
   - –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –Ω–∞ —Å–µ–∫—Ü–∏—é `katya-chats`

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É** ‚Üí –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Telegram Login Widget
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç @katya_boss_ai_bot –≤ TG —á–∞—Ç** ‚Üí –±–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `katya_user_chats`
3. **–ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è** ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `chat_messages` —Å `user_id` –∏ `telegram_chat_id`
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç "–ö–∞—Ç—è —á–∞—Ç—ã" –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ** ‚Üí –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö —á–∞—Ç–æ–≤
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "–°—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å"** ‚Üí –∑–∞–ø—Ä–æ—Å –∫ `/api/ai/chatgpt`, —Å–ø–∏—Å–∞–Ω–∏–µ BT —Ç–æ–∫–µ–Ω–æ–≤

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∏–ª–ª–∏–Ω–≥–æ–º

- **–°—Ç–æ–∏–º–æ—Å—Ç—å —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏:** 0.5 BT –∑–∞ –∑–∞–ø—Ä–æ—Å
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ AI –∑–∞–ø—Ä–æ—Å–æ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 402 (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤)

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ù–∏–∫–æ–ª–∞—é

1. **–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã** `katya_user_chats` –∏ `chat_messages` –≤ `ozon_manager.db`
2. **–í Telegram –±–æ—Ç–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:**
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å `user_id` –∏–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (—Å–≤—è–∑–∫–∞ TG ‚Üî platform)
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ `chat_messages`
   - –ï—Å–ª–∏ —á–∞—Ç –Ω–æ–≤—ã–π ‚Üí —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ `katya_user_chats`
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
   - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://boss-ai.online
   - –û—Ç–∫—Ä—ã—Ç—å "üß† –ö–∞—Ç—è —á–∞—Ç—ã" –≤ Sidebar
   - –£–≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ —á–∞—Ç—ã (–µ—Å–ª–∏ –±–æ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–ª —Å–æ–æ–±—â–µ–Ω–∏—è)

### –§–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

- `backend/main/src/routes/katya-chats.routes.ts` - API endpoints
- `frontend/src/pages/KatyaChats.tsx` - —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
- `frontend/src/pages/KatyaChatInterface.tsx` - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞
- `frontend/src/components/Sidebar/Sidebar.tsx` - –∫–Ω–æ–ø–∫–∞ –≤ –º–µ–Ω—é

---

## ‚ùì FAQ

### Q: –ü–æ—á–µ–º—É SQLite, –∞ –Ω–µ PostgreSQL?

**A:** –ü—Ä–æ—â–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, –º–µ–Ω—å—à–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ, SQLite WAL mode –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è MVP.

### Q: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö?

**A:** –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç `user_id`. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å `WHERE user_id = ?`. User –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ.

### Q: –ß—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ?

**A:** Telegram –±–æ—Ç —Å–∫–∞–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://boss-ai.online —á–µ—Ä–µ–∑ Telegram Login Widget.

### Q: –ö–∞–∫ –±–∏–ª–ª–∏–Ω–≥ –¥–ª—è Telegram —Ä–µ–∂–∏–º–∞?

**A:** MVP: –±–µ—Å–ø–ª–∞—Ç–Ω–æ (system token). Production: —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ TG ‚Üî platform + –æ–±—ã—á–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥.

### Q: –ú–æ–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ö–∞—Ç—é –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Ç–æ–≤?

**A:** –î–∞! `katya_user_chats` —Ö—Ä–∞–Ω–∏—Ç —Å–≤—è–∑—å `user_id` ‚Üî `telegram_chat_id`. –ö–∞–∂–¥—ã–π —á–∞—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π.

### Q: –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π?

**A:** –í `chat_messages` —Å –ø–æ–ª—è–º–∏ `user_id` + `telegram_chat_id` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏.

---

**üéØ –¢–ó v5.0 FINAL –≥–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!**

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (SQLite, shared DB)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∞—Ç—ã –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
- ‚úÖ Telegram Bot + Platform API (dual mode)

**–ù–∏–∫–æ–ª–∞–π, —É—Å–ø–µ—Ö–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ**

**–í–æ–ø—Ä–æ—Å—ã:** @boss –≤ —á–∞—Ç–µ Boss AI
